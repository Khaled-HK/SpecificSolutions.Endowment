import{u as se}from"./useFormValidation--K-9QZRo.js";import{$ as N}from"./api-BL_tVZq2.js";import{V as U}from"./VCardText-BSu9PeVr.js";import{V as A}from"./VSpacer-BvuZd4xP.js";import{aZ as ie,aL as ue,r as u,br as K,P as ne,w as W,D as de,f as me,o as pe,e as t,b as l,d as P,aa as v,m as s,s as d,t as F}from"./index-CK1fpvPu.js";import{V as fe}from"./VDivider-n3wzZ4nA.js";import{V as Q,a as V}from"./VRow-Dcd2HQbw.js";import{V as k}from"./VTextField-DGy7sZcW.js";import{V as ve}from"./VDataTable-DFEIpKEL.js";import{V as X}from"./VChip-DVJAFn6v.js";import{V as I}from"./VDialog-CjDVagY9.js";import{V as z,b as O,d as Z}from"./VCard-CIvz8ijW.js";import{V as Y}from"./VContainer-D300hw9v.js";import{V as _}from"./VTextarea-BnzgekST.js";import{V as Ve}from"./VSnackbar-B_NsgokW.js";import"./index-9rIf2CJL.js";/* empty css              */import"./VAvatar-CA9yN-sZ.js";import"./VImg-CGrxDryJ.js";/* empty css                   */import"./VCounter-B1fUDCB4.js";import"./VField-DG_UKZ_N.js";import"./form-BFxad-Fs.js";import"./easing-CjukEv2V.js";import"./VInput-ktq1dKao.js";import"./forwardRefs-C-GTDzx5.js";import"./VPagination-DdfcFOFW.js";import"./VSelect-CBg7jvEh.js";import"./VList-CKihbX_m.js";import"./ssrBoot-CzZBr7mp.js";import"./dialog-transition-f96dZRyR.js";import"./VMenu-D7_JD2eI.js";import"./VOverlay-DxyOEWWl.js";import"./delay-BJjrXP-f.js";import"./lazy-Dt_oego-.js";import"./scopeId-DrUTg5WU.js";import"./VCheckboxBtn-B3kpR2xa.js";import"./VSelectionControl-Ell3Bz42.js";import"./VTable-C9PhsU1j.js";import"./filter-D4hCb-IW.js";import"./VSlideGroup-CXxg8nxX.js";const ar=ie({__name:"products",setup(ge){const{t:x}=ue(),H=u([]),R=u(!1),E=u(0),n=u(!1),m=u(""),p=u("success"),w=u(!1),C=u(!1),$=u(!1),D=u(null),j=u([]),B=u(""),{addError:S,setErrorsFromResponse:G,clearErrors:q,hasErrors:J,getFieldErrors:g,setFieldTouched:y,shouldShowFieldError:c,validateRequired:T,validateLength:M}=se(),i=K({name:"",description:"",price:0,quantity:0}),o=K({id:0,key:"",value:"",name:"",description:"",price:0,quantity:0}),f=u({page:1,itemsPerPage:10,sortBy:[""],sortDesc:[!1]}),h=ne(()=>[{title:x("tableHeaders.products.name"),key:"name"},{title:x("tableHeaders.products.description"),key:"description"},{title:x("tableHeaders.products.price"),key:"price"},{title:x("tableHeaders.products.quantity"),key:"quantity"},{title:x("tableHeaders.products.actions"),key:"actions",sortable:!1}]),b=async()=>{R.value=!0;try{const a=new URLSearchParams({PageNumber:f.value.page.toString(),PageSize:f.value.itemsPerPage.toString(),SearchTerm:B.value||""}),e=await N(`/Product/filter?${a}`);if(H.value=e.data.items||[],e.data){E.value=e.data.totalCount||0;const r=Math.ceil(E.value/f.value.itemsPerPage);f.value.page>r&&r>0&&(f.value.page=r,await b())}}catch(a){console.error("Error loading products:",a),m.value="حدث خطأ أثناء تحميل المواد",p.value="error",n.value=!0,H.value=[],E.value=0}finally{R.value=!1}},ee=async()=>{q();let a=!0;if(T(i.name,"name","اسم المادة مطلوب")&&M(i.name,"name",2,100,"اسم المادة يجب أن يكون بين 2 و 100 حرف")||(a=!1),T(i.description,"description","وصف المادة مطلوب")&&M(i.description,"description",10,500,"وصف المادة يجب أن يكون بين 10 و 500 حرف")||(a=!1),i.price<0&&(S("price","السعر لا يمكن أن يكون سالب"),a=!1),i.quantity<0&&(S("quantity","الكمية لا يمكن أن تكون سالبة"),a=!1),!!a)try{const e=await N("/Product",{method:"POST",body:{name:i.name,description:i.description,price:i.price,quantity:i.quantity}});if(e&&e.isSuccess===!1){if(e.errors&&Array.isArray(e.errors))G(e);else{const r=e.message||"حدث خطأ أثناء إضافة المادة";m.value=r,p.value="error",n.value=!0}return}w.value=!1,oe(),b(),m.value="تم إضافة المادة بنجاح",p.value="success",n.value=!0}catch(e){console.error("Error adding product:",e),m.value="حدث خطأ أثناء إضافة المادة",p.value="error",n.value=!0}},re=async()=>{q();let a=!0;if(T(o.name,"editName","اسم المادة مطلوب")&&M(o.name,"editName",2,100,"اسم المادة يجب أن يكون بين 2 و 100 حرف")||(a=!1),T(o.description,"editDescription","وصف المادة مطلوب")&&M(o.description,"editDescription",10,500,"وصف المادة يجب أن يكون بين 10 و 500 حرف")||(a=!1),(o.price||0)<0&&(S("editPrice","السعر لا يمكن أن يكون سالب"),a=!1),(o.quantity||0)<0&&(S("editQuantity","الكمية لا يمكن أن تكون سالبة"),a=!1),!!a)try{const e=await N(`/Product/${o.id}`,{method:"PUT",body:{id:o.id,name:o.name,description:o.description,price:o.price||0,quantity:o.quantity||0}});if(e&&e.isSuccess===!1){if(e.errors&&Array.isArray(e.errors))G(e);else{const r=e.message||"حدث خطأ أثناء تحديث المادة";m.value=r,p.value="error",n.value=!0}return}C.value=!1,b(),m.value="تم تحديث المادة بنجاح",p.value="success",n.value=!0}catch(e){console.error("Error updating product:",e),m.value="حدث خطأ أثناء تحديث المادة",p.value="error",n.value=!0}},le=async()=>{var a,e;if(D.value)try{const r=await N(`/Product/${D.value.id}`,{method:"DELETE"});if(r&&r.isSuccess===!1){const L=r.message||((e=(a=r.errors)==null?void 0:a[0])==null?void 0:e.errorMessage)||"حدث خطأ أثناء حذف المادة";m.value=L,p.value="error",n.value=!0;return}$.value=!1,D.value=null,b(),m.value="تم حذف المادة بنجاح",p.value="success",n.value=!0}catch(r){console.error("Error deleting product:",r),m.value="حدث خطأ أثناء حذف المادة",p.value="error",n.value=!0}},te=a=>{q(),o.id=a.id,o.key=a.key,o.value=a.value,o.name=a.name,o.description=a.description,o.price=a.price||0,o.quantity=a.quantity||0,C.value=!0},ae=a=>{q(),D.value=a,$.value=!0},oe=()=>{i.name="",i.description="",i.price=0,i.quantity=0,q()};return W(f,()=>{b()},{deep:!0}),W(B,()=>{f.value.page=1,b()}),de(()=>{b()}),(a,e)=>(pe(),me(z,null,{default:t(()=>[l(U,{class:"d-flex align-center flex-wrap gap-4"},{default:t(()=>[e[28]||(e[28]=P("div",{class:"me-3"},[P("h4",{class:"text-h4"}," إدارة المواد "),P("p",{class:"mb-0"}," عرض وإدارة المواد في النظام ")],-1)),l(A),l(v,{"prepend-icon":"tabler-plus",onClick:e[0]||(e[0]=()=>{s(q)(),w.value=!0})},{default:t(()=>e[27]||(e[27]=[d(" إضافة مادة جديدة ")])),_:1})]),_:1}),l(fe),l(U,null,{default:t(()=>[l(Q,null,{default:t(()=>[l(V,{cols:"12",sm:"4"},{default:t(()=>[l(k,{modelValue:B.value,"onUpdate:modelValue":e[1]||(e[1]=r=>B.value=r),"prepend-inner-icon":"tabler-search",label:"البحث في المواد","single-line":"","hide-details":"",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(ve,{modelValue:j.value,"onUpdate:modelValue":e[2]||(e[2]=r=>j.value=r),headers:h.value,items:H.value,loading:R.value,"items-per-page":f.value.itemsPerPage,page:f.value.page,total:E.value,class:"text-no-wrap","onUpdate:options":e[3]||(e[3]=r=>f.value=r)},{"item.price":t(({item:r})=>[l(X,{color:r.price>0?"success":"warning",size:"small"},{default:t(()=>[d(F(r.price||0)+" ريال ",1)]),_:2},1032,["color"])]),"item.quantity":t(({item:r})=>[l(X,{color:r.quantity>0?"primary":"error",size:"small"},{default:t(()=>[d(F(r.quantity||0),1)]),_:2},1032,["color"])]),"item.actions":t(({item:r})=>[l(v,{icon:"tabler-edit",variant:"text",size:"small",color:"primary",onClick:L=>te(r)},null,8,["onClick"]),l(v,{icon:"tabler-trash",variant:"text",size:"small",color:"error",onClick:L=>ae(r)},null,8,["onClick"])]),_:1},8,["modelValue","headers","items","loading","items-per-page","page","total"]),l(I,{modelValue:w.value,"onUpdate:modelValue":e[13]||(e[13]=r=>w.value=r),"max-width":"500px"},{default:t(()=>[l(z,null,{default:t(()=>[l(O,null,{default:t(()=>e[29]||(e[29]=[P("span",{class:"text-h5"},"إضافة مادة جديدة",-1)])),_:1}),l(U,null,{default:t(()=>[l(Y,null,{default:t(()=>[l(Q,null,{default:t(()=>[l(V,{cols:"12"},{default:t(()=>[l(k,{modelValue:i.name,"onUpdate:modelValue":e[4]||(e[4]=r=>i.name=r),label:"اسم المادة",required:"",error:s(c)("name"),"error-messages":s(g)("name"),onBlur:e[5]||(e[5]=r=>s(y)("name"))},null,8,["modelValue","error","error-messages"])]),_:1}),l(V,{cols:"12"},{default:t(()=>[l(_,{modelValue:i.description,"onUpdate:modelValue":e[6]||(e[6]=r=>i.description=r),label:"الوصف",rows:"3",error:s(c)("description"),"error-messages":s(g)("description"),onBlur:e[7]||(e[7]=r=>s(y)("description"))},null,8,["modelValue","error","error-messages"])]),_:1}),l(V,{cols:"6"},{default:t(()=>[l(k,{modelValue:i.price,"onUpdate:modelValue":e[8]||(e[8]=r=>i.price=r),modelModifiers:{number:!0},label:"السعر",type:"number",min:"0",step:"0.01",error:s(c)("price"),"error-messages":s(g)("price"),onBlur:e[9]||(e[9]=r=>s(y)("price"))},null,8,["modelValue","error","error-messages"])]),_:1}),l(V,{cols:"6"},{default:t(()=>[l(k,{modelValue:i.quantity,"onUpdate:modelValue":e[10]||(e[10]=r=>i.quantity=r),modelModifiers:{number:!0},label:"الكمية",type:"number",min:"0",error:s(c)("quantity"),"error-messages":s(g)("quantity"),onBlur:e[11]||(e[11]=r=>s(y)("quantity"))},null,8,["modelValue","error","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1}),l(Z,null,{default:t(()=>[l(A),l(v,{color:"blue-darken-1",variant:"text",onClick:e[12]||(e[12]=r=>w.value=!1)},{default:t(()=>e[30]||(e[30]=[d(" إلغاء ")])),_:1}),l(v,{color:"blue-darken-1",onClick:ee,disabled:s(J)},{default:t(()=>e[31]||(e[31]=[d(" إضافة ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(I,{modelValue:C.value,"onUpdate:modelValue":e[23]||(e[23]=r=>C.value=r),"max-width":"500px"},{default:t(()=>[l(z,null,{default:t(()=>[l(O,null,{default:t(()=>e[32]||(e[32]=[P("span",{class:"text-h5"},"تعديل المادة",-1)])),_:1}),l(U,null,{default:t(()=>[l(Y,null,{default:t(()=>[l(Q,null,{default:t(()=>[l(V,{cols:"12"},{default:t(()=>[l(k,{modelValue:o.name,"onUpdate:modelValue":e[14]||(e[14]=r=>o.name=r),label:"اسم المادة",required:"",error:s(c)("editName"),"error-messages":s(g)("editName"),onBlur:e[15]||(e[15]=r=>s(y)("editName"))},null,8,["modelValue","error","error-messages"])]),_:1}),l(V,{cols:"12"},{default:t(()=>[l(_,{modelValue:o.description,"onUpdate:modelValue":e[16]||(e[16]=r=>o.description=r),label:"الوصف",rows:"3",error:s(c)("editDescription"),"error-messages":s(g)("editDescription"),onBlur:e[17]||(e[17]=r=>s(y)("editDescription"))},null,8,["modelValue","error","error-messages"])]),_:1}),l(V,{cols:"6"},{default:t(()=>[l(k,{modelValue:o.price,"onUpdate:modelValue":e[18]||(e[18]=r=>o.price=r),modelModifiers:{number:!0},label:"السعر",type:"number",min:"0",step:"0.01",error:s(c)("editPrice"),"error-messages":s(g)("editPrice"),onBlur:e[19]||(e[19]=r=>s(y)("editPrice"))},null,8,["modelValue","error","error-messages"])]),_:1}),l(V,{cols:"6"},{default:t(()=>[l(k,{modelValue:o.quantity,"onUpdate:modelValue":e[20]||(e[20]=r=>o.quantity=r),modelModifiers:{number:!0},label:"الكمية",type:"number",min:"0",error:s(c)("editQuantity"),"error-messages":s(g)("editQuantity"),onBlur:e[21]||(e[21]=r=>s(y)("editQuantity"))},null,8,["modelValue","error","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1}),l(Z,null,{default:t(()=>[l(A),l(v,{color:"blue-darken-1",variant:"text",onClick:e[22]||(e[22]=r=>C.value=!1)},{default:t(()=>e[33]||(e[33]=[d(" إلغاء ")])),_:1}),l(v,{color:"blue-darken-1",onClick:re,disabled:s(J)},{default:t(()=>e[34]||(e[34]=[d(" تحديث ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(I,{modelValue:$.value,"onUpdate:modelValue":e[25]||(e[25]=r=>$.value=r),"max-width":"400px"},{default:t(()=>[l(z,null,{default:t(()=>[l(O,{class:"text-h5"},{default:t(()=>e[35]||(e[35]=[d(" تأكيد الحذف ")])),_:1}),l(U,null,{default:t(()=>{var r;return[d(' هل أنت متأكد من حذف المادة "'+F((r=D.value)==null?void 0:r.name)+'"؟ ',1),e[36]||(e[36]=P("br",null,null,-1)),e[37]||(e[37]=P("strong",null,"لا يمكن التراجع عن هذا الإجراء.",-1))]}),_:1}),l(Z,null,{default:t(()=>[l(A),l(v,{color:"blue-darken-1",variant:"text",onClick:e[24]||(e[24]=r=>$.value=!1)},{default:t(()=>e[38]||(e[38]=[d(" إلغاء ")])),_:1}),l(v,{color:"error",onClick:le},{default:t(()=>e[39]||(e[39]=[d(" حذف ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Ve,{modelValue:n.value,"onUpdate:modelValue":e[26]||(e[26]=r=>n.value=r),color:p.value,timeout:3e3},{default:t(()=>[d(F(m.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}});export{ar as default};
