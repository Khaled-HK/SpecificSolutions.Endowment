import{a$ as ue,r as u,w as J,G as se,a as ne,c as B,o as N,b as a,e as t,t as s,v as x,d as p,f as q,l as ie,ac as g,V as K,aX as Q}from"./index-BtfhVSwE.js";import{$ as P}from"./api-DMVoFGKx.js";import{V as de}from"./VAlert-XzerbF0T.js";import{b as M,V as D,d as z}from"./VCard-BMKvoKHc.js";import{V as me}from"./VDivider-BskaqePa.js";import{V as $}from"./VCardText-CQ_kqBGy.js";import{V as A,a as V}from"./VRow-DRm1vRrS.js";import{V as k}from"./VTextField-BP9Yt9Bg.js";import{V as ve}from"./VDataTable-arlORk0G.js";import{V as fe}from"./VSelect-CV3yq3nX.js";import{V as pe}from"./VPagination-C4bWb9ez.js";import{V as W}from"./VChip-DkJYynY0.js";import{V as ce}from"./VAvatar-Di7p70o_.js";import{V as Y}from"./VForm-DB6_r-fV.js";import{V as ge}from"./VAutocomplete-DFOTlZAA.js";import{V as R}from"./VSpacer-affoxjwI.js";import{V as j}from"./VDialog-BR-8AWmC.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-9rIf2CJL.js";import"./VImg-BKSypqLi.js";/* empty css              *//* empty css                   */import"./VCounter-CfEBC7nV.js";import"./VField-DiZdpAIN.js";import"./form-DUL9ls8s.js";import"./easing-CjukEv2V.js";import"./VInput-DIAfQwmh.js";import"./forwardRefs-C-GTDzx5.js";import"./VCheckboxBtn-CPFIFhHb.js";import"./VSelectionControl-C7oASZhF.js";import"./VTable-DxW4-iwJ.js";import"./filter-BALRNvRS.js";import"./VList-Cp76iGum.js";import"./ssrBoot-BJLk6Iwd.js";import"./dialog-transition-CRKIv97n.js";import"./VMenu-Cpm7zxfp.js";import"./VOverlay-BfQOvZM9.js";import"./delay-BDF9y9xB.js";import"./lazy-NLe1V18V.js";import"./scopeId-Cvig9lvB.js";import"./VSlideGroup-BbCsdCyI.js";const ye={class:"d-flex gap-2"},be={class:"d-flex align-center"},xe={class:"d-flex flex-column ms-3"},ke={class:"d-block font-weight-medium text-truncate text-high-emphasis"},we={key:1,class:"text-medium-emphasis"},Ne={key:1,class:"text-medium-emphasis"},Pe={class:"d-flex gap-1"},Ce={class:"d-flex flex-wrap justify-center justify-sm-space-between gap-y-2 mt-2"},Ue=ue({__name:"offices",setup($e){const I=u([]),L=u([]),T=u(!1),h=u(!1),S=u(0),n=u(!1),d=u(""),m=u("success"),C=u(!1),U=u(!1),y=u(!1),O=u(null),b=u([]),E=u(""),v=u({name:"",location:"",phoneNumber:"",regionId:""}),f=u({id:0,key:"",value:"",name:"",phoneNumber:"",location:"",regionId:""}),i=u({page:1,itemsPerPage:10,sortBy:[""],sortDesc:[!1]}),Z=[{title:"المكتب",key:"name"},{title:"المنطقة",key:"regionName"},{title:"رقم الهاتف",key:"phoneNumber"},{title:"الإجراءات",key:"actions",sortable:!1}],c=async()=>{T.value=!0;try{const r=new URLSearchParams({PageNumber:i.value.page.toString(),PageSize:i.value.itemsPerPage.toString(),SearchTerm:E.value||""}),e=await P(`/Office/filter?${r}`);if(I.value=e.data.items||[],e.data){S.value=e.data.totalCount||0;const o=Math.ceil(S.value/i.value.itemsPerPage);i.value.page>o&&o>0&&(i.value.page=o,await c())}}catch(r){console.error("Error loading offices:",r),d.value="حدث خطأ أثناء تحميل المكاتب",m.value="error",n.value=!0,I.value=[],S.value=0}finally{T.value=!1}},ee=async()=>{h.value=!0;try{const r=await P("/Region/filter?PageSize=100");L.value=r.data.items||[]}catch(r){console.error("Error loading regions:",r),d.value="حدث خطأ أثناء تحميل المناطق",m.value="error",n.value=!0}finally{h.value=!1}},F=async()=>{var r,e;try{const o=await P("/Office",{method:"POST",body:{name:v.value.name,location:v.value.location,phoneNumber:v.value.phoneNumber,regionId:v.value.regionId}});if(o&&o.isSuccess===!1){const l=o.message||((e=(r=o.errors)==null?void 0:r[0])==null?void 0:e.errorMessage)||"حدث خطأ أثناء إضافة المكتب";d.value=l,m.value="error",n.value=!0;return}C.value=!1,re(),c(),d.value="تم إضافة المكتب بنجاح",m.value="success",n.value=!0}catch(o){console.error("Error adding office:",o),d.value="حدث خطأ أثناء إضافة المكتب",m.value="error",n.value=!0}},G=async()=>{var r,e;try{const o=await P(`/Office/${f.value.id}`,{method:"PUT",body:{id:f.value.id,name:f.value.name,location:f.value.location||"",phoneNumber:f.value.phoneNumber}});if(o&&o.isSuccess===!1){const l=o.message||((e=(r=o.errors)==null?void 0:r[0])==null?void 0:e.errorMessage)||"حدث خطأ أثناء تحديث المكتب";d.value=l,m.value="error",n.value=!0;return}U.value=!1,c(),d.value="تم تحديث المكتب بنجاح",m.value="success",n.value=!0}catch(o){console.error("Error updating office:",o),d.value="حدث خطأ أثناء تحديث المكتب",m.value="error",n.value=!0}},le=async()=>{var r,e;if(O.value)try{const o=await P(`/Office/${O.value.id}`,{method:"DELETE"});if(o&&o.isSuccess===!1){const l=o.message||((e=(r=o.errors)==null?void 0:r[0])==null?void 0:e.errorMessage)||"حدث خطأ أثناء حذف المكتب";d.value=l,m.value="error",n.value=!0,y.value=!1;return}y.value=!1,c(),d.value="تم حذف المكتب بنجاح",m.value="success",n.value=!0}catch(o){console.error("Error deleting office:",o),d.value="حدث خطأ في الاتصال بالخادم",m.value="error",n.value=!0,y.value=!1}},ae=async()=>{if(b.value.length!==0)try{const r=b.value.map(l=>P(`/Office/${l.id}`,{method:"DELETE"})),o=(await Promise.all(r)).filter(l=>l&&l.isSuccess===!1);if(o.length>0){const l=o.map(w=>{var X,H;return(w==null?void 0:w.message)||((H=(X=w==null?void 0:w.errors)==null?void 0:X[0])==null?void 0:H.errorMessage)||"حدث خطأ أثناء العملية"}),_=`فشل في حذف ${o.length} عنصر: ${l.join(", ")}`;d.value=_,m.value="error",n.value=!0;return}b.value=[],c(),d.value="تم حذف المكاتب المحددة بنجاح",m.value="success",n.value=!0}catch(r){console.error("Error deleting selected offices:",r),d.value="حدث خطأ في الاتصال بالخادم",m.value="error",n.value=!0}},te=r=>{f.value={...r,location:r.location||"",phoneNumber:r.phoneNumber||"",name:r.name||""},U.value=!0},oe=r=>{O.value=r,y.value=!0},re=()=>{v.value={name:"",location:"",phoneNumber:"",regionId:""}};return J(E,()=>{i.value.page=1,c()},{immediate:!1}),J([()=>i.value.page,()=>i.value.itemsPerPage],()=>{c()},{immediate:!1}),se(()=>{c(),ee()}),(r,e)=>{const o=ne("IconBtn");return N(),B("div",null,[a(de,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=l=>n.value=l),type:m.value,variant:"tonal",closable:"",class:"mb-4"},{default:t(()=>[s(x(d.value),1)]),_:1},8,["modelValue","type"]),a(D,null,{default:t(()=>[a(M,{class:"d-flex justify-space-between align-center pa-6"},{default:t(()=>[e[20]||(e[20]=p("span",{class:"text-h5"},"إدارة المكاتب",-1)),p("div",ye,[b.value.length>0?(N(),q(g,{key:0,color:"error",variant:"outlined",onClick:ae},{default:t(()=>[s(" حذف المحدد ("+x(b.value.length)+") ",1)]),_:1})):ie("",!0),a(g,{color:"primary",onClick:e[1]||(e[1]=l=>C.value=!0)},{default:t(()=>e[19]||(e[19]=[s(" إضافة مكتب ")])),_:1})])]),_:1}),a(me),a($,null,{default:t(()=>[a(A,null,{default:t(()=>[a(V,{cols:"12","offset-md":"8",md:"4"},{default:t(()=>[a(k,{modelValue:E.value,"onUpdate:modelValue":e[2]||(e[2]=l=>E.value=l),placeholder:"البحث في المكاتب...","prepend-inner-icon":"mdi-magnify","single-line":"","hide-details":"",dense:"",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),a(ve,{headers:Z,items:I.value,loading:T.value,"items-per-page":i.value.itemsPerPage,page:i.value.page,options:i.value,class:"text-no-wrap","show-select":"",modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=l=>b.value=l)},{"item.name":t(({item:l})=>[p("div",be,[a(ce,{size:"32",color:"primary",variant:"tonal"},{default:t(()=>[s(x(l.name.charAt(0).toUpperCase()),1)]),_:2},1024),p("div",xe,[p("span",ke,x(l.name),1)])])]),"item.regionName":t(({item:l})=>[l.regionName?(N(),q(W,{key:0,color:"secondary",variant:"tonal",size:"small"},{default:t(()=>[s(x(l.regionName),1)]),_:2},1024)):(N(),B("span",we," لا توجد منطقة "))]),"item.phoneNumber":t(({item:l})=>[l.phoneNumber?(N(),q(W,{key:0,color:"success",variant:"tonal",size:"small"},{default:t(()=>[s(x(l.phoneNumber),1)]),_:2},1024)):(N(),B("span",Ne," لا يوجد رقم هاتف "))]),"item.actions":t(({item:l})=>[p("div",Pe,[a(o,{onClick:_=>te(l)},{default:t(()=>[a(K,{icon:"tabler-edit"})]),_:2},1032,["onClick"]),a(o,{onClick:_=>oe(l)},{default:t(()=>[a(K,{icon:"tabler-trash"})]),_:2},1032,["onClick"])])]),bottom:t(()=>[a($,{class:"pt-2"},{default:t(()=>[p("div",Ce,[a(fe,{modelValue:i.value.itemsPerPage,"onUpdate:modelValue":e[3]||(e[3]=l=>i.value.itemsPerPage=l),items:[5,10,25,50,100],label:"عناصر في الصفحة:",variant:"underlined",style:{"max-inline-size":"8rem","min-inline-size":"5rem"}},null,8,["modelValue"]),a(pe,{modelValue:i.value.page,"onUpdate:modelValue":e[4]||(e[4]=l=>i.value.page=l),"total-visible":r.$vuetify.display.smAndDown?3:5,length:Math.ceil(S.value/i.value.itemsPerPage)},null,8,["modelValue","total-visible","length"])])]),_:1})]),_:1},8,["items","loading","items-per-page","page","options","modelValue"])]),_:1})]),_:1}),a(j,{modelValue:C.value,"onUpdate:modelValue":e[11]||(e[11]=l=>C.value=l),"max-width":"600px",persistent:""},{default:t(()=>[a(D,null,{default:t(()=>[a(M,{class:"text-h6"},{default:t(()=>e[21]||(e[21]=[s("إضافة مكتب جديد")])),_:1}),a($,null,{default:t(()=>[a(Y,{onSubmit:Q(F,["prevent"])},{default:t(()=>[a(A,null,{default:t(()=>[a(V,{cols:"12"},{default:t(()=>[a(k,{modelValue:v.value.name,"onUpdate:modelValue":e[6]||(e[6]=l=>v.value.name=l),label:"اسم المكتب",variant:"outlined",required:"",rules:[l=>!!l||"اسم المكتب مطلوب"]},null,8,["modelValue","rules"])]),_:1}),a(V,{cols:"12"},{default:t(()=>[a(k,{modelValue:v.value.location,"onUpdate:modelValue":e[7]||(e[7]=l=>v.value.location=l),label:"الموقع",variant:"outlined",required:"",rules:[l=>!!l||"الموقع مطلوب"]},null,8,["modelValue","rules"])]),_:1}),a(V,{cols:"12"},{default:t(()=>[a(k,{modelValue:v.value.phoneNumber,"onUpdate:modelValue":e[8]||(e[8]=l=>v.value.phoneNumber=l),label:"رقم الهاتف",variant:"outlined",required:"",placeholder:"091-1234567 أو 021-1234567",rules:[l=>!!l||"رقم الهاتف مطلوب",l=>/^(09[1-5]|02[1-9])-?\d{7}$/.test(l)||"يجب أن يكون رقم الهاتف بتنسيق ليبي صحيح (مثال: 091-1234567)"],"prepend-inner-icon":"mdi-phone"},null,8,["modelValue","rules"])]),_:1}),a(V,{cols:"12"},{default:t(()=>[a(ge,{modelValue:v.value.regionId,"onUpdate:modelValue":e[9]||(e[9]=l=>v.value.regionId=l),label:"المنطقة",variant:"outlined",items:L.value,"item-title":"name","item-value":"id",loading:h.value,clearable:"","no-data-text":"لا توجد مناطق متاحة",required:"",rules:[l=>!!l||"المنطقة مطلوبة"],"prepend-inner-icon":"mdi-map-marker",placeholder:"اختر المنطقة...","hide-no-data":""},null,8,["modelValue","items","loading","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),a(z,null,{default:t(()=>[a(R),a(g,{color:"grey-darken-1",variant:"text",onClick:e[10]||(e[10]=l=>C.value=!1)},{default:t(()=>e[22]||(e[22]=[s(" إلغاء ")])),_:1}),a(g,{color:"primary",variant:"flat",onClick:F},{default:t(()=>e[23]||(e[23]=[s(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(j,{modelValue:U.value,"onUpdate:modelValue":e[16]||(e[16]=l=>U.value=l),"max-width":"600px",persistent:""},{default:t(()=>[a(D,null,{default:t(()=>[a(M,{class:"text-h6"},{default:t(()=>e[24]||(e[24]=[s("تعديل المكتب")])),_:1}),a($,null,{default:t(()=>[a(Y,{onSubmit:Q(G,["prevent"])},{default:t(()=>[a(A,null,{default:t(()=>[a(V,{cols:"12"},{default:t(()=>[a(k,{modelValue:f.value.name,"onUpdate:modelValue":e[12]||(e[12]=l=>f.value.name=l),label:"اسم المكتب",variant:"outlined",required:"",rules:[l=>!!l||"اسم المكتب مطلوب"]},null,8,["modelValue","rules"])]),_:1}),a(V,{cols:"12"},{default:t(()=>[a(k,{modelValue:f.value.location,"onUpdate:modelValue":e[13]||(e[13]=l=>f.value.location=l),label:"الموقع",variant:"outlined",required:"",rules:[l=>!!l||"الموقع مطلوب"]},null,8,["modelValue","rules"])]),_:1}),a(V,{cols:"12"},{default:t(()=>[a(k,{modelValue:f.value.phoneNumber,"onUpdate:modelValue":e[14]||(e[14]=l=>f.value.phoneNumber=l),label:"رقم الهاتف",variant:"outlined",required:"",placeholder:"091-1234567 أو 021-1234567",rules:[l=>!!l||"رقم الهاتف مطلوب",l=>/^(09[1-5]|02[1-9])-?\d{7}$/.test(l)||"يجب أن يكون رقم الهاتف بتنسيق ليبي صحيح (مثال: 091-1234567)"],"prepend-inner-icon":"mdi-phone"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),a(z,null,{default:t(()=>[a(R),a(g,{color:"grey-darken-1",variant:"text",onClick:e[15]||(e[15]=l=>U.value=!1)},{default:t(()=>e[25]||(e[25]=[s(" إلغاء ")])),_:1}),a(g,{color:"primary",variant:"flat",onClick:G},{default:t(()=>e[26]||(e[26]=[s(" تحديث ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(j,{modelValue:y.value,"onUpdate:modelValue":e[18]||(e[18]=l=>y.value=l),"max-width":"400px"},{default:t(()=>[a(D,null,{default:t(()=>[a(M,{class:"text-h6"},{default:t(()=>e[27]||(e[27]=[s("تأكيد الحذف")])),_:1}),a($,null,{default:t(()=>{var l;return[e[28]||(e[28]=s(' هل أنت متأكد من حذف المكتب "')),p("strong",null,x((l=O.value)==null?void 0:l.name),1),e[29]||(e[29]=s('"؟ ')),e[30]||(e[30]=p("br",null,null,-1)),e[31]||(e[31]=p("span",{class:"text-error"},"لا يمكن التراجع عن هذا الإجراء.",-1))]}),_:1}),a(z,null,{default:t(()=>[a(R),a(g,{color:"grey-darken-1",variant:"text",onClick:e[17]||(e[17]=l=>y.value=!1)},{default:t(()=>e[32]||(e[32]=[s(" إلغاء ")])),_:1}),a(g,{color:"error",variant:"flat",onClick:le},{default:t(()=>e[33]||(e[33]=[s(" حذف ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),cl=Ve(Ue,[["__scopeId","data-v-5d0fc954"]]);export{cl as default};
