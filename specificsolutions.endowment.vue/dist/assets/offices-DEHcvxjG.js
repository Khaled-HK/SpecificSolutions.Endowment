import{aZ as be,r as c,aL as he,P as Ve,w as te,D as Ne,a as ye,c as H,o as _,b as o,e as t,s as g,t as m,d as V,m as r,f as Z,l as xe,aa as x,V as ne,aV as se}from"./index-CK1fpvPu.js";import{u as we}from"./useFormValidation--K-9QZRo.js";import{$ as E}from"./api-BL_tVZq2.js";import{V as Pe}from"./VAlert-Bt6ZrLfv.js";import{b as T,V as R,d as G}from"./VCard-CIvz8ijW.js";import{V as ke}from"./VDivider-n3wzZ4nA.js";import{V as L}from"./VCardText-BSu9PeVr.js";import{V as J,a as w}from"./VRow-Dcd2HQbw.js";import{V as $}from"./VTextField-DGy7sZcW.js";import{V as $e}from"./VDataTable-DFEIpKEL.js";import{V as Oe}from"./VSelect-CBg7jvEh.js";import{V as Ce}from"./VPagination-DdfcFOFW.js";import{V as ue}from"./VChip-DVJAFn6v.js";import{V as _e}from"./VAvatar-CA9yN-sZ.js";import{V as ie}from"./VForm-CHv1ws0G.js";import{V as Ee}from"./VAutocomplete-H3YvJhAa.js";import{V as K}from"./VSpacer-BvuZd4xP.js";import{V as Q}from"./VDialog-CjDVagY9.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-9rIf2CJL.js";import"./VImg-CGrxDryJ.js";/* empty css              *//* empty css                   */import"./VCounter-B1fUDCB4.js";import"./VField-DG_UKZ_N.js";import"./form-BFxad-Fs.js";import"./easing-CjukEv2V.js";import"./VInput-ktq1dKao.js";import"./forwardRefs-C-GTDzx5.js";import"./VCheckboxBtn-B3kpR2xa.js";import"./VSelectionControl-Ell3Bz42.js";import"./VTable-C9PhsU1j.js";import"./filter-D4hCb-IW.js";import"./VList-CKihbX_m.js";import"./ssrBoot-CzZBr7mp.js";import"./dialog-transition-f96dZRyR.js";import"./VMenu-D7_JD2eI.js";import"./VOverlay-DxyOEWWl.js";import"./delay-BJjrXP-f.js";import"./lazy-Dt_oego-.js";import"./scopeId-DrUTg5WU.js";import"./VSlideGroup-CXxg8nxX.js";const Se={class:"text-h5"},Ae={class:"d-flex gap-2"},Le={class:"d-flex align-center"},Ue={class:"d-flex flex-column ms-3"},De={class:"d-block font-weight-medium text-truncate text-high-emphasis"},qe={key:1,class:"text-medium-emphasis"},Be={key:1,class:"text-medium-emphasis"},Me={class:"d-flex gap-1"},Te={class:"d-flex flex-wrap justify-center justify-sm-space-between gap-y-2 mt-2"},Re={class:"text-error"},ze=be({__name:"offices",setup(Fe){const z=c([]),W=c([]),F=c(!1),j=c(!1),U=c(0),v=c(!1),b=c(""),h=c("success"),I=c(!1),S=c(!1),P=c(!1),A=c(null),N=c([]),D=c(""),i=c({name:"",location:"",phoneNumber:"",regionId:""}),f=c({id:0,key:"",value:"",name:"",phoneNumber:"",location:"",regionId:""}),{validationState:u,setErrorsFromResponse:X,clearErrors:q,hasErrors:Y,setFieldTouched:d,validateRequired:k,validateLength:B,addError:ee}=we(),{t:M,locale:l}=he(),p=c({page:1,itemsPerPage:10,sortBy:[""],sortDesc:[!1]}),de=Ve(()=>[{title:M("tableHeaders.offices.name"),key:"name"},{title:M("tableHeaders.offices.regionName"),key:"regionName"},{title:M("tableHeaders.offices.phoneNumber"),key:"phoneNumber"},{title:M("tableHeaders.offices.actions"),key:"actions",sortable:!1}]),y=async()=>{F.value=!0;try{const n=new URLSearchParams({PageNumber:p.value.page.toString(),PageSize:p.value.itemsPerPage.toString(),SearchTerm:D.value||""}),e=await E(`/Office/filter?${n}`,{headers:{"Accept-Language":l.value}});if(z.value=e.data.items||[],e.data){U.value=e.data.totalCount||0;const s=Math.ceil(U.value/p.value.itemsPerPage);p.value.page>s&&s>0&&(p.value.page=s,await y())}}catch(n){console.error("Error loading offices:",n),b.value=l.value==="ar"?"حدث خطأ أثناء تحميل المكاتب":"Error loading offices",h.value="error",v.value=!0,z.value=[],U.value=0}finally{F.value=!1}},me=async()=>{j.value=!0;try{const n=await E("/Region/filter?PageSize=100",{headers:{"Accept-Language":l.value}});W.value=n.data.items||[]}catch(n){console.error("Error loading regions:",n),b.value=l.value==="ar"?"حدث خطأ أثناء تحميل المناطق":"Error loading regions",h.value="error",v.value=!0}finally{j.value=!1}},ae=async()=>{q();let n=!0;if(k(i.value.name,"name",l.value==="ar"?"اسم المكتب مطلوب":"Office name is required")&&B(i.value.name,"name",1,100,l.value==="ar"?"اسم المكتب يجب أن يكون بين 1 و 100 حرف":"Office name must be between 1 and 100 characters")||(n=!1),k(i.value.location,"location",l.value==="ar"?"الموقع مطلوب":"Location is required")&&B(i.value.location,"location",1,200,l.value==="ar"?"الموقع يجب أن يكون بين 1 و 200 حرف":"Location must be between 1 and 200 characters")||(n=!1),!k(i.value.phoneNumber,"phoneNumber",l.value==="ar"?"رقم الهاتف مطلوب":"Phone number is required"))n=!1;else{const e=/^(09[1-5]|02[1-9])-?\d{7}$/;i.value.phoneNumber&&!e.test(i.value.phoneNumber)&&(ee("phoneNumber",l.value==="ar"?"يجب أن يكون رقم الهاتف بتنسيق ليبي صحيح (مثال: 091-1234567)":"Phone number must be in valid Libyan format (e.g., 091-1234567)"),n=!1)}if(k(i.value.regionId,"regionId",l.value==="ar"?"المنطقة مطلوبة":"Region is required")||(n=!1),d("name"),d("location"),d("phoneNumber"),d("regionId"),!!n)try{const e=await E("/Office",{method:"POST",body:{name:i.value.name.trim(),location:i.value.location.trim(),phoneNumber:i.value.phoneNumber.trim(),regionId:i.value.regionId},headers:{"Accept-Language":l.value}});if(e&&e.isSuccess===!1){if(e.errors&&Array.isArray(e.errors))X(e),d("name"),d("location"),d("phoneNumber"),d("regionId");else{const s=e.message||(l.value==="ar"?"حدث خطأ أثناء إضافة المكتب":"Error adding office");b.value=s,h.value="error",v.value=!0}return}I.value=!1,ge(),y(),b.value=l.value==="ar"?"تم إضافة المكتب بنجاح":"Office added successfully",h.value="success",v.value=!0}catch(e){console.error("Error adding office:",e),b.value=l.value==="ar"?"حدث خطأ أثناء إضافة المكتب":"Error adding office",h.value="error",v.value=!0}},re=async()=>{var e;q();let n=!0;if(k(f.value.name,"name",l.value==="ar"?"اسم المكتب مطلوب":"Office name is required")&&B(f.value.name,"name",1,100,l.value==="ar"?"اسم المكتب يجب أن يكون بين 1 و 100 حرف":"Office name must be between 1 and 100 characters")||(n=!1),k(f.value.location,"location",l.value==="ar"?"الموقع مطلوب":"Location is required")?f.value.location&&!B(f.value.location,"location",1,200,l.value==="ar"?"الموقع يجب أن يكون بين 1 و 200 حرف":"Location must be between 1 and 200 characters")&&(n=!1):n=!1,!k(f.value.phoneNumber,"phoneNumber",l.value==="ar"?"رقم الهاتف مطلوب":"Phone number is required"))n=!1;else{const s=/^(09[1-5]|02[1-9])-?\d{7}$/;f.value.phoneNumber&&!s.test(f.value.phoneNumber)&&(ee("phoneNumber",l.value==="ar"?"يجب أن يكون رقم الهاتف بتنسيق ليبي صحيح (مثال: 091-1234567)":"Phone number must be in valid Libyan format (e.g., 091-1234567)"),n=!1)}if(d("name"),d("location"),d("phoneNumber"),!!n)try{const s=await E(`/Office/${f.value.id}`,{method:"PUT",body:{id:f.value.id,name:f.value.name.trim(),location:((e=f.value.location)==null?void 0:e.trim())||"",phoneNumber:f.value.phoneNumber.trim()},headers:{"Accept-Language":l.value}});if(s&&s.isSuccess===!1){if(s.errors&&Array.isArray(s.errors))X(s),d("name"),d("location"),d("phoneNumber");else{const a=s.message||(l.value==="ar"?"حدث خطأ أثناء تحديث المكتب":"Error updating office");b.value=a,h.value="error",v.value=!0}return}S.value=!1,y(),b.value=l.value==="ar"?"تم تحديث المكتب بنجاح":"Office updated successfully",h.value="success",v.value=!0}catch(s){console.error("Error updating office:",s),b.value=l.value==="ar"?"حدث خطأ أثناء تحديث المكتب":"Error updating office",h.value="error",v.value=!0}},fe=async()=>{var n,e;if(A.value)try{const s=await E(`/Office/${A.value.id}`,{method:"DELETE",headers:{"Accept-Language":l.value}});if(s&&s.isSuccess===!1){const a=s.message||((e=(n=s.errors)==null?void 0:n[0])==null?void 0:e.errorMessage)||(l.value==="ar"?"حدث خطأ أثناء حذف المكتب":"Error deleting office");b.value=a,h.value="error",v.value=!0,P.value=!1;return}P.value=!1,y(),b.value=l.value==="ar"?"تم حذف المكتب بنجاح":"Office deleted successfully",h.value="success",v.value=!0}catch(s){console.error("Error deleting office:",s),b.value=l.value==="ar"?"حدث خطأ في الاتصال بالخادم":"Network connection error",h.value="error",v.value=!0,P.value=!1}},ce=async()=>{if(N.value.length!==0)try{const n=N.value.map(a=>E(`/Office/${a.id}`,{method:"DELETE",headers:{"Accept-Language":l.value}})),s=(await Promise.all(n)).filter(a=>a&&a.isSuccess===!1);if(s.length>0){const a=s.map(C=>{var le,oe;return(C==null?void 0:C.message)||((oe=(le=C==null?void 0:C.errors)==null?void 0:le[0])==null?void 0:oe.errorMessage)||(l.value==="ar"?"حدث خطأ أثناء العملية":"Operation error")}),O=l.value==="ar"?`فشل في حذف ${s.length} عنصر: ${a.join(", ")}`:`Failed to delete ${s.length} items: ${a.join(", ")}`;b.value=O,h.value="error",v.value=!0;return}N.value=[],y(),b.value=l.value==="ar"?"تم حذف المكاتب المحددة بنجاح":"Selected offices deleted successfully",h.value="success",v.value=!0}catch(n){console.error("Error deleting selected offices:",n),b.value=l.value==="ar"?"حدث خطأ في الاتصال بالخادم":"Network connection error",h.value="error",v.value=!0}},ve=n=>{f.value={...n,location:n.location||"",phoneNumber:n.phoneNumber||"",name:n.name||""},S.value=!0,q()},pe=n=>{A.value=n,P.value=!0},ge=()=>{i.value={name:"",location:"",phoneNumber:"",regionId:""},q()};return te(D,()=>{p.value.page=1,y()},{immediate:!1}),te([()=>p.value.page,()=>p.value.itemsPerPage],()=>{y()},{immediate:!1}),Ne(()=>{y(),me()}),(n,e)=>{const s=ye("IconBtn");return _(),H("div",null,[o(Pe,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a),type:h.value,variant:"tonal",closable:"",class:"mb-4"},{default:t(()=>[g(m(b.value),1)]),_:1},8,["modelValue","type"]),o(R,null,{default:t(()=>[o(T,{class:"d-flex justify-space-between align-center pa-6"},{default:t(()=>[V("span",Se,m(r(l)==="ar"?"إدارة المكاتب":"Offices Management"),1),V("div",Ae,[N.value.length>0?(_(),Z(x,{key:0,color:"error",variant:"outlined",onClick:ce},{default:t(()=>[g(m(r(l)==="ar"?`حذف المحدد (${N.value.length})`:`Delete Selected (${N.value.length})`),1)]),_:1})):xe("",!0),o(x,{color:"primary",onClick:e[1]||(e[1]=a=>I.value=!0)},{default:t(()=>[g(m(r(l)==="ar"?"إضافة مكتب":"Add Office"),1)]),_:1})])]),_:1}),o(ke),o(L,null,{default:t(()=>[o(J,null,{default:t(()=>[o(w,{cols:"12","offset-md":"8",md:"4"},{default:t(()=>[o($,{modelValue:D.value,"onUpdate:modelValue":e[2]||(e[2]=a=>D.value=a),placeholder:r(l)==="ar"?"البحث في المكاتب...":"Search offices...","prepend-inner-icon":"mdi-magnify","single-line":"","hide-details":"",dense:"",outlined:""},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),o($e,{headers:de.value,items:z.value,loading:F.value,"items-per-page":p.value.itemsPerPage,page:p.value.page,options:p.value,class:"text-no-wrap","show-select":"",modelValue:N.value,"onUpdate:modelValue":e[5]||(e[5]=a=>N.value=a)},{"item.name":t(({item:a})=>[V("div",Le,[o(_e,{size:"32",color:"primary",variant:"tonal"},{default:t(()=>[g(m(a.name.charAt(0).toUpperCase()),1)]),_:2},1024),V("div",Ue,[V("span",De,m(a.name),1)])])]),"item.regionName":t(({item:a})=>[a.regionName?(_(),Z(ue,{key:0,color:"secondary",variant:"tonal",size:"small"},{default:t(()=>[g(m(a.regionName),1)]),_:2},1024)):(_(),H("span",qe,m(r(l)==="ar"?"لا توجد منطقة":"No region"),1))]),"item.phoneNumber":t(({item:a})=>[a.phoneNumber?(_(),Z(ue,{key:0,color:"success",variant:"tonal",size:"small"},{default:t(()=>[g(m(a.phoneNumber),1)]),_:2},1024)):(_(),H("span",Be,m(r(l)==="ar"?"لا يوجد رقم هاتف":"No phone number"),1))]),"item.actions":t(({item:a})=>[V("div",Me,[o(s,{onClick:O=>ve(a)},{default:t(()=>[o(ne,{icon:"tabler-edit"})]),_:2},1032,["onClick"]),o(s,{onClick:O=>pe(a)},{default:t(()=>[o(ne,{icon:"tabler-trash"})]),_:2},1032,["onClick"])])]),bottom:t(()=>[o(L,{class:"pt-2"},{default:t(()=>[V("div",Te,[o(Oe,{modelValue:p.value.itemsPerPage,"onUpdate:modelValue":e[3]||(e[3]=a=>p.value.itemsPerPage=a),items:[5,10,25,50,100],label:r(l)==="ar"?"عناصر في الصفحة:":"Items per page:",variant:"underlined",style:{"max-inline-size":"8rem","min-inline-size":"5rem"}},null,8,["modelValue","label"]),o(Ce,{modelValue:p.value.page,"onUpdate:modelValue":e[4]||(e[4]=a=>p.value.page=a),"total-visible":n.$vuetify.display.smAndDown?3:5,length:Math.ceil(U.value/p.value.itemsPerPage)},null,8,["modelValue","total-visible","length"])])]),_:1})]),_:1},8,["headers","items","loading","items-per-page","page","options","modelValue"])]),_:1})]),_:1}),o(Q,{modelValue:I.value,"onUpdate:modelValue":e[15]||(e[15]=a=>I.value=a),"max-width":"600px",persistent:""},{default:t(()=>[o(R,null,{default:t(()=>[o(T,{class:"text-h6"},{default:t(()=>[g(m(r(l)==="ar"?"إضافة مكتب جديد":"Add New Office"),1)]),_:1}),o(L,null,{default:t(()=>[o(ie,{onSubmit:se(ae,["prevent"])},{default:t(()=>[o(J,null,{default:t(()=>[o(w,{cols:"12"},{default:t(()=>[o($,{modelValue:i.value.name,"onUpdate:modelValue":e[6]||(e[6]=a=>i.value.name=a),label:r(l)==="ar"?"اسم المكتب":"Office Name",variant:"outlined",required:"",error:r(u).errors.name&&r(u).errors.name.length>0&&r(u).touched.name,"error-messages":r(u).errors.name||[],onBlur:e[7]||(e[7]=a=>r(d)("name"))},null,8,["modelValue","label","error","error-messages"])]),_:1}),o(w,{cols:"12"},{default:t(()=>[o($,{modelValue:i.value.location,"onUpdate:modelValue":e[8]||(e[8]=a=>i.value.location=a),label:r(l)==="ar"?"الموقع":"Location",variant:"outlined",required:"",error:r(u).errors.location&&r(u).errors.location.length>0&&r(u).touched.location,"error-messages":r(u).errors.location||[],onBlur:e[9]||(e[9]=a=>r(d)("location"))},null,8,["modelValue","label","error","error-messages"])]),_:1}),o(w,{cols:"12"},{default:t(()=>[o($,{modelValue:i.value.phoneNumber,"onUpdate:modelValue":e[10]||(e[10]=a=>i.value.phoneNumber=a),label:r(l)==="ar"?"رقم الهاتف":"Phone Number",variant:"outlined",required:"",placeholder:r(l)==="ar"?"091-1234567 أو 021-1234567":"091-1234567 or 021-1234567",error:r(u).errors.phoneNumber&&r(u).errors.phoneNumber.length>0&&r(u).touched.phoneNumber,"error-messages":r(u).errors.phoneNumber||[],onBlur:e[11]||(e[11]=a=>r(d)("phoneNumber")),"prepend-inner-icon":"mdi-phone"},null,8,["modelValue","label","placeholder","error","error-messages"])]),_:1}),o(w,{cols:"12"},{default:t(()=>[o(Ee,{modelValue:i.value.regionId,"onUpdate:modelValue":e[12]||(e[12]=a=>i.value.regionId=a),label:r(l)==="ar"?"المنطقة":"Region",variant:"outlined",items:W.value,"item-title":"name","item-value":"id",loading:j.value,clearable:"","no-data-text":r(l)==="ar"?"لا توجد مناطق متاحة":"No regions available",required:"",error:r(u).errors.regionId&&r(u).errors.regionId.length>0&&r(u).touched.regionId,"error-messages":r(u).errors.regionId||[],onBlur:e[13]||(e[13]=a=>r(d)("regionId")),"prepend-inner-icon":"mdi-map-marker",placeholder:r(l)==="ar"?"اختر المنطقة...":"Select region...","hide-no-data":""},null,8,["modelValue","label","items","loading","no-data-text","error","error-messages","placeholder"])]),_:1})]),_:1})]),_:1})]),_:1}),o(G,null,{default:t(()=>[o(K),o(x,{color:"grey-darken-1",variant:"text",onClick:e[14]||(e[14]=a=>I.value=!1)},{default:t(()=>[g(m(r(l)==="ar"?"إلغاء":"Cancel"),1)]),_:1}),o(x,{color:"primary",variant:"flat",disabled:r(Y),onClick:ae},{default:t(()=>[g(m(r(l)==="ar"?"حفظ":"Save"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(Q,{modelValue:S.value,"onUpdate:modelValue":e[23]||(e[23]=a=>S.value=a),"max-width":"600px",persistent:""},{default:t(()=>[o(R,null,{default:t(()=>[o(T,{class:"text-h6"},{default:t(()=>[g(m(r(l)==="ar"?"تعديل المكتب":"Edit Office"),1)]),_:1}),o(L,null,{default:t(()=>[o(ie,{onSubmit:se(re,["prevent"])},{default:t(()=>[o(J,null,{default:t(()=>[o(w,{cols:"12"},{default:t(()=>[o($,{modelValue:f.value.name,"onUpdate:modelValue":e[16]||(e[16]=a=>f.value.name=a),label:r(l)==="ar"?"اسم المكتب":"Office Name",variant:"outlined",required:"",error:r(u).errors.name&&r(u).errors.name.length>0&&r(u).touched.name,"error-messages":r(u).errors.name||[],onBlur:e[17]||(e[17]=a=>r(d)("name"))},null,8,["modelValue","label","error","error-messages"])]),_:1}),o(w,{cols:"12"},{default:t(()=>[o($,{modelValue:f.value.location,"onUpdate:modelValue":e[18]||(e[18]=a=>f.value.location=a),label:r(l)==="ar"?"الموقع":"Location",variant:"outlined",required:"",error:r(u).errors.location&&r(u).errors.location.length>0&&r(u).touched.location,"error-messages":r(u).errors.location||[],onBlur:e[19]||(e[19]=a=>r(d)("location"))},null,8,["modelValue","label","error","error-messages"])]),_:1}),o(w,{cols:"12"},{default:t(()=>[o($,{modelValue:f.value.phoneNumber,"onUpdate:modelValue":e[20]||(e[20]=a=>f.value.phoneNumber=a),label:r(l)==="ar"?"رقم الهاتف":"Phone Number",variant:"outlined",required:"",placeholder:r(l)==="ar"?"091-1234567 أو 021-1234567":"091-1234567 or 021-1234567",error:r(u).errors.phoneNumber&&r(u).errors.phoneNumber.length>0&&r(u).touched.phoneNumber,"error-messages":r(u).errors.phoneNumber||[],onBlur:e[21]||(e[21]=a=>r(d)("phoneNumber")),"prepend-inner-icon":"mdi-phone"},null,8,["modelValue","label","placeholder","error","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1}),o(G,null,{default:t(()=>[o(K),o(x,{color:"grey-darken-1",variant:"text",onClick:e[22]||(e[22]=a=>S.value=!1)},{default:t(()=>[g(m(r(l)==="ar"?"إلغاء":"Cancel"),1)]),_:1}),o(x,{color:"primary",variant:"flat",disabled:r(Y),onClick:re},{default:t(()=>[g(m(r(l)==="ar"?"تحديث":"Update"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(Q,{modelValue:P.value,"onUpdate:modelValue":e[25]||(e[25]=a=>P.value=a),"max-width":"400px"},{default:t(()=>[o(R,null,{default:t(()=>[o(T,{class:"text-h6"},{default:t(()=>[g(m(r(l)==="ar"?"تأكيد الحذف":"Confirm Delete"),1)]),_:1}),o(L,null,{default:t(()=>{var a,O;return[g(m(r(l)==="ar"?`هل أنت متأكد من حذف المكتب "${(a=A.value)==null?void 0:a.name}"؟`:`Are you sure you want to delete the office "${(O=A.value)==null?void 0:O.name}"?`)+" ",1),e[26]||(e[26]=V("br",null,null,-1)),V("span",Re,m(r(l)==="ar"?"لا يمكن التراجع عن هذا الإجراء.":"This action cannot be undone."),1)]}),_:1}),o(G,null,{default:t(()=>[o(K),o(x,{color:"grey-darken-1",variant:"text",onClick:e[24]||(e[24]=a=>P.value=!1)},{default:t(()=>[g(m(r(l)==="ar"?"إلغاء":"Cancel"),1)]),_:1}),o(x,{color:"error",variant:"flat",onClick:fe},{default:t(()=>[g(m(r(l)==="ar"?"حذف":"Delete"),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Sa=Ie(ze,[["__scopeId","data-v-c5ebb945"]]);export{Sa as default};
