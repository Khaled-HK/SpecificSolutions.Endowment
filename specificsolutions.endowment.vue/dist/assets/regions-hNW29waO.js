import{a$ as ie,r as s,w as X,R as re,G as ne,c as H,o as S,b as t,e as l,d as r,f as J,l as se,ac as p,t as i,v as d,V as T,aX as K}from"./index-BxwAfQkT.js";import{$ as V}from"./api-BlPHAWrV.js";import{b as $,V as C,d as L}from"./VCard-HyXZyDus.js";import{V as ue}from"./VDivider-dlsVqP_0.js";import{V as P}from"./VCardText-Br0ga3MS.js";import{V as j}from"./VTextField-DLVA8t43.js";import{V as R}from"./VChip-f5OQAicY.js";import{V as de}from"./VDataTable-CHlY3u6Q.js";import{V as me}from"./VSkeletonLoader-DF2q8GUJ.js";import{V as Q}from"./VTooltip-DGd4_r-D.js";import{V as pe}from"./VAvatar-D3B_nxVk.js";import{V as W}from"./VForm-DELEx_eG.js";import{V as Y,a as x}from"./VRow-IwBDz7dS.js";import{V as D}from"./VAutocomplete-COiH59-r.js";import{V as F}from"./VSpacer-D4svgG4Z.js";import{V as M}from"./VDialog-BS2QXLpG.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-9rIf2CJL.js";import"./VImg-BT79GK2N.js";/* empty css                   */import"./VCounter-BdYhf-Om.js";import"./VField-CyDYyo9M.js";import"./form-Cj7OF8p3.js";import"./easing-CjukEv2V.js";import"./VInput-CNsmzGuX.js";import"./forwardRefs-C-GTDzx5.js";import"./VSlideGroup-DvcRT41v.js";import"./VPagination-HckcPxXH.js";import"./VSelect-DoadpF38.js";import"./VList-BP2-hg8N.js";import"./ssrBoot-DvjDMfT0.js";import"./dialog-transition-DafKXV6Y.js";import"./VMenu-rpR6rdaV.js";import"./VOverlay-fD4UOiBQ.js";import"./delay-9MEqzfDp.js";import"./lazy-B7tRog-k.js";import"./scopeId-0T8ViwWo.js";import"./VCheckboxBtn-BC6qpP35.js";import"./VSelectionControl-CauPX6_L.js";import"./VTable-DFhJIg5F.js";import"./filter-DIHmHdLn.js";/* empty css              */const fe={class:"d-flex gap-2"},ge={class:"d-flex justify-space-between align-center mb-4"},ye={class:"d-flex align-center gap-4"},ce={class:"d-flex align-center"},Ve={class:"text-body-1 font-weight-medium"},xe={class:"text-body-2",style:{"max-width":"350px"}},be={key:1,class:"text-medium-emphasis"},we={class:"d-flex gap-1 justify-center"},ke={class:"text-center py-8"},Ce=ie({__name:"regions",setup(Pe){const z=s([]),U=s([]),B=s([]),q=s(!1),c=s(!1),f=s(0),g=s(0),b=s(!1),w=s(!1),k=s(!1),I=s(null),y=s([]),E=s(""),m=s({name:"",country:"",cityId:""}),u=s({id:0,key:"",value:"",name:"",description:"",cityId:""}),Z=[{title:"Name",key:"name",sortable:!0,sticky:!0,width:250},{title:"Country",key:"country",sortable:!0,width:400},{title:"Actions",key:"actions",sortable:!1,sticky:!0,width:120,align:"center"}],n=s({page:1,itemsPerPage:10,sortBy:[{key:"name",order:"asc"}]}),v=async()=>{q.value=!0;try{const o=new URLSearchParams({PageNumber:n.value.page.toString(),PageSize:n.value.itemsPerPage.toString(),SearchTerm:E.value||""}),e=await V(`/Region/filter?${o}`);z.value=e.data.items||[],e.data&&(f.value=e.data.totalCount||0,g.value=e.data.totalPages||0,n.value.page>g.value&&g.value>0&&(n.value.page=g.value,await v()))}catch(o){console.error("Error loading regions:",o),z.value=[],f.value=0,g.value=0}finally{q.value=!1}},_=async()=>{c.value=!0;try{const o=await V("/City/filter?PageSize=100");U.value=o.data.items||[];const e=[...new Set(U.value.map(a=>a.country).filter(Boolean))];B.value=e.sort()}catch(o){console.error("Error loading cities:",o)}finally{c.value=!1}},O=async()=>{try{await V("/Region",{method:"POST",body:{name:m.value.name,country:m.value.country,cityId:m.value.cityId}}),b.value=!1,ae(),v()}catch(o){console.error("Error adding region:",o)}},G=async()=>{try{await V(`/Region/${u.value.id}`,{method:"PUT",body:{id:u.value.id,name:u.value.name,country:u.value.country||u.value.description,cityId:u.value.cityId}}),w.value=!1,v()}catch(o){console.error("Error updating region:",o)}},h=async()=>{if(I.value)try{await V(`/Region/${I.value.id}`,{method:"DELETE"}),k.value=!1,v()}catch(o){console.error("Error deleting region:",o)}},ee=async()=>{if(y.value.length!==0)try{const o=y.value.map(e=>V(`/Region/${e.id}`,{method:"DELETE"}));await Promise.all(o),y.value=[],v()}catch(o){console.error("Error deleting selected regions:",o)}},te=o=>{u.value={...o,country:o.country||o.description||""},w.value=!0},le=o=>{I.value=o,k.value=!0},ae=()=>{m.value={name:"",country:"",cityId:""}};X([()=>n.value.page,()=>n.value.itemsPerPage],()=>{v()},{immediate:!1});const N=re(()=>{const o=(n.value.page-1)*n.value.itemsPerPage+1,e=Math.min(n.value.page*n.value.itemsPerPage,f.value);return{start:o,end:e,total:f.value,currentPage:n.value.page,totalPages:g.value}});let A=null;return X(E,()=>{n.value.page=1,A&&clearTimeout(A),A=setTimeout(()=>{v()},500)},{immediate:!1}),ne(()=>{v(),_()}),(o,e)=>(S(),H("div",null,[t(C,null,{default:l(()=>[t($,{class:"d-flex justify-space-between align-center pa-6"},{default:l(()=>[e[19]||(e[19]=r("span",{class:"text-h5"},"إدارة المناطق - جدول بأعمدة ثابتة",-1)),r("div",fe,[y.value.length>0?(S(),J(p,{key:0,color:"error",variant:"outlined",onClick:ee},{default:l(()=>[i(" حذف المحدد ("+d(y.value.length)+") ",1)]),_:1})):se("",!0),t(p,{color:"primary",onClick:e[0]||(e[0]=a=>b.value=!0)},{default:l(()=>e[18]||(e[18]=[i(" إضافة منطقة ")])),_:1})])]),_:1}),t(ue),t(P,null,{default:l(()=>[r("div",ge,[t(j,{modelValue:E.value,"onUpdate:modelValue":e[1]||(e[1]=a=>E.value=a),"prepend-inner-icon":"mdi-magnify",label:"البحث في المناطق...",variant:"outlined",density:"compact",style:{"max-width":"300px"},"hide-details":"",clearable:"",placeholder:"ابحث عن منطقة..."},null,8,["modelValue"]),t(R,{color:"success",variant:"tonal","prepend-icon":"mdi-table-column"},{default:l(()=>e[20]||(e[20]=[i(" الأعمدة الثابتة نشطة ✓ ")])),_:1}),r("div",ye,[t(R,{color:"info",variant:"tonal",size:"small"},{default:l(()=>[i(" المجموع: "+d(f.value)+" منطقة ",1)]),_:1}),t(R,{color:"primary",variant:"tonal",size:"small"},{default:l(()=>[i(" الصفحة "+d(n.value.page)+" من "+d(g.value),1)]),_:1}),t(R,{color:"success",variant:"tonal",size:"small"},{default:l(()=>[i(" عرض "+d(N.value.start)+"-"+d(N.value.end)+" من "+d(N.value.total),1)]),_:1})])]),t(de,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=a=>y.value=a),page:n.value.page,"onUpdate:page":e[3]||(e[3]=a=>n.value.page=a),"items-per-page":n.value.itemsPerPage,"onUpdate:itemsPerPage":e[4]||(e[4]=a=>n.value.itemsPerPage=a),"sort-by":n.value.sortBy,"onUpdate:sortBy":e[5]||(e[5]=a=>n.value.sortBy=a),headers:Z,items:z.value,loading:q.value,class:"elevation-1 text-no-wrap fixed-columns-table","item-value":"id","show-select":"","fixed-header":"",height:"600",hover:"",density:"compact","items-per-page-options":[5,10,25,50,100],"show-current-page":"","show-items-per-page":"","items-length":f.value,"server-items-length":f.value,"footer-props":{"items-per-page-options":[5,10,25,50,100],"items-per-page-text":"عناصر في الصفحة:","page-text":"{0}-{1} من {2}","first-icon":"mdi-page-first","last-icon":"mdi-page-last","prev-icon":"mdi-chevron-left","next-icon":"mdi-chevron-right"},"loading-text":"جاري التحميل...","no-data-text":"لا توجد بيانات","no-results-text":"لا توجد نتائج للبحث"},{"item.name":l(({item:a})=>[r("div",ce,[t(pe,{color:"primary",variant:"tonal",size:"32",class:"me-3"},{default:l(()=>[i(d(a.name.charAt(0).toUpperCase()),1)]),_:2},1024),r("div",null,[r("div",Ve,d(a.name),1)])])]),"item.country":l(({item:a})=>[r("div",xe,[a.country?(S(),J(R,{key:0,color:"secondary",variant:"tonal",size:"small"},{default:l(()=>[i(d(a.country),1)]),_:2},1024)):(S(),H("span",be," لا توجد دولة "))])]),"item.actions":l(({item:a})=>[r("div",we,[t(p,{icon:"mdi-pencil",size:"small",color:"primary",variant:"text",onClick:oe=>te(a)},{default:l(()=>[t(T,null,{default:l(()=>e[21]||(e[21]=[i("mdi-pencil")])),_:1}),t(Q,{activator:"parent",location:"top"},{default:l(()=>e[22]||(e[22]=[i(" تعديل ")])),_:1})]),_:2},1032,["onClick"]),t(p,{icon:"mdi-delete",size:"small",color:"error",variant:"text",onClick:oe=>le(a)},{default:l(()=>[t(T,null,{default:l(()=>e[23]||(e[23]=[i("mdi-delete")])),_:1}),t(Q,{activator:"parent",location:"top"},{default:l(()=>e[24]||(e[24]=[i(" حذف ")])),_:1})]),_:2},1032,["onClick"])])]),loading:l(()=>[t(me,{class:"mx-auto","max-width":"100%",type:"table-row@10"})]),"no-data":l(()=>[r("div",ke,[t(T,{size:"64",color:"grey-lighten-2",class:"mb-4"},{default:l(()=>e[25]||(e[25]=[i(" mdi-table-search ")])),_:1}),e[26]||(e[26]=r("div",{class:"text-h6 text-medium-emphasis"}," لا توجد مناطق ",-1)),e[27]||(e[27]=r("div",{class:"text-body-2 text-medium-emphasis"}," جرب تعديل البحث أو إضافة منطقة جديدة ",-1))])]),"footer.prepend":l(()=>e[28]||(e[28]=[r("div",{class:"d-flex align-center gap-2"},[r("span",{class:"text-caption"},"عناصر في الصفحة:")],-1)])),_:1},8,["modelValue","page","items-per-page","sort-by","items","loading","items-length","server-items-length"]),t(C,{class:"mt-4",color:"info",variant:"tonal"},{default:l(()=>[t(P,{class:"d-flex align-center gap-3"},{default:l(()=>[t(T,null,{default:l(()=>e[29]||(e[29]=[i("mdi-information")])),_:1}),e[30]||(e[30]=r("div",null,[r("div",{class:"text-body-2 font-weight-medium"}," الأعمدة الثابتة (Fixed Columns) مع البحث التلقائي "),r("div",{class:"text-caption"}," أعمدة الرقم والاسم والإجراءات ثابتة ولا تتحرك عند التمرير الأفقي. يمكن البحث في الجدول والكتابة في قائمة الدول المنسدلة. ")],-1))]),_:1})]),_:1})]),_:1})]),_:1}),t(M,{modelValue:b.value,"onUpdate:modelValue":e[10]||(e[10]=a=>b.value=a),"max-width":"600px",persistent:""},{default:l(()=>[t(C,null,{default:l(()=>[t($,{class:"text-h6"},{default:l(()=>e[31]||(e[31]=[i("إضافة منطقة جديدة")])),_:1}),t(P,null,{default:l(()=>[t(W,{onSubmit:K(O,["prevent"])},{default:l(()=>[t(Y,null,{default:l(()=>[t(x,{cols:"12"},{default:l(()=>[t(j,{modelValue:m.value.name,"onUpdate:modelValue":e[6]||(e[6]=a=>m.value.name=a),label:"اسم المنطقة",variant:"outlined",required:"",rules:[a=>!!a||"اسم المنطقة مطلوب"]},null,8,["modelValue","rules"])]),_:1}),t(x,{cols:"12"},{default:l(()=>[t(D,{modelValue:m.value.cityId,"onUpdate:modelValue":e[7]||(e[7]=a=>m.value.cityId=a),label:"المدينة",variant:"outlined",items:U.value,"item-title":"name","item-value":"id",loading:c.value,clearable:"","no-data-text":"لا توجد مدن متاحة",required:"",rules:[a=>!!a||"المدينة مطلوبة"],"prepend-inner-icon":"mdi-city",placeholder:"اختر المدينة...","hide-no-data":""},null,8,["modelValue","items","loading","rules"])]),_:1}),t(x,{cols:"12"},{default:l(()=>[t(D,{modelValue:m.value.country,"onUpdate:modelValue":e[8]||(e[8]=a=>m.value.country=a),label:"الدولة",variant:"outlined",items:B.value,loading:c.value,clearable:"","no-data-text":"لا توجد دول متاحة",required:"",rules:[a=>!!a||"الدولة مطلوبة"],"prepend-inner-icon":"mdi-magnify",placeholder:"ابحث عن دولة...","hide-no-data":""},null,8,["modelValue","items","loading","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),t(L,null,{default:l(()=>[t(F),t(p,{color:"grey-darken-1",variant:"text",onClick:e[9]||(e[9]=a=>b.value=!1)},{default:l(()=>e[32]||(e[32]=[i(" إلغاء ")])),_:1}),t(p,{color:"primary",variant:"flat",onClick:O},{default:l(()=>e[33]||(e[33]=[i(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(M,{modelValue:w.value,"onUpdate:modelValue":e[15]||(e[15]=a=>w.value=a),"max-width":"600px",persistent:""},{default:l(()=>[t(C,null,{default:l(()=>[t($,{class:"text-h6"},{default:l(()=>e[34]||(e[34]=[i("تعديل المنطقة")])),_:1}),t(P,null,{default:l(()=>[t(W,{onSubmit:K(G,["prevent"])},{default:l(()=>[t(Y,null,{default:l(()=>[t(x,{cols:"12"},{default:l(()=>[t(j,{modelValue:u.value.name,"onUpdate:modelValue":e[11]||(e[11]=a=>u.value.name=a),label:"اسم المنطقة",variant:"outlined",required:"",rules:[a=>!!a||"اسم المنطقة مطلوب"]},null,8,["modelValue","rules"])]),_:1}),t(x,{cols:"12"},{default:l(()=>[t(D,{modelValue:u.value.cityId,"onUpdate:modelValue":e[12]||(e[12]=a=>u.value.cityId=a),label:"المدينة",variant:"outlined",items:U.value,"item-title":"name","item-value":"id",loading:c.value,clearable:"","no-data-text":"لا توجد مدن متاحة",required:"",rules:[a=>!!a||"المدينة مطلوبة"],"prepend-inner-icon":"mdi-city",placeholder:"اختر المدينة...","hide-no-data":""},null,8,["modelValue","items","loading","rules"])]),_:1}),t(x,{cols:"12"},{default:l(()=>[t(D,{modelValue:u.value.country,"onUpdate:modelValue":e[13]||(e[13]=a=>u.value.country=a),label:"الدولة",variant:"outlined",items:B.value,loading:c.value,clearable:"","no-data-text":"لا توجد دول متاحة",required:"",rules:[a=>!!a||"الدولة مطلوبة"],"prepend-inner-icon":"mdi-magnify",placeholder:"ابحث عن دولة...","hide-no-data":""},null,8,["modelValue","items","loading","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),t(L,null,{default:l(()=>[t(F),t(p,{color:"grey-darken-1",variant:"text",onClick:e[14]||(e[14]=a=>w.value=!1)},{default:l(()=>e[35]||(e[35]=[i(" إلغاء ")])),_:1}),t(p,{color:"primary",variant:"flat",onClick:G},{default:l(()=>e[36]||(e[36]=[i(" تحديث ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(M,{modelValue:k.value,"onUpdate:modelValue":e[17]||(e[17]=a=>k.value=a),"max-width":"400px"},{default:l(()=>[t(C,null,{default:l(()=>[t($,{class:"text-h6"},{default:l(()=>e[37]||(e[37]=[i("تأكيد الحذف")])),_:1}),t(P,null,{default:l(()=>{var a;return[e[38]||(e[38]=i(' هل أنت متأكد من حذف المنطقة "')),r("strong",null,d((a=I.value)==null?void 0:a.value),1),e[39]||(e[39]=i('"؟ ')),e[40]||(e[40]=r("br",null,null,-1)),e[41]||(e[41]=r("span",{class:"text-error"},"لا يمكن التراجع عن هذا الإجراء.",-1))]}),_:1}),t(L,null,{default:l(()=>[t(F),t(p,{color:"grey-darken-1",variant:"text",onClick:e[16]||(e[16]=a=>k.value=!1)},{default:l(()=>e[42]||(e[42]=[i(" إلغاء ")])),_:1}),t(p,{color:"error",variant:"flat",onClick:h},{default:l(()=>e[43]||(e[43]=[i(" حذف ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),vt=ve(Ce,[["__scopeId","data-v-21909697"]]);export{vt as default};
