import{$ as U}from"./api-Yee635Cw.js";import{V as y}from"./VCardText-D3qn0xVt.js";import{V as P}from"./VSpacer-DK1R1B3V.js";import{aZ as W,r as s,w as L,D as X,f as Y,o as _,e as a,b as t,d as v,aa as f,s as d,t as V}from"./index-B2yH2wlm.js";import{V as h}from"./VDivider-IJOr89EA.js";import{V as E,a as g}from"./VRow-D_lBkBiQ.js";import{V as N}from"./VTextField-Bsi5YaIU.js";import{V as ee}from"./VDataTable-xmUF_rxc.js";import{V as I}from"./VChip-zFsRdrE0.js";import{V as le}from"./VAvatar-CShMG6gm.js";import{V as z}from"./VDialog-B5IthHHF.js";import{V as $,b as B,d as q}from"./VCard-CbXeyWRM.js";import{V as O}from"./VContainer-Cjj3jwcN.js";import{V as j}from"./VTextarea-BOmbQ_dF.js";import{V as te}from"./VSnackbar-DYOt6puD.js";import"./index-9rIf2CJL.js";/* empty css              *//* empty css                   */import"./VCounter-D0OrblNh.js";import"./VImg-LCEu9fG5.js";import"./VField-BS4jWEZX.js";import"./form-CrJ5wAnD.js";import"./easing-CjukEv2V.js";import"./VInput-BBUwaJU8.js";import"./forwardRefs-C-GTDzx5.js";import"./VPagination-D22GyUdV.js";import"./VSelect-Djzs4lEs.js";import"./VList-BP_s4Rd6.js";import"./ssrBoot-BM3_9gcl.js";import"./dialog-transition-B1F2T2U2.js";import"./VMenu-sVHB4BSf.js";import"./VOverlay-DatZLL7h.js";import"./delay-D2xRnafG.js";import"./lazy-CIM2OltQ.js";import"./scopeId-Bz1iMFsM.js";import"./VCheckboxBtn-BIPGNd9w.js";import"./VSelectionControl-BRBkIS9Q.js";import"./VTable-BeF_b8U_.js";import"./filter-CiRrM1UE.js";import"./VSlideGroup-xF0vztaY.js";const ae={class:"d-flex align-center"},re={class:"d-flex flex-column ms-3"},oe={class:"d-block font-weight-medium text-truncate text-high-emphasis"},ue={class:"text-medium-emphasis"},Qe=W({__name:"decisions",setup(se){const M=s([]),T=s(!1),C=s(0),u=s(!1),i=s(""),n=s("success"),D=s(!1),x=s(!1),k=s(!1),w=s(null),A=s([]),S=s(""),o=s({title:"",description:"",referenceNumber:""}),m=s({id:0,key:"",value:"",title:"",description:"",referenceNumber:"",createdDate:""}),p=s({page:1,itemsPerPage:10,sortBy:[""],sortDesc:[!1]}),F=[{title:"عنوان القرار",key:"title"},{title:"رقم المرجع",key:"referenceNumber"},{title:"الوصف",key:"description"},{title:"تاريخ الإنشاء",key:"createdDate"},{title:"الإجراءات",key:"actions",sortable:!1}],c=async()=>{T.value=!0;try{const r=new URLSearchParams({PageNumber:p.value.page.toString(),PageSize:p.value.itemsPerPage.toString(),SearchTerm:S.value||""}),e=await U(`/Decision/filter?${r}`);if(M.value=e.data.items||[],e.data){C.value=e.data.totalCount||0;const l=Math.ceil(C.value/p.value.itemsPerPage);p.value.page>l&&l>0&&(p.value.page=l,await c())}}catch(r){console.error("Error loading decisions:",r),i.value="حدث خطأ أثناء تحميل القرارات",n.value="error",u.value=!0,M.value=[],C.value=0}finally{T.value=!1}},Z=async()=>{if(!o.value.title||o.value.title.trim()===""){i.value="عنوان القرار مطلوب.",n.value="error",u.value=!0;return}if(!o.value.description||o.value.description.trim()===""){i.value="وصف القرار مطلوب.",n.value="error",u.value=!0;return}if(!o.value.referenceNumber||o.value.referenceNumber.trim()===""){i.value="رقم المرجع مطلوب.",n.value="error",u.value=!0;return}try{const r={title:o.value.title.trim(),description:o.value.description.trim(),referenceNumber:o.value.referenceNumber.trim(),createdDate:new Date().toISOString()};console.log("Sending decision data:",r);const e=await U("/Decision",{method:"POST",body:r});if(console.log("Response received:",e),e&&e.isSuccess===!1){let l="حدث خطأ أثناء إضافة القرار";e.errors&&e.errors.length>0?l=`الحقول المطلوبة:
${e.errors.map(R=>`${R.propertyName}: ${R.errorMessage}`).join(`
`)}`:e.message&&(l=e.message),i.value=l,n.value="error",u.value=!0;return}D.value=!1,Q(),c(),i.value="تم إضافة القرار بنجاح",n.value="success",u.value=!0}catch(r){console.error("Error adding decision:",r),i.value="حدث خطأ أثناء إضافة القرار",n.value="error",u.value=!0}},G=async()=>{var r,e;try{const l=await U(`/Decision/${m.value.id}`,{method:"PUT",body:{id:m.value.id,title:m.value.title,description:m.value.description,referenceNumber:m.value.referenceNumber}});if(l&&l.isSuccess===!1){const b=l.message||((e=(r=l.errors)==null?void 0:r[0])==null?void 0:e.errorMessage)||"حدث خطأ أثناء تحديث القرار";i.value=b,n.value="error",u.value=!0;return}x.value=!1,c(),i.value="تم تحديث القرار بنجاح",n.value="success",u.value=!0}catch(l){console.error("Error updating decision:",l),i.value="حدث خطأ أثناء تحديث القرار",n.value="error",u.value=!0}},H=async()=>{var r,e;if(w.value)try{const l=await U(`/Decision/${w.value.id}`,{method:"DELETE"});if(l&&l.isSuccess===!1){const b=l.message||((e=(r=l.errors)==null?void 0:r[0])==null?void 0:e.errorMessage)||"حدث خطأ أثناء حذف القرار";i.value=b,n.value="error",u.value=!0;return}k.value=!1,w.value=null,c(),i.value="تم حذف القرار بنجاح",n.value="success",u.value=!0}catch(l){console.error("Error deleting decision:",l),i.value="حدث خطأ أثناء حذف القرار",n.value="error",u.value=!0}},J=r=>{m.value={...r},x.value=!0},K=r=>{w.value=r,k.value=!0},Q=()=>{o.value={title:"",description:"",referenceNumber:""}};return L(p,()=>{c()},{deep:!0}),L(S,()=>{p.value.page=1,c()}),X(()=>{c()}),(r,e)=>(_(),Y($,null,{default:a(()=>[t(y,{class:"d-flex align-center flex-wrap gap-4"},{default:a(()=>[e[18]||(e[18]=v("div",{class:"me-3"},[v("h4",{class:"text-h4"}," إدارة القرارات "),v("p",{class:"mb-0"}," عرض وإدارة القرارات في النظام ")],-1)),t(P),t(f,{"prepend-icon":"tabler-plus",onClick:e[0]||(e[0]=l=>D.value=!0)},{default:a(()=>e[17]||(e[17]=[d(" إضافة قرار جديد ")])),_:1})]),_:1}),t(h),t(y,null,{default:a(()=>[t(E,null,{default:a(()=>[t(g,{cols:"12",sm:"4"},{default:a(()=>[t(N,{modelValue:S.value,"onUpdate:modelValue":e[1]||(e[1]=l=>S.value=l),"prepend-inner-icon":"tabler-search",label:"البحث في القرارات","single-line":"","hide-details":"",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(ee,{modelValue:A.value,"onUpdate:modelValue":e[2]||(e[2]=l=>A.value=l),headers:F,items:M.value,loading:T.value,"items-per-page":p.value.itemsPerPage,page:p.value.page,total:C.value,class:"text-no-wrap","onUpdate:options":e[3]||(e[3]=l=>p.value=l)},{"item.title":a(({item:l})=>[v("div",ae,[t(le,{size:"32",color:"primary",variant:"tonal"},{default:a(()=>[d(V(l.title.charAt(0).toUpperCase()),1)]),_:2},1024),v("div",re,[v("span",oe,V(l.title),1)])])]),"item.referenceNumber":a(({item:l})=>[t(I,{color:l.referenceNumber?"success":"warning",size:"small"},{default:a(()=>[d(V(l.referenceNumber||"لا يوجد رقم مرجعي"),1)]),_:2},1032,["color"])]),"item.description":a(({item:l})=>[v("span",ue,V(l.description||"لا يوجد وصف"),1)]),"item.createdDate":a(({item:l})=>[t(I,{color:"info",size:"small"},{default:a(()=>[d(V(new Date(l.createdDate).toLocaleDateString("ar-SA")),1)]),_:2},1024)]),"item.actions":a(({item:l})=>[t(f,{icon:"tabler-edit",variant:"text",size:"small",color:"primary",onClick:b=>J(l)},null,8,["onClick"]),t(f,{icon:"tabler-trash",variant:"text",size:"small",color:"error",onClick:b=>K(l)},null,8,["onClick"])]),_:1},8,["modelValue","items","loading","items-per-page","page","total"]),t(z,{modelValue:D.value,"onUpdate:modelValue":e[8]||(e[8]=l=>D.value=l),"max-width":"500px"},{default:a(()=>[t($,null,{default:a(()=>[t(B,null,{default:a(()=>e[19]||(e[19]=[v("span",{class:"text-h5"},"إضافة قرار جديد",-1)])),_:1}),t(y,null,{default:a(()=>[t(O,null,{default:a(()=>[t(E,null,{default:a(()=>[t(g,{cols:"12"},{default:a(()=>[t(N,{modelValue:o.value.title,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.title=l),label:"عنوان القرار",required:""},null,8,["modelValue"])]),_:1}),t(g,{cols:"12"},{default:a(()=>[t(N,{modelValue:o.value.referenceNumber,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.referenceNumber=l),label:"رقم المرجع",required:""},null,8,["modelValue"])]),_:1}),t(g,{cols:"12"},{default:a(()=>[t(j,{modelValue:o.value.description,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.description=l),label:"الوصف",rows:"3"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(q,null,{default:a(()=>[t(P),t(f,{color:"blue-darken-1",variant:"text",onClick:e[7]||(e[7]=l=>D.value=!1)},{default:a(()=>e[20]||(e[20]=[d(" إلغاء ")])),_:1}),t(f,{color:"blue-darken-1",onClick:Z},{default:a(()=>e[21]||(e[21]=[d(" إضافة ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(z,{modelValue:x.value,"onUpdate:modelValue":e[13]||(e[13]=l=>x.value=l),"max-width":"500px"},{default:a(()=>[t($,null,{default:a(()=>[t(B,null,{default:a(()=>e[22]||(e[22]=[v("span",{class:"text-h5"},"تعديل القرار",-1)])),_:1}),t(y,null,{default:a(()=>[t(O,null,{default:a(()=>[t(E,null,{default:a(()=>[t(g,{cols:"12"},{default:a(()=>[t(N,{modelValue:m.value.title,"onUpdate:modelValue":e[9]||(e[9]=l=>m.value.title=l),label:"عنوان القرار",required:""},null,8,["modelValue"])]),_:1}),t(g,{cols:"12"},{default:a(()=>[t(N,{modelValue:m.value.referenceNumber,"onUpdate:modelValue":e[10]||(e[10]=l=>m.value.referenceNumber=l),label:"رقم المرجع",required:""},null,8,["modelValue"])]),_:1}),t(g,{cols:"12"},{default:a(()=>[t(j,{modelValue:m.value.description,"onUpdate:modelValue":e[11]||(e[11]=l=>m.value.description=l),label:"الوصف",rows:"3"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(q,null,{default:a(()=>[t(P),t(f,{color:"blue-darken-1",variant:"text",onClick:e[12]||(e[12]=l=>x.value=!1)},{default:a(()=>e[23]||(e[23]=[d(" إلغاء ")])),_:1}),t(f,{color:"blue-darken-1",onClick:G},{default:a(()=>e[24]||(e[24]=[d(" تحديث ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(z,{modelValue:k.value,"onUpdate:modelValue":e[15]||(e[15]=l=>k.value=l),"max-width":"400px"},{default:a(()=>[t($,null,{default:a(()=>[t(B,{class:"text-h5"},{default:a(()=>e[25]||(e[25]=[d(" تأكيد الحذف ")])),_:1}),t(y,null,{default:a(()=>{var l;return[d(' هل أنت متأكد من حذف القرار "'+V((l=w.value)==null?void 0:l.title)+'"؟ ',1),e[26]||(e[26]=v("br",null,null,-1)),e[27]||(e[27]=v("strong",null,"لا يمكن التراجع عن هذا الإجراء.",-1))]}),_:1}),t(q,null,{default:a(()=>[t(P),t(f,{color:"blue-darken-1",variant:"text",onClick:e[14]||(e[14]=l=>k.value=!1)},{default:a(()=>e[28]||(e[28]=[d(" إلغاء ")])),_:1}),t(f,{color:"error",onClick:H},{default:a(()=>e[29]||(e[29]=[d(" حذف ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(te,{modelValue:u.value,"onUpdate:modelValue":e[16]||(e[16]=l=>u.value=l),color:n.value,timeout:3e3},{default:a(()=>[d(V(i.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}});export{Qe as default};
