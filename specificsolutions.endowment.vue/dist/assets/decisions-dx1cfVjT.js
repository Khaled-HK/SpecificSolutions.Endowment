import{u as ce}from"./useFormValidation--K-9QZRo.js";import{$ as A}from"./api-BL_tVZq2.js";import{V as me}from"./VAlert-Bt6ZrLfv.js";import{b as M,V as I,d as H}from"./VCard-CIvz8ijW.js";import{aZ as ve,r as p,aL as fe,P as pe,w as Q,D as ge,a as be,c as W,o as U,f as j,l as X,b as l,e as s,s as g,t as u,d as D,m as r,aa as h,V as Y,F as Ve}from"./index-CK1fpvPu.js";import{V as De}from"./VDivider-n3wzZ4nA.js";import{V as T}from"./VCardText-BSu9PeVr.js";import{V as O,a as w}from"./VRow-Dcd2HQbw.js";import{V as B}from"./VTextField-DGy7sZcW.js";import{V as Ne}from"./VDataTable-DFEIpKEL.js";import{V as ye}from"./VSelect-CBg7jvEh.js";import{V as he}from"./VPagination-DdfcFOFW.js";import{V as ee}from"./VChip-DVJAFn6v.js";import{V as we}from"./VAvatar-CA9yN-sZ.js";import{V as re}from"./VContainer-D300hw9v.js";import{V as le}from"./VTextarea-BnzgekST.js";import{V as Z}from"./VSpacer-BvuZd4xP.js";import{V as G}from"./VDialog-CjDVagY9.js";import"./index-9rIf2CJL.js";import"./VImg-CGrxDryJ.js";/* empty css              *//* empty css                   */import"./VCounter-B1fUDCB4.js";import"./VField-DG_UKZ_N.js";import"./form-BFxad-Fs.js";import"./easing-CjukEv2V.js";import"./VInput-ktq1dKao.js";import"./forwardRefs-C-GTDzx5.js";import"./VCheckboxBtn-B3kpR2xa.js";import"./VSelectionControl-Ell3Bz42.js";import"./VTable-C9PhsU1j.js";import"./filter-D4hCb-IW.js";import"./VList-CKihbX_m.js";import"./ssrBoot-CzZBr7mp.js";import"./dialog-transition-f96dZRyR.js";import"./VMenu-D7_JD2eI.js";import"./VOverlay-DxyOEWWl.js";import"./delay-BJjrXP-f.js";import"./lazy-Dt_oego-.js";import"./scopeId-DrUTg5WU.js";import"./VSlideGroup-CXxg8nxX.js";const xe={class:"text-h5"},ke={class:"d-flex gap-2"},_e={class:"d-flex align-center"},Ce={class:"d-flex flex-column ms-3"},Ee={class:"d-block font-weight-medium text-truncate text-high-emphasis"},Pe={class:"text-medium-emphasis"},Se={key:1,class:"text-medium-emphasis"},$e={class:"text-medium-emphasis"},Ae={class:"d-flex gap-1"},Ue={class:"d-flex flex-wrap justify-center justify-sm-space-between gap-y-2 mt-2"},Te={class:"text-h5"},Be={class:"text-h5"},xr=ve({__name:"decisions",setup(Re){const z=p([]),F=p(!1),R=p(0),b=p(!1),V=p(""),v=p("success"),C=p(!1),E=p(!1),P=p(!1),x=p(null),N=p([]),q=p(""),m=p({title:"",description:"",referenceNumber:""}),d=p({id:0,key:"",value:"",title:"",description:"",referenceNumber:"",createdDate:""}),{validationState:i,setErrorsFromResponse:J,clearErrors:S,hasErrors:K,setFieldTouched:c,validateRequired:k,validateLength:_}=ce(),{t:$,locale:a}=fe(),f=p({page:1,itemsPerPage:10,sortBy:[""],sortDesc:[!1]}),ae=pe(()=>[{title:$("tableHeaders.decisions.title"),key:"title"},{title:$("tableHeaders.decisions.referenceNumber"),key:"referenceNumber"},{title:$("tableHeaders.decisions.description"),key:"description"},{title:$("tableHeaders.decisions.createdDate"),key:"createdDate"},{title:$("tableHeaders.decisions.actions"),key:"actions",sortable:!1}]),y=async()=>{F.value=!0;try{const o=new URLSearchParams({PageNumber:f.value.page.toString(),PageSize:f.value.itemsPerPage.toString(),SearchTerm:q.value||""}),e=await A(`/Decision/filter?${o}`,{headers:{"Accept-Language":a.value}});if(z.value=e.data.items||[],e.data){R.value=e.data.totalCount||0;const n=Math.ceil(R.value/f.value.itemsPerPage);f.value.page>n&&n>0&&(f.value.page=n,await y())}}catch(o){console.error("Error loading decisions:",o),V.value=a.value==="ar"?"حدث خطأ أثناء تحميل القرارات":"Error loading decisions",v.value="error",b.value=!0,z.value=[],R.value=0}finally{F.value=!1}},te=async()=>{S();let o=!0;if(k(m.value.title,"title",a.value==="ar"?"عنوان القرار مطلوب":"Decision title is required")&&_(m.value.title,"title",1,100,a.value==="ar"?"عنوان القرار يجب أن يكون بين 1 و 100 حرف":"Decision title must be between 1 and 100 characters")||(o=!1),k(m.value.description,"description",a.value==="ar"?"وصف القرار مطلوب":"Decision description is required")&&_(m.value.description,"description",1,500,a.value==="ar"?"وصف القرار يجب أن يكون بين 1 و 500 حرف":"Decision description must be between 1 and 500 characters")||(o=!1),k(m.value.referenceNumber,"referenceNumber",a.value==="ar"?"رقم المرجع مطلوب":"Reference number is required")&&_(m.value.referenceNumber,"referenceNumber",1,50,a.value==="ar"?"رقم المرجع يجب أن يكون بين 1 و 50 حرف":"Reference number must be between 1 and 50 characters")||(o=!1),c("title"),c("description"),c("referenceNumber"),!!o)try{const e={title:m.value.title.trim(),description:m.value.description.trim(),referenceNumber:m.value.referenceNumber.trim(),createdDate:new Date().toISOString()};console.log("Sending decision data:",e);const n=await A("/Decision",{method:"POST",body:e,headers:{"Accept-Language":a.value}});if(console.log("Response received:",n),n&&n.isSuccess===!1){if(n.errors&&Array.isArray(n.errors))J(n),c("title"),c("description"),c("referenceNumber");else{const t=n.message||(a.value==="ar"?"حدث خطأ أثناء إضافة القرار":"Error adding decision");V.value=t,v.value="error",b.value=!0}return}C.value=!1,ue(),y(),V.value=a.value==="ar"?"تم إضافة القرار بنجاح":"Decision added successfully",v.value="success",b.value=!0}catch(e){console.error("Error adding decision:",e),V.value=a.value==="ar"?"حدث خطأ أثناء إضافة القرار":"Error adding decision",v.value="error",b.value=!0}},se=async()=>{S();let o=!0;if(k(d.value.title,"title",a.value==="ar"?"عنوان القرار مطلوب":"Decision title is required")&&_(d.value.title,"title",1,100,a.value==="ar"?"عنوان القرار يجب أن يكون بين 1 و 100 حرف":"Decision title must be between 1 and 100 characters")||(o=!1),k(d.value.description,"description",a.value==="ar"?"وصف القرار مطلوب":"Decision description is required")&&_(d.value.description,"description",1,500,a.value==="ar"?"وصف القرار يجب أن يكون بين 1 و 500 حرف":"Decision description must be between 1 and 500 characters")||(o=!1),k(d.value.referenceNumber,"referenceNumber",a.value==="ar"?"رقم المرجع مطلوب":"Reference number is required")&&_(d.value.referenceNumber,"referenceNumber",1,50,a.value==="ar"?"رقم المرجع يجب أن يكون بين 1 و 50 حرف":"Reference number must be between 1 and 50 characters")||(o=!1),c("title"),c("description"),c("referenceNumber"),!!o)try{const e=await A(`/Decision/${d.value.id}`,{method:"PUT",body:{id:d.value.id,title:d.value.title.trim(),description:d.value.description.trim(),referenceNumber:d.value.referenceNumber.trim()},headers:{"Accept-Language":a.value}});if(e&&e.isSuccess===!1){if(e.errors&&Array.isArray(e.errors))J(e),c("title"),c("description"),c("referenceNumber");else{const n=e.message||(a.value==="ar"?"حدث خطأ أثناء تحديث القرار":"Error updating decision");V.value=n,v.value="error",b.value=!0}return}E.value=!1,y(),V.value=a.value==="ar"?"تم تحديث القرار بنجاح":"Decision updated successfully",v.value="success",b.value=!0}catch(e){console.error("Error updating decision:",e),V.value=a.value==="ar"?"حدث خطأ أثناء تحديث القرار":"Error updating decision",v.value="error",b.value=!0}},oe=async()=>{var o,e;if(x.value)try{const n=await A(`/Decision/${x.value.id}`,{method:"DELETE",headers:{"Accept-Language":a.value}});if(n&&n.isSuccess===!1){const t=n.message||((e=(o=n.errors)==null?void 0:o[0])==null?void 0:e.errorMessage)||(a.value==="ar"?"حدث خطأ أثناء حذف القرار":"Error deleting decision");V.value=t,v.value="error",b.value=!0;return}P.value=!1,x.value=null,y(),V.value=a.value==="ar"?"تم حذف القرار بنجاح":"Decision deleted successfully",v.value="success",b.value=!0}catch(n){console.error("Error deleting decision:",n),V.value=a.value==="ar"?"حدث خطأ أثناء حذف القرار":"Error deleting decision",v.value="error",b.value=!0}},ie=o=>{d.value={...o},E.value=!0,S()},ne=o=>{x.value=o,P.value=!0},ue=()=>{m.value={title:"",description:"",referenceNumber:""},S()},de=async()=>{if(N.value.length!==0)try{const o=N.value.map(e=>A(`/Decision/${e.id}`,{method:"DELETE",headers:{"Accept-Language":a.value}}));await Promise.all(o),N.value=[],await y(),V.value=a.value==="ar"?"تم حذف القرارات المحددة بنجاح":"Selected decisions deleted successfully",v.value="success",b.value=!0}catch(o){console.error("Error deleting selected decisions:",o),V.value=a.value==="ar"?"حدث خطأ أثناء حذف القرارات المحددة":"Error deleting selected decisions",v.value="error",b.value=!0}};return Q(f,()=>{y()},{deep:!0}),Q(q,()=>{f.value.page=1,y()}),ge(()=>{y()}),(o,e)=>{const n=be("IconBtn");return U(),W(Ve,null,[b.value?(U(),j(me,{key:0,type:v.value,title:v.value==="error"?"خطأ":v.value==="success"?"نجح":"معلومات",closable:"",class:"mb-4"},{default:s(()=>[g(u(V.value),1)]),_:1},8,["type","title"])):X("",!0),l(I,null,{default:s(()=>[l(M,{class:"d-flex justify-space-between align-center pa-6"},{default:s(()=>[D("span",xe,u(r(a)==="ar"?"إدارة القرارات":"Decisions Management"),1),D("div",ke,[N.value.length>0?(U(),j(h,{key:0,color:"error",variant:"outlined",onClick:de},{default:s(()=>[g(u(r(a)==="ar"?`حذف المحدد (${N.value.length})`:`Delete Selected (${N.value.length})`),1)]),_:1})):X("",!0),l(h,{color:"primary",onClick:e[0]||(e[0]=()=>{r(S)(),C.value=!0})},{default:s(()=>[g(u(r(a)==="ar"?"إضافة قرار":"Add Decision"),1)]),_:1})])]),_:1}),l(De),l(T,null,{default:s(()=>[l(O,null,{default:s(()=>[l(w,{cols:"12","offset-md":"8",md:"4"},{default:s(()=>[l(B,{modelValue:q.value,"onUpdate:modelValue":e[1]||(e[1]=t=>q.value=t),placeholder:r(a)==="ar"?"البحث في القرارات...":"Search decisions...","prepend-inner-icon":"mdi-magnify","single-line":"","hide-details":"",dense:"",outlined:""},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),l(Ne,{headers:ae.value,items:z.value,loading:F.value,"items-per-page":f.value.itemsPerPage,page:f.value.page,options:f.value,class:"text-no-wrap","show-select":"",modelValue:N.value,"onUpdate:modelValue":e[4]||(e[4]=t=>N.value=t)},{"item.title":s(({item:t})=>[D("div",_e,[l(we,{size:"32",color:"primary",variant:"tonal"},{default:s(()=>[g(u(t.title.charAt(0).toUpperCase()),1)]),_:2},1024),D("div",Ce,[D("span",Ee,u(t.title),1),D("small",Pe,u(t.description||(r(a)==="ar"?"لا يوجد وصف":"No description")),1)])])]),"item.referenceNumber":s(({item:t})=>[t.referenceNumber?(U(),j(ee,{key:0,color:"success",variant:"tonal",size:"small"},{default:s(()=>[g(u(t.referenceNumber),1)]),_:2},1024)):(U(),W("span",Se,u(r(a)==="ar"?"لا يوجد رقم مرجعي":"No reference number"),1))]),"item.description":s(({item:t})=>[D("span",$e,u(t.description||(r(a)==="ar"?"لا يوجد وصف":"No description")),1)]),"item.createdDate":s(({item:t})=>[l(ee,{color:"info",variant:"tonal",size:"small"},{default:s(()=>[g(u(new Date(t.createdDate).toLocaleDateString(r(a)==="ar"?"ar-SA":"en-US")),1)]),_:2},1024)]),"item.actions":s(({item:t})=>[D("div",Ae,[l(n,{onClick:L=>ie(t)},{default:s(()=>[l(Y,{icon:"tabler-edit"})]),_:2},1032,["onClick"]),l(n,{onClick:L=>ne(t)},{default:s(()=>[l(Y,{icon:"tabler-trash"})]),_:2},1032,["onClick"])])]),bottom:s(()=>[l(T,{class:"pt-2"},{default:s(()=>[D("div",Ue,[l(ye,{modelValue:f.value.itemsPerPage,"onUpdate:modelValue":e[2]||(e[2]=t=>f.value.itemsPerPage=t),items:[5,10,25,50,100],label:r(a)==="ar"?"عناصر في الصفحة:":"Items per page:",variant:"underlined",style:{"max-inline-size":"8rem","min-inline-size":"5rem"}},null,8,["modelValue","label"]),l(he,{modelValue:f.value.page,"onUpdate:modelValue":e[3]||(e[3]=t=>f.value.page=t),"total-visible":o.$vuetify.display.smAndDown?3:5,length:Math.ceil(R.value/f.value.itemsPerPage)},null,8,["modelValue","total-visible","length"])])]),_:1})]),_:1},8,["headers","items","loading","items-per-page","page","options","modelValue"])]),_:1})]),_:1}),l(G,{modelValue:C.value,"onUpdate:modelValue":e[12]||(e[12]=t=>C.value=t),"max-width":"500px"},{default:s(()=>[l(I,null,{default:s(()=>[l(M,null,{default:s(()=>[D("span",Te,u(r(a)==="ar"?"إضافة قرار جديد":"Add New Decision"),1)]),_:1}),l(T,null,{default:s(()=>[l(re,null,{default:s(()=>[l(O,null,{default:s(()=>[l(w,{cols:"12"},{default:s(()=>[l(B,{modelValue:m.value.title,"onUpdate:modelValue":e[5]||(e[5]=t=>m.value.title=t),label:r(a)==="ar"?"عنوان القرار":"Decision Title",required:"",error:r(i).errors.title&&r(i).errors.title.length>0&&r(i).touched.title,"error-messages":r(i).errors.title||[],onBlur:e[6]||(e[6]=t=>r(c)("title"))},null,8,["modelValue","label","error","error-messages"])]),_:1}),l(w,{cols:"12"},{default:s(()=>[l(B,{modelValue:m.value.referenceNumber,"onUpdate:modelValue":e[7]||(e[7]=t=>m.value.referenceNumber=t),label:r(a)==="ar"?"رقم المرجع":"Reference Number",required:"",error:r(i).errors.referenceNumber&&r(i).errors.referenceNumber.length>0&&r(i).touched.referenceNumber,"error-messages":r(i).errors.referenceNumber||[],onBlur:e[8]||(e[8]=t=>r(c)("referenceNumber"))},null,8,["modelValue","label","error","error-messages"])]),_:1}),l(w,{cols:"12"},{default:s(()=>[l(le,{modelValue:m.value.description,"onUpdate:modelValue":e[9]||(e[9]=t=>m.value.description=t),label:r(a)==="ar"?"الوصف":"Description",rows:"3",error:r(i).errors.description&&r(i).errors.description.length>0&&r(i).touched.description,"error-messages":r(i).errors.description||[],onBlur:e[10]||(e[10]=t=>r(c)("description"))},null,8,["modelValue","label","error","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1}),l(H,null,{default:s(()=>[l(Z),l(h,{color:"blue-darken-1",variant:"text",onClick:e[11]||(e[11]=t=>C.value=!1)},{default:s(()=>[g(u(r(a)==="ar"?"إلغاء":"Cancel"),1)]),_:1}),l(h,{color:"blue-darken-1",disabled:r(K),onClick:te},{default:s(()=>[g(u(r(a)==="ar"?"إضافة":"Add"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(G,{modelValue:E.value,"onUpdate:modelValue":e[20]||(e[20]=t=>E.value=t),"max-width":"500px"},{default:s(()=>[l(I,null,{default:s(()=>[l(M,null,{default:s(()=>[D("span",Be,u(r(a)==="ar"?"تعديل القرار":"Edit Decision"),1)]),_:1}),l(T,null,{default:s(()=>[l(re,null,{default:s(()=>[l(O,null,{default:s(()=>[l(w,{cols:"12"},{default:s(()=>[l(B,{modelValue:d.value.title,"onUpdate:modelValue":e[13]||(e[13]=t=>d.value.title=t),label:r(a)==="ar"?"عنوان القرار":"Decision Title",required:"",error:r(i).errors.title&&r(i).errors.title.length>0&&r(i).touched.title,"error-messages":r(i).errors.title||[],onBlur:e[14]||(e[14]=t=>r(c)("title"))},null,8,["modelValue","label","error","error-messages"])]),_:1}),l(w,{cols:"12"},{default:s(()=>[l(B,{modelValue:d.value.referenceNumber,"onUpdate:modelValue":e[15]||(e[15]=t=>d.value.referenceNumber=t),label:r(a)==="ar"?"رقم المرجع":"Reference Number",required:"",error:r(i).errors.referenceNumber&&r(i).errors.referenceNumber.length>0&&r(i).touched.referenceNumber,"error-messages":r(i).errors.referenceNumber||[],onBlur:e[16]||(e[16]=t=>r(c)("referenceNumber"))},null,8,["modelValue","label","error","error-messages"])]),_:1}),l(w,{cols:"12"},{default:s(()=>[l(le,{modelValue:d.value.description,"onUpdate:modelValue":e[17]||(e[17]=t=>d.value.description=t),label:r(a)==="ar"?"الوصف":"Description",rows:"3",error:r(i).errors.description&&r(i).errors.description.length>0&&r(i).touched.description,"error-messages":r(i).errors.description||[],onBlur:e[18]||(e[18]=t=>r(c)("description"))},null,8,["modelValue","label","error","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1}),l(H,null,{default:s(()=>[l(Z),l(h,{color:"blue-darken-1",variant:"text",onClick:e[19]||(e[19]=t=>E.value=!1)},{default:s(()=>[g(u(r(a)==="ar"?"إلغاء":"Cancel"),1)]),_:1}),l(h,{color:"blue-darken-1",disabled:r(K),onClick:se},{default:s(()=>[g(u(r(a)==="ar"?"تحديث":"Update"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(G,{modelValue:P.value,"onUpdate:modelValue":e[22]||(e[22]=t=>P.value=t),"max-width":"400px"},{default:s(()=>[l(I,null,{default:s(()=>[l(M,{class:"text-h5"},{default:s(()=>[g(u(r(a)==="ar"?"تأكيد الحذف":"Confirm Delete"),1)]),_:1}),l(T,null,{default:s(()=>{var t,L;return[g(u(r(a)==="ar"?`هل أنت متأكد من حذف القرار "${(t=x.value)==null?void 0:t.title}"؟`:`Are you sure you want to delete the decision "${(L=x.value)==null?void 0:L.title}"?`)+" ",1),e[23]||(e[23]=D("br",null,null,-1)),D("strong",null,u(r(a)==="ar"?"لا يمكن التراجع عن هذا الإجراء.":"This action cannot be undone."),1)]}),_:1}),l(H,null,{default:s(()=>[l(Z),l(h,{color:"blue-darken-1",variant:"text",onClick:e[21]||(e[21]=t=>P.value=!1)},{default:s(()=>[g(u(r(a)==="ar"?"إلغاء":"Cancel"),1)]),_:1}),l(h,{color:"error",onClick:oe},{default:s(()=>[g(u(r(a)==="ar"?"حذف":"Delete"),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});export{xr as default};
