import{aZ as fe,r as s,w as ee,D as ce,a as ge,c as le,o as T,b as a,e as t,s as v,t as b,d as g,f as ae,l as ye,aa as V,V as te,m as p,aV as Ve}from"./index-B8v18vV9.js";import{u as xe}from"./useFormValidation-CMFmdvK5.js";import{$ as E}from"./api-BsM9rBDA.js";import{V as Ce}from"./VSnackbar-CdOx8oIh.js";import{b as q,V as z,d as Z}from"./VCard-CNRE25e-.js";import{V as be}from"./VDivider-DSPKupgM.js";import{V as N}from"./VCardText-DEmSXyVG.js";import{V as G,a as w}from"./VRow-_IA5gP-y.js";import{V as H}from"./VTextField-CECq9VRT.js";import{V as we}from"./VDataTable-3XgUkqKQ.js";import{V as Ie}from"./VSelect-DPHqViyI.js";import{V as ke}from"./VPagination-CXzoGOqg.js";import{V as Pe}from"./VChip-O2d2z9kF.js";import{V as Re}from"./VAvatar-ChAAZBis.js";import{V as Ee}from"./VContainer-MPVCTcwv.js";import{V as j}from"./VAutocomplete-D0ILY2x_.js";import{V as J}from"./VSpacer-q8Ilz_v3.js";import{V as K}from"./VDialog-CeKWQW-R.js";import{V as Se}from"./VForm-iJwaMksk.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-9rIf2CJL.js";import"./VOverlay-XziznS_F.js";import"./easing-CjukEv2V.js";import"./delay-Gut2ep7o.js";import"./lazy-C7uzezzp.js";import"./scopeId-HP_yl1Lf.js";import"./VImg-CC9idbFW.js";import"./forwardRefs-C-GTDzx5.js";/* empty css              *//* empty css                   */import"./VCounter-CIuax7qs.js";import"./VField-B3HFW9Jo.js";import"./form-CA0oDzwd.js";import"./VInput-C4rp4ag1.js";import"./VCheckboxBtn-CbUz6YjU.js";import"./VSelectionControl-DskdDz5w.js";import"./VTable-DlYdeBcP.js";import"./filter-UjvCdIvO.js";import"./VList-DHTDlf99.js";import"./ssrBoot-DdFyWfM4.js";import"./dialog-transition-DYwFRJuV.js";import"./VMenu-yVuXb3wj.js";import"./VSlideGroup-B_7Hc5j3.js";const $e={class:"d-flex gap-2"},Ne={class:"d-flex align-center"},Ue={class:"d-flex flex-column ms-3"},De={class:"d-block font-weight-medium text-truncate text-high-emphasis"},Ae={class:"text-medium-emphasis"},Be={key:1,class:"text-medium-emphasis"},Te={class:"d-flex gap-1"},qe={class:"d-flex flex-wrap justify-center justify-sm-space-between gap-y-2 mt-2"},ze=fe({__name:"regions",setup(je){const F=s([]),U=s([]),L=s([]),_=s(!1),D=s(!1),A=s(0),n=s(!1),d=s(""),m=s("success"),S=s(!1),M=s(!1),x=s(!1),$=s(null),C=s([]),B=s(""),f=s({name:"",country:"",cityId:""}),u=s({id:0,key:"",value:"",name:"",description:"",cityId:""}),{validationState:c,validateRequired:I,addError:k,clearErrors:P,setFieldTouched:O,hasErrors:Q}=xe(),i=s({page:1,itemsPerPage:10,sortBy:[""],sortDesc:[!1]}),re=[{title:"المنطقة",key:"name"},{title:"الدولة",key:"country"},{title:"الإجراءات",key:"actions",sortable:!1}],y=async()=>{_.value=!0;try{const r=new URLSearchParams({PageNumber:i.value.page.toString(),PageSize:i.value.itemsPerPage.toString(),SearchTerm:B.value||""}),e=await E(`/Region/filter?${r}`);if(F.value=e.data.items||[],e.data){A.value=e.data.totalCount||0;const o=Math.ceil(A.value/i.value.itemsPerPage);i.value.page>o&&o>0&&(i.value.page=o,await y())}}catch(r){console.error("Error loading regions:",r),d.value="حدث خطأ أثناء تحميل المناطق",m.value="error",n.value=!0,F.value=[],A.value=0}finally{_.value=!1}},oe=async()=>{D.value=!0;try{const r=await E("/City/filter?PageSize=100");U.value=r.data.items||[];const e=[...new Set(U.value.map(o=>o.country).filter(Boolean))];L.value=e.sort()}catch(r){console.error("Error loading cities:",r),d.value="حدث خطأ أثناء تحميل المدن",m.value="error",n.value=!0}finally{D.value=!1}},se=()=>(P(),I(f.value.name,"name","اسم المنطقة مطلوب"),I(f.value.cityId,"cityId","المدينة مطلوبة"),I(f.value.country,"country","الدولة مطلوبة"),!Q.value),ne=()=>(P(),I(u.value.name,"editName","اسم المنطقة مطلوب"),I(u.value.cityId,"editCityId","المدينة مطلوبة"),I(u.value.country,"editCountry","الدولة مطلوبة"),!Q.value),ue=async()=>{if(se())try{const r=await E("/Region",{method:"POST",body:{name:f.value.name,country:f.value.country,cityId:f.value.cityId}});if(r&&r.isSuccess===!1){if(r.errors&&Array.isArray(r.errors))r.errors.forEach(e=>{e.propertyName==="Name"?k("name",e.errorMessage):e.propertyName==="Country"?k("country",e.errorMessage):e.propertyName==="CityId"&&k("cityId",e.errorMessage)});else{const e=r.message||"حدث خطأ أثناء إضافة المنطقة";d.value=e,m.value="error",n.value=!0}return}S.value=!1,pe(),P(),y(),d.value="تم إضافة المنطقة بنجاح",m.value="success",n.value=!0}catch(r){console.error("Error adding region:",r),d.value="حدث خطأ أثناء إضافة المنطقة",m.value="error",n.value=!0}},W=async()=>{if(ne())try{const r=await E(`/Region/${u.value.id}`,{method:"PUT",body:{id:u.value.id,name:u.value.name,country:u.value.country||u.value.description,cityId:u.value.cityId}});if(r&&r.isSuccess===!1){if(r.errors&&Array.isArray(r.errors))r.errors.forEach(e=>{e.propertyName==="Name"?k("editName",e.errorMessage):e.propertyName==="Country"?k("editCountry",e.errorMessage):e.propertyName==="CityId"&&k("editCityId",e.errorMessage)});else{const e=r.message||"حدث خطأ أثناء تحديث المنطقة";d.value=e,m.value="error",n.value=!0}return}M.value=!1,P(),y(),d.value="تم تحديث المنطقة بنجاح",m.value="success",n.value=!0}catch(r){console.error("Error updating region:",r),d.value="حدث خطأ أثناء تحديث المنطقة",m.value="error",n.value=!0}},ie=async()=>{var r,e;if($.value)try{console.log("Attempting to delete region:",$.value.id);const o=await E(`/Region/${$.value.id}`,{method:"DELETE"});if(console.log("Delete response:",o),console.log("Response data:",o.data),o&&o.isSuccess===!1){const l=o.message||((e=(r=o.errors)==null?void 0:r[0])==null?void 0:e.errorMessage)||"حدث خطأ أثناء حذف المنطقة";console.log("API returned error:",l),d.value=l,m.value="error",n.value=!0,x.value=!1;return}console.log("Region deleted successfully"),x.value=!1,y(),d.value="تم حذف المنطقة بنجاح",m.value="success",n.value=!0}catch(o){console.error("Error deleting region:",o),d.value="حدث خطأ في الاتصال بالخادم",m.value="error",n.value=!0,x.value=!1}},de=async()=>{if(C.value.length!==0)try{const r=C.value.map(l=>E(`/Region/${l.id}`,{method:"DELETE"})),o=(await Promise.all(r)).filter(l=>l&&l.isSuccess===!1);if(o.length>0){const l=o.map(R=>{var X,Y;return(R==null?void 0:R.message)||((Y=(X=R==null?void 0:R.errors)==null?void 0:X[0])==null?void 0:Y.errorMessage)||"حدث خطأ أثناء العملية"}),h=`فشل في حذف ${o.length} عنصر: ${l.join(", ")}`;d.value=h,m.value="error",n.value=!0;return}C.value=[],y(),d.value="تم حذف المناطق المحددة بنجاح",m.value="success",n.value=!0}catch(r){console.error("Error deleting selected regions:",r),d.value="حدث خطأ في الاتصال بالخادم",m.value="error",n.value=!0}},me=r=>{u.value={...r,country:r.country||r.description||""},P(),M.value=!0},ve=r=>{$.value=r,x.value=!0},pe=()=>{f.value={name:"",country:"",cityId:""},P()};return ee(B,()=>{i.value.page=1,y()},{immediate:!1}),ee([()=>i.value.page,()=>i.value.itemsPerPage],()=>{y()},{immediate:!1}),ce(()=>{y(),oe()}),(r,e)=>{const o=ge("IconBtn");return T(),le("div",null,[a(Ce,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=l=>n.value=l),color:m.value,timeout:3e3},{default:t(()=>[v(b(d.value),1)]),_:1},8,["modelValue","color"]),a(z,null,{default:t(()=>[a(q,{class:"d-flex justify-space-between align-center pa-6"},{default:t(()=>[e[22]||(e[22]=g("span",{class:"text-h5"},"إدارة المناطق",-1)),g("div",$e,[C.value.length>0?(T(),ae(V,{key:0,color:"error",variant:"outlined",onClick:de},{default:t(()=>[v(" حذف المحدد ("+b(C.value.length)+") ",1)]),_:1})):ye("",!0),a(V,{color:"primary",onClick:e[1]||(e[1]=l=>S.value=!0)},{default:t(()=>e[21]||(e[21]=[v(" إضافة منطقة ")])),_:1})])]),_:1}),a(be),a(N,null,{default:t(()=>[a(G,null,{default:t(()=>[a(w,{cols:"12","offset-md":"8",md:"4"},{default:t(()=>[a(H,{modelValue:B.value,"onUpdate:modelValue":e[2]||(e[2]=l=>B.value=l),placeholder:"البحث في المناطق...","prepend-inner-icon":"mdi-magnify","single-line":"","hide-details":"",dense:"",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),a(we,{headers:re,items:F.value,loading:_.value,"items-per-page":i.value.itemsPerPage,page:i.value.page,options:i.value,class:"text-no-wrap","show-select":"",modelValue:C.value,"onUpdate:modelValue":e[5]||(e[5]=l=>C.value=l)},{"item.name":t(({item:l})=>[g("div",Ne,[a(Re,{size:"32",color:"primary",variant:"tonal"},{default:t(()=>[v(b(l.name.charAt(0).toUpperCase()),1)]),_:2},1024),g("div",Ue,[g("span",De,b(l.name),1),g("small",Ae,b(l.description||"لا يوجد وصف"),1)])])]),"item.country":t(({item:l})=>[l.country?(T(),ae(Pe,{key:0,color:"secondary",variant:"tonal",size:"small"},{default:t(()=>[v(b(l.country),1)]),_:2},1024)):(T(),le("span",Be," لا توجد دولة "))]),"item.actions":t(({item:l})=>[g("div",Te,[a(o,{onClick:h=>me(l)},{default:t(()=>[a(te,{icon:"tabler-edit"})]),_:2},1032,["onClick"]),a(o,{onClick:h=>ve(l)},{default:t(()=>[a(te,{icon:"tabler-trash"})]),_:2},1032,["onClick"])])]),bottom:t(()=>[a(N,{class:"pt-2"},{default:t(()=>[g("div",qe,[a(Ie,{modelValue:i.value.itemsPerPage,"onUpdate:modelValue":e[3]||(e[3]=l=>i.value.itemsPerPage=l),items:[5,10,25,50,100],label:"عناصر في الصفحة:",variant:"underlined",style:{"max-inline-size":"8rem","min-inline-size":"5rem"}},null,8,["modelValue"]),a(ke,{modelValue:i.value.page,"onUpdate:modelValue":e[4]||(e[4]=l=>i.value.page=l),"total-visible":r.$vuetify.display.smAndDown?3:5,length:Math.ceil(A.value/i.value.itemsPerPage)},null,8,["modelValue","total-visible","length"])])]),_:1})]),_:1},8,["items","loading","items-per-page","page","options","modelValue"])]),_:1})]),_:1}),a(K,{modelValue:S.value,"onUpdate:modelValue":e[13]||(e[13]=l=>S.value=l),"max-width":"500px"},{default:t(()=>[a(z,null,{default:t(()=>[a(q,null,{default:t(()=>e[23]||(e[23]=[g("span",{class:"text-h5"},"إضافة منطقة جديدة",-1)])),_:1}),a(N,null,{default:t(()=>[a(Ee,null,{default:t(()=>[a(G,null,{default:t(()=>[a(w,{cols:"12"},{default:t(()=>[a(H,{modelValue:f.value.name,"onUpdate:modelValue":e[6]||(e[6]=l=>f.value.name=l),label:"اسم المنطقة",required:"",error:p(c).errors.name&&p(c).errors.name.length>0&&p(c).touched.name,"error-messages":p(c).errors.name||[],onBlur:e[7]||(e[7]=l=>p(O)("name"))},null,8,["modelValue","error","error-messages"])]),_:1}),a(w,{cols:"12"},{default:t(()=>[a(j,{modelValue:f.value.cityId,"onUpdate:modelValue":e[8]||(e[8]=l=>f.value.cityId=l),label:"المدينة",items:U.value,"item-title":"name","item-value":"id",required:"",error:p(c).errors.cityId&&p(c).errors.cityId.length>0&&p(c).touched.cityId,"error-messages":p(c).errors.cityId||[],onBlur:e[9]||(e[9]=l=>p(O)("cityId")),clearable:"","no-data-text":"لا توجد مدن متاحة","prepend-inner-icon":"mdi-city",placeholder:"اختر المدينة...","hide-no-data":""},null,8,["modelValue","items","error","error-messages"])]),_:1}),a(w,{cols:"12"},{default:t(()=>[a(j,{modelValue:f.value.country,"onUpdate:modelValue":e[10]||(e[10]=l=>f.value.country=l),label:"الدولة",items:L.value,required:"",error:p(c).errors.country&&p(c).errors.country.length>0&&p(c).touched.country,"error-messages":p(c).errors.country||[],onBlur:e[11]||(e[11]=l=>p(O)("country")),clearable:"","no-data-text":"لا توجد دول متاحة","prepend-inner-icon":"mdi-flag",placeholder:"ابحث عن دولة...","hide-no-data":""},null,8,["modelValue","items","error","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1}),a(Z,null,{default:t(()=>[a(J),a(V,{color:"blue-darken-1",variant:"text",onClick:e[12]||(e[12]=l=>S.value=!1)},{default:t(()=>e[24]||(e[24]=[v("إلغاء")])),_:1}),a(V,{color:"blue-darken-1",onClick:ue},{default:t(()=>e[25]||(e[25]=[v("إضافة")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(K,{modelValue:M.value,"onUpdate:modelValue":e[18]||(e[18]=l=>M.value=l),"max-width":"600px",persistent:""},{default:t(()=>[a(z,null,{default:t(()=>[a(q,{class:"text-h6"},{default:t(()=>e[26]||(e[26]=[v("تعديل المنطقة")])),_:1}),a(N,null,{default:t(()=>[a(Se,{onSubmit:Ve(W,["prevent"])},{default:t(()=>[a(G,null,{default:t(()=>[a(w,{cols:"12"},{default:t(()=>[a(H,{modelValue:u.value.name,"onUpdate:modelValue":e[14]||(e[14]=l=>u.value.name=l),label:"اسم المنطقة",variant:"outlined",required:"",rules:[l=>!!l||"اسم المنطقة مطلوب"]},null,8,["modelValue","rules"])]),_:1}),a(w,{cols:"12"},{default:t(()=>[a(j,{modelValue:u.value.cityId,"onUpdate:modelValue":e[15]||(e[15]=l=>u.value.cityId=l),label:"المدينة",variant:"outlined",items:U.value,"item-title":"name","item-value":"id",loading:D.value,clearable:"","no-data-text":"لا توجد مدن متاحة",required:"",rules:[l=>!!l||"المدينة مطلوبة"],"prepend-inner-icon":"mdi-city",placeholder:"اختر المدينة...","hide-no-data":""},null,8,["modelValue","items","loading","rules"])]),_:1}),a(w,{cols:"12"},{default:t(()=>[a(j,{modelValue:u.value.country,"onUpdate:modelValue":e[16]||(e[16]=l=>u.value.country=l),label:"الدولة",variant:"outlined",items:L.value,loading:D.value,clearable:"","no-data-text":"لا توجد دول متاحة",required:"",rules:[l=>!!l||"الدولة مطلوبة"],"prepend-inner-icon":"mdi-magnify",placeholder:"ابحث عن دولة...","hide-no-data":""},null,8,["modelValue","items","loading","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),a(Z,null,{default:t(()=>[a(J),a(V,{color:"grey-darken-1",variant:"text",onClick:e[17]||(e[17]=l=>M.value=!1)},{default:t(()=>e[27]||(e[27]=[v(" إلغاء ")])),_:1}),a(V,{color:"primary",variant:"flat",onClick:W},{default:t(()=>e[28]||(e[28]=[v(" تحديث ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(K,{modelValue:x.value,"onUpdate:modelValue":e[20]||(e[20]=l=>x.value=l),"max-width":"400px"},{default:t(()=>[a(z,null,{default:t(()=>[a(q,{class:"text-h6"},{default:t(()=>e[29]||(e[29]=[v("تأكيد الحذف")])),_:1}),a(N,null,{default:t(()=>{var l;return[e[30]||(e[30]=v(' هل أنت متأكد من حذف المنطقة "')),g("strong",null,b((l=$.value)==null?void 0:l.value),1),e[31]||(e[31]=v('"؟ ')),e[32]||(e[32]=g("br",null,null,-1)),e[33]||(e[33]=g("span",{class:"text-error"},"لا يمكن التراجع عن هذا الإجراء.",-1))]}),_:1}),a(Z,null,{default:t(()=>[a(J),a(V,{color:"grey-darken-1",variant:"text",onClick:e[19]||(e[19]=l=>x.value=!1)},{default:t(()=>e[34]||(e[34]=[v(" إلغاء ")])),_:1}),a(V,{color:"error",variant:"flat",onClick:ie},{default:t(()=>e[35]||(e[35]=[v(" حذف ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Ml=Me(ze,[["__scopeId","data-v-e3c905d3"]]);export{Ml as default};
