import{a as Se,V as Pe}from"./form-CA0oDzwd.js";import{u as Ae,m as Fe,a as De}from"./VSelect-DPHqViyI.js";import{V as Y,m as Re}from"./VTextField-CECq9VRT.js";import{ai as Ee,W as Te,by as Me,r as L,X as A,az as Z,P as m,bz as Be,bK as Le,w as F,aU as ee,a0 as Ne,b as s,p as P,aD as Oe,dB as Ke,bH as $e,F as O,V as le,d6 as ze,d1 as Ue,bI as je,s as He,d0 as We,d2 as te,d3 as qe,c as Xe,o as ae,f as Ge,l as Je,m as N,b6 as Qe,h as Ye,e as Ze,y as el,bk as ne,bl as ue,v as ll}from"./index-B8v18vV9.js";import{u as tl,m as al}from"./filter-UjvCdIvO.js";import{f as nl}from"./forwardRefs-C-GTDzx5.js";import{u as ul,t as D,V as ol,a as oe}from"./VList-DHTDlf99.js";import{m as sl}from"./VImg-CC9idbFW.js";import{V as il}from"./VMenu-yVuXb3wj.js";import{V as rl}from"./VCheckboxBtn-CbUz6YjU.js";import{V as cl}from"./VAvatar-ChAAZBis.js";import{V as vl}from"./VChip-O2d2z9kF.js";function dl(e,b,w){if(b==null)return e;if(Array.isArray(b))throw new Error("Multiple matches is not implemented");return typeof b=="number"&&~b?s(O,null,[s("span",{class:"v-combobox__unmask"},[e.substr(0,b)]),s("span",{class:"v-combobox__mask"},[e.substr(b,w)]),s("span",{class:"v-combobox__unmask"},[e.substr(b+w)])]):e}const fl=Te({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...al({filterKeys:["title"]}),...Fe({hideNoData:!0,returnObject:!0}),...Oe(Re({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...sl({transition:!1})},"VCombobox"),ml=Ee()({name:"VCombobox",props:fl(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,b){var G;let{emit:w,slots:n}=b;const{t:_}=Me(),h=L(),p=A(!1),x=A(!0),K=A(!1),q=L(),$=L(),z=Z(e,"menu"),c=m({get:()=>z.value,set:l=>{var t;z.value&&!l&&((t=q.value)!=null&&t.Î¨openChildren.size)||(z.value=l)}}),i=A(-1);let U=!1;const se=m(()=>{var l;return(l=h.value)==null?void 0:l.color}),X=m(()=>c.value?e.closeText:e.openText),{items:ie,transformIn:re,transformOut:ce}=ul(e),{textColorClasses:ve,textColorStyles:de}=Be(se),u=Z(e,"modelValue",[],l=>re(Le(l)),l=>{const t=ce(l);return e.multiple?t:t[0]??null}),R=Se(e),E=m(()=>!!(e.chips||n.chip)),y=m(()=>E.value||!!n.selection),k=A(!e.multiple&&!y.value?((G=u.value[0])==null?void 0:G.title)??"":""),v=m({get:()=>k.value,set:l=>{var t;if(k.value=l??"",!e.multiple&&!y.value&&(u.value=[D(e,l)]),l&&e.multiple&&((t=e.delimiters)!=null&&t.length)){const r=l.split(new RegExp(`(?:${e.delimiters.join("|")})+`));r.length>1&&(r.forEach(a=>{a=a.trim(),a&&V(D(e,a))}),k.value="")}l||(i.value=-1),x.value=!l}}),fe=m(()=>typeof e.counterValue=="function"?e.counterValue(u.value):typeof e.counterValue=="number"?e.counterValue:e.multiple?u.value.length:v.value.length);F(k,l=>{U?ee(()=>U=!1):p.value&&!c.value&&(c.value=!0),w("update:search",l)}),F(u,l=>{var t;!e.multiple&&!y.value&&(k.value=((t=l[0])==null?void 0:t.title)??"")});const{filteredItems:T,getMatches:me}=tl(e,ie,()=>x.value?"":v.value),C=m(()=>e.hideSelected?T.value.filter(l=>!u.value.some(t=>t.value===l.value)):T.value),be=m(()=>u.value.map(l=>l.value)),j=m(()=>{var t;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&v.value===((t=C.value[0])==null?void 0:t.title))&&C.value.length>0&&!x.value&&!K.value}),H=m(()=>e.hideNoData&&!C.value.length||R.isReadonly.value||R.isDisabled.value),W=L(),he=Ae(W,h);function pe(l){U=!0,e.openOnClear&&(c.value=!0)}function ge(){H.value||(c.value=!0)}function xe(l){H.value||(p.value&&(l.preventDefault(),l.stopPropagation()),c.value=!c.value)}function Ve(l){var t;We(l)&&((t=h.value)==null||t.focus())}function ye(l){var a;if(Ke(l)||R.isReadonly.value)return;const t=h.value.selectionStart,r=u.value.length;if((i.value>-1||["Enter","ArrowDown","ArrowUp"].includes(l.key))&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(c.value=!0),["Escape"].includes(l.key)&&(c.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(j.value&&["Enter","Tab"].includes(l.key)&&!u.value.some(o=>{let{value:g}=o;return g===C.value[0].value})&&V(T.value[0]),x.value=!0),l.key==="ArrowDown"&&j.value&&((a=W.value)==null||a.focus("next")),l.key==="Enter"&&v.value&&(V(D(e,v.value)),y.value&&(k.value="")),["Backspace","Delete"].includes(l.key)){if(!e.multiple&&y.value&&u.value.length>0&&!v.value)return V(u.value[0],!1);if(~i.value){const o=i.value;V(u.value[i.value],!1),i.value=o>=r-1?r-2:o}else l.key==="Backspace"&&!v.value&&(i.value=r-1)}if(e.multiple){if(l.key==="ArrowLeft"){if(i.value<0&&t>0)return;const o=i.value>-1?i.value-1:r-1;u.value[o]?i.value=o:(i.value=-1,h.value.setSelectionRange(v.value.length,v.value.length))}if(l.key==="ArrowRight"){if(i.value<0)return;const o=i.value+1;u.value[o]?i.value=o:(i.value=-1,h.value.setSelectionRange(0,0))}}}function ke(){var l;e.eager&&((l=$.value)==null||l.calculateVisibleItems())}function Ce(){var l;p.value&&(x.value=!0,(l=h.value)==null||l.focus())}function V(l){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!l||l.props.disabled))if(e.multiple){const r=u.value.findIndex(o=>e.valueComparator(o.value,l.value)),a=t??!~r;if(~r){const o=a?[...u.value,l]:[...u.value];o.splice(r,1),u.value=o}else a&&(u.value=[...u.value,l]);e.clearOnSelect&&(v.value="")}else{const r=t!==!1;u.value=r?[l]:[],k.value=r&&!y.value?l.title:"",ee(()=>{c.value=!1,x.value=!0})}}function we(l){p.value=!0,setTimeout(()=>{K.value=!0})}function _e(l){K.value=!1}function Ie(l){(l==null||l===""&&!e.multiple&&!y.value)&&(u.value=[])}return F(p,(l,t)=>{if(!(l||l===t)&&(i.value=-1,c.value=!1,v.value)){if(e.multiple){V(D(e,v.value));return}if(!y.value)return;u.value.some(r=>{let{title:a}=r;return a===v.value})?k.value="":V(D(e,v.value))}}),F(c,()=>{if(!e.hideSelected&&c.value&&u.value.length){const l=C.value.findIndex(t=>u.value.some(r=>e.valueComparator(r.value,t.value)));$e&&window.requestAnimationFrame(()=>{var t;l>=0&&((t=$.value)==null||t.scrollToIndex(l))})}}),F(()=>e.items,(l,t)=>{c.value||p.value&&!t.length&&l.length&&(c.value=!0)}),Ne(()=>{const l=!!(!e.hideNoData||C.value.length||n["prepend-item"]||n["append-item"]||n["no-data"]),t=u.value.length>0,r=Y.filterProps(e);return s(Y,P({ref:h},r,{modelValue:v.value,"onUpdate:modelValue":[a=>v.value=a,Ie],focused:p.value,"onUpdate:focused":a=>p.value=a,validationValue:u.externalValue,counterValue:fe.value,dirty:t,class:["v-combobox",{"v-combobox--active-menu":c.value,"v-combobox--chips":!!e.chips,"v-combobox--selection-slot":!!y.value,"v-combobox--selecting-index":i.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,readonly:R.isReadonly.value,placeholder:t?void 0:e.placeholder,"onClick:clear":pe,"onMousedown:control":ge,onKeydown:ye}),{...n,default:()=>s(O,null,[s(il,P({ref:q,modelValue:c.value,"onUpdate:modelValue":a=>c.value=a,activator:"parent",contentClass:"v-combobox__content",disabled:H.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterEnter:ke,onAfterLeave:Ce},e.menuProps),{default:()=>[l&&s(ol,P({ref:W,selected:be.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:a=>a.preventDefault(),onKeydown:Ve,onFocusin:we,onFocusout:_e,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},he,e.listProps),{default:()=>{var a,o,g;return[(a=n["prepend-item"])==null?void 0:a.call(n),!C.value.length&&!e.hideNoData&&(((o=n["no-data"])==null?void 0:o.call(n))??s(oe,{title:_(e.noDataText)},null)),s(De,{ref:$,renderless:!0,items:C.value},{default:I=>{var Q;let{item:d,index:S,itemRef:f}=I;const J=P(d.props,{ref:f,key:S,active:j.value&&S===0?!0:void 0,onClick:()=>V(d,null)});return((Q=n.item)==null?void 0:Q.call(n,{item:d,index:S,props:J}))??s(oe,P(J,{role:"option"}),{prepend:M=>{let{isSelected:B}=M;return s(O,null,[e.multiple&&!e.hideSelected?s(rl,{key:d.value,modelValue:B,ripple:!1,tabindex:"-1"},null):void 0,d.props.prependAvatar&&s(cl,{image:d.props.prependAvatar},null),d.props.prependIcon&&s(le,{icon:d.props.prependIcon},null)])},title:()=>{var M,B;return x.value?d.title:dl(d.title,(M=me(d))==null?void 0:M.title,((B=v.value)==null?void 0:B.length)??0)}})}}),(g=n["append-item"])==null?void 0:g.call(n)]}})]}),u.value.map((a,o)=>{function g(f){f.stopPropagation(),f.preventDefault(),V(a,!1)}const I={"onClick:close":g,onKeydown(f){f.key!=="Enter"&&f.key!==" "||(f.preventDefault(),f.stopPropagation(),g(f))},onMousedown(f){f.preventDefault(),f.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},d=E.value?!!n.chip:!!n.selection,S=d?Ue(E.value?n.chip({item:a,index:o,props:I}):n.selection({item:a,index:o})):void 0;if(!(d&&!S))return s("div",{key:a.value,class:["v-combobox__selection",o===i.value&&["v-combobox__selection--selected",ve.value]],style:o===i.value?de.value:{}},[E.value?n.chip?s(je,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:a.title}}},{default:()=>[S]}):s(vl,P({key:"chip",closable:e.closableChips,size:"small",text:a.title,disabled:a.props.disabled},I),null):S??s("span",{class:"v-combobox__selection-text"},[a.title,e.multiple&&o<u.value.length-1&&s("span",{class:"v-combobox__selection-comma"},[He(",")])])])})]),"append-inner":function(){var I;for(var a=arguments.length,o=new Array(a),g=0;g<a;g++)o[g]=arguments[g];return s(O,null,[(I=n["append-inner"])==null?void 0:I.call(n,...o),(!e.hideNoData||e.items.length)&&e.menuIcon?s(le,{class:"v-combobox__menu-icon",icon:e.menuIcon,onMousedown:xe,onClick:ze,"aria-label":_(X.value),title:_(X.value),tabindex:"-1"},null):void 0])}})}),nl({isFocused:p,isPristine:x,menu:c,search:v,selectionIndex:i,filteredItems:T,select:V},h)}}),Sl=Object.assign({name:"AppCombobox",inheritAttrs:!1},{__name:"AppCombobox",setup(e){const b=m(()=>{const _=te().id,h=qe();return _?`app-combobox-${_}`:h}),w=m(()=>te().label);return(n,_)=>(ae(),Xe("div",{class:ll(["app-combobox flex-grow-1",n.$attrs.class])},[N(w)?(ae(),Ge(Pe,{key:0,for:N(b),class:"mb-1 text-body-2",text:N(w)},null,8,["for","text"])):Je("",!0),s(ml,ne(ue({...n.$attrs,class:null,label:void 0,variant:"outlined",id:N(b),menuProps:{contentClass:["app-inner-list","app-combobox__content","v-combobox__content",n.$attrs.multiple!==void 0?"v-list-select-multiple":""]}})),Qe({_:2},[Ye(n.$slots,(h,p)=>({name:p,fn:Ze(x=>[el(n.$slots,p,ne(ue(x||{})))])}))]),1040)],2))}});export{ml as V,Sl as _};
