import{aZ as ye,aL as be,r as v,br as te,P as xe,w as re,D as Ce,a as we,c as Z,o as E,b as l,e as t,s as n,t as V,d as g,f as G,l as ke,aa as y,m as s,V as oe,aV as se}from"./index-Bg4xuB1X.js";import{u as Ie}from"./useFormValidation-BDZm5KGL.js";import{$ as D}from"./api-CtflMH2I.js";import{V as Pe}from"./VAlert-EJXBu8ko.js";import{b as F,V as q,d as J}from"./VCard-DDR_Ypqe.js";import{V as $e}from"./VDivider-DifrbBpe.js";import{V as B}from"./VCardText-s50m09-4.js";import{V as K,a as C}from"./VRow-BAQcKL2W.js";import{V as Q}from"./VTextField-BHcrK3Dr.js";import{V as Ee}from"./VDataTable-DmO6crSb.js";import{V as De}from"./VSelect-8-VDNGkd.js";import{V as Se}from"./VPagination-Dz7DRFWj.js";import{V as ie}from"./VChip-H4A1W8rV.js";import{V as Ue}from"./VAvatar-BsFM-TZJ.js";import{V as ne}from"./VForm-BSFgP32H.js";import{V as de}from"./VAutocomplete-CD5SZDGH.js";import{V as ue}from"./VTextarea-CPImoRvr.js";import{V as W}from"./VSpacer-z6O_zCSB.js";import{V as X}from"./VDialog-CWNQOwlq.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-9rIf2CJL.js";import"./VImg-NlJe-KFk.js";/* empty css              *//* empty css                   */import"./VCounter-DeZ2K8Z1.js";import"./VField-vHjrVG5U.js";import"./form-Cuh6vgJQ.js";import"./easing-CjukEv2V.js";import"./VInput-jwilm1jM.js";import"./forwardRefs-C-GTDzx5.js";import"./VCheckboxBtn-DUP9cNAP.js";import"./VSelectionControl-C-J5k8Iq.js";import"./VTable-BTzlTVHi.js";import"./filter-hnx0p1D_.js";import"./VList-BRBkP7En.js";import"./ssrBoot-YZDDE8_j.js";import"./dialog-transition-BFSA7jd1.js";import"./VMenu-BI4u-Xp1.js";import"./VOverlay-DtU6ufsq.js";import"./delay-B1a-6wqT.js";import"./lazy-CtldSEvy.js";import"./scopeId-CE5cAIa2.js";import"./VSlideGroup-DaNbB7e2.js";const Be={class:"d-flex gap-2"},Ae={class:"d-flex align-center"},Re={class:"d-flex flex-column ms-3"},Te={class:"d-block font-weight-medium text-truncate text-high-emphasis"},Me={class:"text-medium-emphasis"},ze={key:1,class:"text-medium-emphasis"},Fe={key:1,class:"text-medium-emphasis"},qe={class:"d-flex gap-1"},Le={class:"d-flex flex-wrap justify-center justify-sm-space-between gap-y-2 mt-2"},je=ye({__name:"cities",setup(He){const{t:A}=be(),{setErrorsFromResponse:Y,clearErrors:w,hasErrors:_,getFieldErrors:k,setFieldTouched:I,shouldShowFieldError:P,validateRequired:R}=Ie(),L=v([]),j=v([]),H=v(!1),T=v(!1),M=v(0),d=v(!1),m=v(""),p=v("success"),S=v(!1),U=v(!1),b=v(!1),N=v(null),x=v([]),z=v(""),f=te({name:"",regionId:"",description:""}),i=te({id:0,name:"",description:"",regionId:""}),u=v({page:1,itemsPerPage:10,sortBy:[""],sortDesc:[!1]}),me=xe(()=>[{title:A("tableHeaders.cities.name"),key:"name"},{title:A("tableHeaders.cities.regionName"),key:"regionName"},{title:A("tableHeaders.cities.country"),key:"country"},{title:A("tableHeaders.cities.actions"),key:"actions",sortable:!1}]),c=async()=>{H.value=!0;try{const r=new URLSearchParams({PageNumber:u.value.page.toString(),PageSize:u.value.itemsPerPage.toString(),SearchTerm:z.value||""}),e=await D(`/City/filter?${r}`);if(L.value=e.data.items||[],e.data){M.value=e.data.totalCount||0;const o=Math.ceil(M.value/u.value.itemsPerPage);u.value.page>o&&o>0&&(u.value.page=o,await c())}}catch(r){console.error("Error loading cities:",r),m.value="حدث خطأ أثناء تحميل المدن",p.value="error",d.value=!0,L.value=[],M.value=0}finally{H.value=!1}},pe=async()=>{T.value=!0;try{const r=await D("/Region/filter?PageSize=100");j.value=r.data.items||[]}catch(r){console.error("Error loading regions:",r),m.value="حدث خطأ أثناء تحميل المناطق",p.value="error",d.value=!0}finally{T.value=!1}},h=async()=>{w();let r=!0;if(R(f.name,"name","اسم المدينة مطلوب")||(r=!1),R(f.regionId,"regionId","المنطقة مطلوبة")||(r=!1),!!r)try{const e=await D("/City",{method:"POST",body:{name:f.name,regionId:f.regionId,description:f.description}});if(e&&e.isSuccess===!1){if(e.errors&&Array.isArray(e.errors))Y(e);else{const o=e.message||"حدث خطأ أثناء إضافة المدينة";m.value=o,p.value="error",d.value=!0}return}S.value=!1,Ve(),c(),m.value="تم إضافة المدينة بنجاح",p.value="success",d.value=!0}catch(e){console.error("Error adding city:",e),m.value="حدث خطأ أثناء إضافة المدينة",p.value="error",d.value=!0}},ee=async()=>{w();let r=!0;if(R(i.name,"editName","اسم المدينة مطلوب")||(r=!1),R(i.regionId,"editRegionId","المنطقة مطلوبة")||(r=!1),!!r)try{const e=await D(`/City/${i.id}`,{method:"PUT",body:{id:i.id,name:i.name,regionId:i.regionId,description:i.description}});if(e&&e.isSuccess===!1){if(e.errors&&Array.isArray(e.errors))Y(e);else{const o=e.message||"حدث خطأ أثناء تحديث المدينة";m.value=o,p.value="error",d.value=!0}return}U.value=!1,c(),m.value="تم تحديث المدينة بنجاح",p.value="success",d.value=!0}catch(e){console.error("Error updating city:",e),m.value="حدث خطأ أثناء تحديث المدينة",p.value="error",d.value=!0}},ve=async()=>{var r,e;if(N.value)try{console.log("Attempting to delete city:",N.value.id);const o=await D(`/City/${N.value.id}`,{method:"DELETE"});if(console.log("Delete response:",o),console.log("Response data:",o.data),o&&o.isSuccess===!1){const a=o.message||((e=(r=o.errors)==null?void 0:r[0])==null?void 0:e.errorMessage)||"حدث خطأ أثناء حذف المدينة";console.log("API returned error:",a),m.value=a,p.value="error",d.value=!0,b.value=!1;return}console.log("City deleted successfully"),b.value=!1,c(),m.value="تم حذف المدينة بنجاح",p.value="success",d.value=!0}catch(o){console.error("Error deleting city:",o),m.value="حدث خطأ في الاتصال بالخادم",p.value="error",d.value=!0,b.value=!1}},fe=async()=>{if(x.value.length!==0)try{const r=x.value.map(a=>D(`/City/${a.id}`,{method:"DELETE"})),o=(await Promise.all(r)).filter(a=>a&&a.isSuccess===!1);if(o.length>0){const a=o.map($=>{var ae,le;return($==null?void 0:$.message)||((le=(ae=$==null?void 0:$.errors)==null?void 0:ae[0])==null?void 0:le.errorMessage)||"حدث خطأ أثناء العملية"}),O=`فشل في حذف ${o.length} عنصر: ${a.join(", ")}`;m.value=O,p.value="error",d.value=!0;return}x.value=[],c(),m.value="تم حذف المدن المحددة بنجاح",p.value="success",d.value=!0}catch(r){console.error("Error deleting selected cities:",r),m.value="حدث خطأ في الاتصال بالخادم",p.value="error",d.value=!0}},ge=r=>{w(),i.id=r.id,i.name=r.name,i.description=r.description,i.regionId=r.regionId||"",U.value=!0},ce=r=>{w(),N.value=r,b.value=!0},Ve=()=>{f.name="",f.regionId="",f.description="",w()};return re(z,()=>{u.value.page=1,c()},{immediate:!1}),re([()=>u.value.page,()=>u.value.itemsPerPage],()=>{c()},{immediate:!1}),Ce(()=>{c(),pe()}),(r,e)=>{const o=we("IconBtn");return E(),Z("div",null,[l(Pe,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),type:p.value,variant:"tonal",closable:"",class:"mb-4"},{default:t(()=>[n(V(m.value),1)]),_:1},8,["modelValue","type"]),l(q,null,{default:t(()=>[l(F,{class:"d-flex justify-space-between align-center pa-6"},{default:t(()=>[e[25]||(e[25]=g("span",{class:"text-h5"},"إدارة المدن",-1)),g("div",Be,[x.value.length>0?(E(),G(y,{key:0,color:"error",variant:"outlined",onClick:fe},{default:t(()=>[n(" حذف المحدد ("+V(x.value.length)+") ",1)]),_:1})):ke("",!0),l(y,{color:"primary",onClick:e[1]||(e[1]=()=>{s(w)(),S.value=!0})},{default:t(()=>e[24]||(e[24]=[n(" إضافة مدينة ")])),_:1})])]),_:1}),l($e),l(B,null,{default:t(()=>[l(K,null,{default:t(()=>[l(C,{cols:"12","offset-md":"8",md:"4"},{default:t(()=>[l(Q,{modelValue:z.value,"onUpdate:modelValue":e[2]||(e[2]=a=>z.value=a),placeholder:"البحث في المدن...","prepend-inner-icon":"mdi-magnify","single-line":"","hide-details":"",dense:"",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),l(Ee,{headers:me.value,items:L.value,loading:H.value,"items-per-page":u.value.itemsPerPage,page:u.value.page,options:u.value,class:"text-no-wrap","show-select":"",modelValue:x.value,"onUpdate:modelValue":e[5]||(e[5]=a=>x.value=a)},{"item.name":t(({item:a})=>[g("div",Ae,[l(Ue,{size:"32",color:"primary",variant:"tonal"},{default:t(()=>[n(V(a.name.charAt(0).toUpperCase()),1)]),_:2},1024),g("div",Re,[g("span",Te,V(a.name),1),g("small",Me,V(a.description||"لا يوجد وصف"),1)])])]),"item.regionName":t(({item:a})=>[a.regionName?(E(),G(ie,{key:0,color:"secondary",variant:"tonal",size:"small"},{default:t(()=>[n(V(a.regionName),1)]),_:2},1024)):(E(),Z("span",ze," لا توجد منطقة "))]),"item.country":t(({item:a})=>[a.country?(E(),G(ie,{key:0,color:"info",variant:"tonal",size:"small"},{default:t(()=>[n(V(a.country),1)]),_:2},1024)):(E(),Z("span",Fe," لا توجد دولة "))]),"item.actions":t(({item:a})=>[g("div",qe,[l(o,{onClick:O=>ge(a)},{default:t(()=>[l(oe,{icon:"tabler-edit"})]),_:2},1032,["onClick"]),l(o,{onClick:O=>ce(a)},{default:t(()=>[l(oe,{icon:"tabler-trash"})]),_:2},1032,["onClick"])])]),bottom:t(()=>[l(B,{class:"pt-2"},{default:t(()=>[g("div",Le,[l(De,{modelValue:u.value.itemsPerPage,"onUpdate:modelValue":e[3]||(e[3]=a=>u.value.itemsPerPage=a),items:[5,10,25,50,100],label:"عناصر في الصفحة:",variant:"underlined",style:{"max-inline-size":"8rem","min-inline-size":"5rem"}},null,8,["modelValue"]),l(Se,{modelValue:u.value.page,"onUpdate:modelValue":e[4]||(e[4]=a=>u.value.page=a),"total-visible":r.$vuetify.display.smAndDown?3:5,length:Math.ceil(M.value/u.value.itemsPerPage)},null,8,["modelValue","total-visible","length"])])]),_:1})]),_:1},8,["headers","items","loading","items-per-page","page","options","modelValue"])]),_:1})]),_:1}),l(X,{modelValue:S.value,"onUpdate:modelValue":e[13]||(e[13]=a=>S.value=a),"max-width":"600px",persistent:""},{default:t(()=>[l(q,null,{default:t(()=>[l(F,{class:"text-h6"},{default:t(()=>e[26]||(e[26]=[n("إضافة مدينة جديدة")])),_:1}),l(B,null,{default:t(()=>[l(ne,{onSubmit:se(h,["prevent"])},{default:t(()=>[l(K,null,{default:t(()=>[l(C,{cols:"12"},{default:t(()=>[l(Q,{modelValue:f.name,"onUpdate:modelValue":e[6]||(e[6]=a=>f.name=a),label:"اسم المدينة",variant:"outlined",required:"",error:s(P)("name"),"error-messages":s(k)("name"),onBlur:e[7]||(e[7]=a=>s(I)("name"))},null,8,["modelValue","error","error-messages"])]),_:1}),l(C,{cols:"12"},{default:t(()=>[l(de,{modelValue:f.regionId,"onUpdate:modelValue":e[8]||(e[8]=a=>f.regionId=a),label:"المنطقة",variant:"outlined",items:j.value,"item-title":"name","item-value":"id",loading:T.value,clearable:"","no-data-text":"لا توجد مناطق متاحة",required:"","prepend-inner-icon":"mdi-map-marker",placeholder:"اختر المنطقة...","hide-no-data":"",error:s(P)("regionId"),"error-messages":s(k)("regionId"),onBlur:e[9]||(e[9]=a=>s(I)("regionId"))},null,8,["modelValue","items","loading","error","error-messages"])]),_:1}),l(C,{cols:"12"},{default:t(()=>[l(ue,{modelValue:f.description,"onUpdate:modelValue":e[10]||(e[10]=a=>f.description=a),label:"الوصف",variant:"outlined",rows:"3",placeholder:"أدخل وصف المدينة...",error:s(P)("description"),"error-messages":s(k)("description"),onBlur:e[11]||(e[11]=a=>s(I)("description"))},null,8,["modelValue","error","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1}),l(J,null,{default:t(()=>[l(W),l(y,{color:"grey-darken-1",variant:"text",onClick:e[12]||(e[12]=a=>S.value=!1)},{default:t(()=>e[27]||(e[27]=[n(" إلغاء ")])),_:1}),l(y,{color:"primary",variant:"flat",disabled:s(_),onClick:h},{default:t(()=>e[28]||(e[28]=[n(" حفظ ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(X,{modelValue:U.value,"onUpdate:modelValue":e[21]||(e[21]=a=>U.value=a),"max-width":"600px",persistent:""},{default:t(()=>[l(q,null,{default:t(()=>[l(F,{class:"text-h6"},{default:t(()=>e[29]||(e[29]=[n("تعديل المدينة")])),_:1}),l(B,null,{default:t(()=>[l(ne,{onSubmit:se(ee,["prevent"])},{default:t(()=>[l(K,null,{default:t(()=>[l(C,{cols:"12"},{default:t(()=>[l(Q,{modelValue:i.name,"onUpdate:modelValue":e[14]||(e[14]=a=>i.name=a),label:"اسم المدينة",variant:"outlined",required:"",error:s(P)("editName"),"error-messages":s(k)("editName"),onBlur:e[15]||(e[15]=a=>s(I)("editName"))},null,8,["modelValue","error","error-messages"])]),_:1}),l(C,{cols:"12"},{default:t(()=>[l(de,{modelValue:i.regionId,"onUpdate:modelValue":e[16]||(e[16]=a=>i.regionId=a),label:"المنطقة",variant:"outlined",items:j.value,"item-title":"name","item-value":"id",loading:T.value,clearable:"","no-data-text":"لا توجد مناطق متاحة",required:"","prepend-inner-icon":"mdi-map-marker",placeholder:"اختر المنطقة...","hide-no-data":"",error:s(P)("editRegionId"),"error-messages":s(k)("editRegionId"),onBlur:e[17]||(e[17]=a=>s(I)("editRegionId"))},null,8,["modelValue","items","loading","error","error-messages"])]),_:1}),l(C,{cols:"12"},{default:t(()=>[l(ue,{modelValue:i.description,"onUpdate:modelValue":e[18]||(e[18]=a=>i.description=a),label:"الوصف",variant:"outlined",rows:"3",placeholder:"أدخل وصف المدينة...",error:s(P)("editDescription"),"error-messages":s(k)("editDescription"),onBlur:e[19]||(e[19]=a=>s(I)("editDescription"))},null,8,["modelValue","error","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1}),l(J,null,{default:t(()=>[l(W),l(y,{color:"grey-darken-1",variant:"text",onClick:e[20]||(e[20]=a=>U.value=!1)},{default:t(()=>e[30]||(e[30]=[n(" إلغاء ")])),_:1}),l(y,{color:"primary",variant:"flat",disabled:s(_),onClick:ee},{default:t(()=>e[31]||(e[31]=[n(" تحديث ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(X,{modelValue:b.value,"onUpdate:modelValue":e[23]||(e[23]=a=>b.value=a),"max-width":"400px"},{default:t(()=>[l(q,null,{default:t(()=>[l(F,{class:"text-h6"},{default:t(()=>e[32]||(e[32]=[n("تأكيد الحذف")])),_:1}),l(B,null,{default:t(()=>{var a;return[e[33]||(e[33]=n(' هل أنت متأكد من حذف المدينة "')),g("strong",null,V((a=N.value)==null?void 0:a.name),1),e[34]||(e[34]=n('"؟ ')),e[35]||(e[35]=g("br",null,null,-1)),e[36]||(e[36]=g("span",{class:"text-error"},"لا يمكن التراجع عن هذا الإجراء.",-1))]}),_:1}),l(J,null,{default:t(()=>[l(W),l(y,{color:"grey-darken-1",variant:"text",onClick:e[22]||(e[22]=a=>b.value=!1)},{default:t(()=>e[37]||(e[37]=[n(" إلغاء ")])),_:1}),l(y,{color:"error",variant:"flat",onClick:ve},{default:t(()=>e[38]||(e[38]=[n(" حذف ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Ba=Ne(je,[["__scopeId","data-v-e5f9ffe1"]]);export{Ba as default};
