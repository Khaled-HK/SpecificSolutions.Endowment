import{u as le}from"./useFormValidation-BDZm5KGL.js";import{$ as T}from"./api-CtflMH2I.js";import{V as $}from"./VCardText-s50m09-4.js";import{V as E}from"./VSpacer-z6O_zCSB.js";import{aZ as te,r as u,aL as oe,P as ae,w as j,D as se,f as ie,o as ue,e as t,b as l,d as c,aa as V,s as n,t as N,m as o}from"./index-Bg4xuB1X.js";import{V as ne}from"./VDivider-DifrbBpe.js";import{V as H,a as D}from"./VRow-BAQcKL2W.js";import{V as U}from"./VTextField-BHcrK3Dr.js";import{V as de}from"./VDataTable-DmO6crSb.js";import{V as G}from"./VChip-H4A1W8rV.js";import{V as me}from"./VAvatar-BsFM-TZJ.js";import{V as L}from"./VDialog-CWNQOwlq.js";import{V as M,b as F,d as I}from"./VCard-DDR_Ypqe.js";import{V as J}from"./VContainer-DqPQl4rx.js";import{V as K}from"./VTextarea-CPImoRvr.js";import{V as pe}from"./VSnackbar-BpN3Wuqs.js";import"./index-9rIf2CJL.js";/* empty css              *//* empty css                   */import"./VCounter-DeZ2K8Z1.js";import"./VImg-NlJe-KFk.js";import"./VField-vHjrVG5U.js";import"./form-Cuh6vgJQ.js";import"./easing-CjukEv2V.js";import"./VInput-jwilm1jM.js";import"./forwardRefs-C-GTDzx5.js";import"./VPagination-Dz7DRFWj.js";import"./VSelect-8-VDNGkd.js";import"./VList-BRBkP7En.js";import"./ssrBoot-YZDDE8_j.js";import"./dialog-transition-BFSA7jd1.js";import"./VMenu-BI4u-Xp1.js";import"./VOverlay-DtU6ufsq.js";import"./delay-B1a-6wqT.js";import"./lazy-CtldSEvy.js";import"./scopeId-CE5cAIa2.js";import"./VCheckboxBtn-DUP9cNAP.js";import"./VSelectionControl-C-J5k8Iq.js";import"./VTable-BTzlTVHi.js";import"./filter-hnx0p1D_.js";import"./VSlideGroup-DaNbB7e2.js";const fe={class:"d-flex align-center"},ve={class:"d-flex flex-column ms-3"},ce={class:"d-block font-weight-medium text-truncate text-high-emphasis"},ge={class:"text-medium-emphasis"},ar=te({__name:"decisions",setup(Ve){const q=u([]),z=u(!1),P=u(0),d=u(!1),f=u(""),v=u("success"),x=u(!1),k=u(!1),w=u(!1),y=u(null),O=u([]),B=u(""),i=u({title:"",description:"",referenceNumber:""}),m=u({id:0,key:"",value:"",title:"",description:"",referenceNumber:"",createdDate:""}),{validationState:a,setErrorsFromResponse:Q,clearErrors:Z,setFieldTouched:p,validateRequired:R,validateLength:A}=le(),{t:C}=oe(),g=u({page:1,itemsPerPage:10,sortBy:[""],sortDesc:[!1]}),W=ae(()=>[{title:C("tableHeaders.decisions.title"),key:"title"},{title:C("tableHeaders.decisions.referenceNumber"),key:"referenceNumber"},{title:C("tableHeaders.decisions.description"),key:"description"},{title:C("tableHeaders.decisions.createdDate"),key:"createdDate"},{title:C("tableHeaders.decisions.actions"),key:"actions",sortable:!1}]),b=async()=>{z.value=!0;try{const s=new URLSearchParams({PageNumber:g.value.page.toString(),PageSize:g.value.itemsPerPage.toString(),SearchTerm:B.value||""}),e=await T(`/Decision/filter?${s}`);if(q.value=e.data.items||[],e.data){P.value=e.data.totalCount||0;const r=Math.ceil(P.value/g.value.itemsPerPage);g.value.page>r&&r>0&&(g.value.page=r,await b())}}catch(s){console.error("Error loading decisions:",s),f.value="حدث خطأ أثناء تحميل القرارات",v.value="error",d.value=!0,q.value=[],P.value=0}finally{z.value=!1}},X=async()=>{Z();let s=!0;if(R(i.value.title,"title","عنوان القرار مطلوب")&&A(i.value.title,"title",1,100,"عنوان القرار يجب أن يكون بين 1 و 100 حرف")||(s=!1),R(i.value.description,"description","وصف القرار مطلوب")&&A(i.value.description,"description",1,500,"وصف القرار يجب أن يكون بين 1 و 500 حرف")||(s=!1),R(i.value.referenceNumber,"referenceNumber","رقم المرجع مطلوب")&&A(i.value.referenceNumber,"referenceNumber",1,50,"رقم المرجع يجب أن يكون بين 1 و 50 حرف")||(s=!1),p("title"),p("description"),p("referenceNumber"),!!s)try{const e={title:i.value.title.trim(),description:i.value.description.trim(),referenceNumber:i.value.referenceNumber.trim(),createdDate:new Date().toISOString()};console.log("Sending decision data:",e);const r=await T("/Decision",{method:"POST",body:e});if(console.log("Response received:",r),r&&r.isSuccess===!1){if(r.errors&&r.errors.length>0){Q(r),p("title"),p("description"),p("referenceNumber");return}else if(r.message){f.value=r.message,v.value="error",d.value=!0;return}}x.value=!1,re(),b(),f.value="تم إضافة القرار بنجاح",v.value="success",d.value=!0}catch(e){console.error("Error adding decision:",e),f.value="حدث خطأ أثناء إضافة القرار",v.value="error",d.value=!0}},Y=async()=>{var s,e;try{const r=await T(`/Decision/${m.value.id}`,{method:"PUT",body:{id:m.value.id,title:m.value.title,description:m.value.description,referenceNumber:m.value.referenceNumber}});if(r&&r.isSuccess===!1){const S=r.message||((e=(s=r.errors)==null?void 0:s[0])==null?void 0:e.errorMessage)||"حدث خطأ أثناء تحديث القرار";f.value=S,v.value="error",d.value=!0;return}k.value=!1,b(),f.value="تم تحديث القرار بنجاح",v.value="success",d.value=!0}catch(r){console.error("Error updating decision:",r),f.value="حدث خطأ أثناء تحديث القرار",v.value="error",d.value=!0}},_=async()=>{var s,e;if(y.value)try{const r=await T(`/Decision/${y.value.id}`,{method:"DELETE"});if(r&&r.isSuccess===!1){const S=r.message||((e=(s=r.errors)==null?void 0:s[0])==null?void 0:e.errorMessage)||"حدث خطأ أثناء حذف القرار";f.value=S,v.value="error",d.value=!0;return}w.value=!1,y.value=null,b(),f.value="تم حذف القرار بنجاح",v.value="success",d.value=!0}catch(r){console.error("Error deleting decision:",r),f.value="حدث خطأ أثناء حذف القرار",v.value="error",d.value=!0}},h=s=>{m.value={...s},k.value=!0},ee=s=>{y.value=s,w.value=!0},re=()=>{i.value={title:"",description:"",referenceNumber:""},Z()};return j(g,()=>{b()},{deep:!0}),j(B,()=>{g.value.page=1,b()}),se(()=>{b()}),(s,e)=>(ue(),ie(M,null,{default:t(()=>[l($,{class:"d-flex align-center flex-wrap gap-4"},{default:t(()=>[e[24]||(e[24]=c("div",{class:"me-3"},[c("h4",{class:"text-h4"}," إدارة القرارات "),c("p",{class:"mb-0"}," عرض وإدارة القرارات في النظام ")],-1)),l(E),l(V,{"prepend-icon":"tabler-plus",onClick:e[0]||(e[0]=r=>x.value=!0)},{default:t(()=>e[23]||(e[23]=[n(" إضافة قرار جديد ")])),_:1})]),_:1}),l(ne),l($,null,{default:t(()=>[l(H,null,{default:t(()=>[l(D,{cols:"12",sm:"4"},{default:t(()=>[l(U,{modelValue:B.value,"onUpdate:modelValue":e[1]||(e[1]=r=>B.value=r),"prepend-inner-icon":"tabler-search",label:"البحث في القرارات","single-line":"","hide-details":"",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(de,{modelValue:O.value,"onUpdate:modelValue":e[2]||(e[2]=r=>O.value=r),headers:W.value,items:q.value,loading:z.value,"items-per-page":g.value.itemsPerPage,page:g.value.page,total:P.value,class:"text-no-wrap","onUpdate:options":e[3]||(e[3]=r=>g.value=r)},{"item.title":t(({item:r})=>[c("div",fe,[l(me,{size:"32",color:"primary",variant:"tonal"},{default:t(()=>[n(N(r.title.charAt(0).toUpperCase()),1)]),_:2},1024),c("div",ve,[c("span",ce,N(r.title),1)])])]),"item.referenceNumber":t(({item:r})=>[l(G,{color:r.referenceNumber?"success":"warning",size:"small"},{default:t(()=>[n(N(r.referenceNumber||"لا يوجد رقم مرجعي"),1)]),_:2},1032,["color"])]),"item.description":t(({item:r})=>[c("span",ge,N(r.description||"لا يوجد وصف"),1)]),"item.createdDate":t(({item:r})=>[l(G,{color:"info",size:"small"},{default:t(()=>[n(N(new Date(r.createdDate).toLocaleDateString("ar-SA")),1)]),_:2},1024)]),"item.actions":t(({item:r})=>[l(V,{icon:"tabler-edit",variant:"text",size:"small",color:"primary",onClick:S=>h(r)},null,8,["onClick"]),l(V,{icon:"tabler-trash",variant:"text",size:"small",color:"error",onClick:S=>ee(r)},null,8,["onClick"])]),_:1},8,["modelValue","headers","items","loading","items-per-page","page","total"]),l(L,{modelValue:x.value,"onUpdate:modelValue":e[11]||(e[11]=r=>x.value=r),"max-width":"500px"},{default:t(()=>[l(M,null,{default:t(()=>[l(F,null,{default:t(()=>e[25]||(e[25]=[c("span",{class:"text-h5"},"إضافة قرار جديد",-1)])),_:1}),l($,null,{default:t(()=>[l(J,null,{default:t(()=>[l(H,null,{default:t(()=>[l(D,{cols:"12"},{default:t(()=>[l(U,{modelValue:i.value.title,"onUpdate:modelValue":e[4]||(e[4]=r=>i.value.title=r),label:"عنوان القرار",required:"",error:o(a).errors.title&&o(a).errors.title.length>0&&o(a).touched.title,"error-messages":o(a).errors.title||[],onBlur:e[5]||(e[5]=r=>o(p)("title"))},null,8,["modelValue","error","error-messages"])]),_:1}),l(D,{cols:"12"},{default:t(()=>[l(U,{modelValue:i.value.referenceNumber,"onUpdate:modelValue":e[6]||(e[6]=r=>i.value.referenceNumber=r),label:"رقم المرجع",required:"",error:o(a).errors.referenceNumber&&o(a).errors.referenceNumber.length>0&&o(a).touched.referenceNumber,"error-messages":o(a).errors.referenceNumber||[],onBlur:e[7]||(e[7]=r=>o(p)("referenceNumber"))},null,8,["modelValue","error","error-messages"])]),_:1}),l(D,{cols:"12"},{default:t(()=>[l(K,{modelValue:i.value.description,"onUpdate:modelValue":e[8]||(e[8]=r=>i.value.description=r),label:"الوصف",rows:"3",error:o(a).errors.description&&o(a).errors.description.length>0&&o(a).touched.description,"error-messages":o(a).errors.description||[],onBlur:e[9]||(e[9]=r=>o(p)("description"))},null,8,["modelValue","error","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1}),l(I,null,{default:t(()=>[l(E),l(V,{color:"blue-darken-1",variant:"text",onClick:e[10]||(e[10]=r=>x.value=!1)},{default:t(()=>e[26]||(e[26]=[n(" إلغاء ")])),_:1}),l(V,{color:"blue-darken-1",onClick:X},{default:t(()=>e[27]||(e[27]=[n(" إضافة ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(L,{modelValue:k.value,"onUpdate:modelValue":e[19]||(e[19]=r=>k.value=r),"max-width":"500px"},{default:t(()=>[l(M,null,{default:t(()=>[l(F,null,{default:t(()=>e[28]||(e[28]=[c("span",{class:"text-h5"},"تعديل القرار",-1)])),_:1}),l($,null,{default:t(()=>[l(J,null,{default:t(()=>[l(H,null,{default:t(()=>[l(D,{cols:"12"},{default:t(()=>[l(U,{modelValue:m.value.title,"onUpdate:modelValue":e[12]||(e[12]=r=>m.value.title=r),label:"عنوان القرار",required:"",error:o(a).errors.title&&o(a).errors.title.length>0&&o(a).touched.title,"error-messages":o(a).errors.title||[],onBlur:e[13]||(e[13]=r=>o(p)("title"))},null,8,["modelValue","error","error-messages"])]),_:1}),l(D,{cols:"12"},{default:t(()=>[l(U,{modelValue:m.value.referenceNumber,"onUpdate:modelValue":e[14]||(e[14]=r=>m.value.referenceNumber=r),label:"رقم المرجع",required:"",error:o(a).errors.referenceNumber&&o(a).errors.referenceNumber.length>0&&o(a).touched.referenceNumber,"error-messages":o(a).errors.referenceNumber||[],onBlur:e[15]||(e[15]=r=>o(p)("referenceNumber"))},null,8,["modelValue","error","error-messages"])]),_:1}),l(D,{cols:"12"},{default:t(()=>[l(K,{modelValue:m.value.description,"onUpdate:modelValue":e[16]||(e[16]=r=>m.value.description=r),label:"الوصف",rows:"3",error:o(a).errors.description&&o(a).errors.description.length>0&&o(a).touched.description,"error-messages":o(a).errors.description||[],onBlur:e[17]||(e[17]=r=>o(p)("description"))},null,8,["modelValue","error","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1}),l(I,null,{default:t(()=>[l(E),l(V,{color:"blue-darken-1",variant:"text",onClick:e[18]||(e[18]=r=>k.value=!1)},{default:t(()=>e[29]||(e[29]=[n(" إلغاء ")])),_:1}),l(V,{color:"blue-darken-1",onClick:Y},{default:t(()=>e[30]||(e[30]=[n(" تحديث ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(L,{modelValue:w.value,"onUpdate:modelValue":e[21]||(e[21]=r=>w.value=r),"max-width":"400px"},{default:t(()=>[l(M,null,{default:t(()=>[l(F,{class:"text-h5"},{default:t(()=>e[31]||(e[31]=[n(" تأكيد الحذف ")])),_:1}),l($,null,{default:t(()=>{var r;return[n(' هل أنت متأكد من حذف القرار "'+N((r=y.value)==null?void 0:r.title)+'"؟ ',1),e[32]||(e[32]=c("br",null,null,-1)),e[33]||(e[33]=c("strong",null,"لا يمكن التراجع عن هذا الإجراء.",-1))]}),_:1}),l(I,null,{default:t(()=>[l(E),l(V,{color:"blue-darken-1",variant:"text",onClick:e[20]||(e[20]=r=>w.value=!1)},{default:t(()=>e[34]||(e[34]=[n(" إلغاء ")])),_:1}),l(V,{color:"error",onClick:_},{default:t(()=>e[35]||(e[35]=[n(" حذف ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(pe,{modelValue:d.value,"onUpdate:modelValue":e[22]||(e[22]=r=>d.value=r),color:v.value,timeout:3e3},{default:t(()=>[n(N(f.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}});export{ar as default};
