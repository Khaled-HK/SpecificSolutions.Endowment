import{u as se}from"./useFormValidation-BDZm5KGL.js";import{$ as M}from"./api-CtflMH2I.js";import{V as $}from"./VCardText-s50m09-4.js";import{V as S}from"./VSpacer-z6O_zCSB.js";import{aZ as ie,r as m,br as H,w as J,D as ne,f as ue,o as de,e as l,b as t,d as q,aa as V,s as p,t as T,m as o}from"./index-Bg4xuB1X.js";import{V as me}from"./VDivider-DifrbBpe.js";import{V as F,a as c}from"./VRow-BAQcKL2W.js";import{V as k}from"./VTextField-BHcrK3Dr.js";import{V as pe}from"./VDataTable-DmO6crSb.js";import{V as K}from"./VChip-H4A1W8rV.js";import{V as L}from"./VDialog-CWNQOwlq.js";import{V as Q,b as A,d as I}from"./VCard-DDR_Ypqe.js";import{V as W}from"./VContainer-DqPQl4rx.js";import{V as X}from"./VTextarea-CPImoRvr.js";import{V as fe}from"./VSnackbar-BpN3Wuqs.js";import"./index-9rIf2CJL.js";/* empty css              */import"./VAvatar-BsFM-TZJ.js";import"./VImg-NlJe-KFk.js";/* empty css                   */import"./VCounter-DeZ2K8Z1.js";import"./VField-vHjrVG5U.js";import"./form-Cuh6vgJQ.js";import"./easing-CjukEv2V.js";import"./VInput-jwilm1jM.js";import"./forwardRefs-C-GTDzx5.js";import"./VPagination-Dz7DRFWj.js";import"./VSelect-8-VDNGkd.js";import"./VList-BRBkP7En.js";import"./ssrBoot-YZDDE8_j.js";import"./dialog-transition-BFSA7jd1.js";import"./VMenu-BI4u-Xp1.js";import"./VOverlay-DtU6ufsq.js";import"./delay-B1a-6wqT.js";import"./lazy-CtldSEvy.js";import"./scopeId-CE5cAIa2.js";import"./VCheckboxBtn-DUP9cNAP.js";import"./VSelectionControl-C-J5k8Iq.js";import"./VTable-BTzlTVHi.js";import"./filter-hnx0p1D_.js";import"./VSlideGroup-DaNbB7e2.js";const tr=ie({__name:"products",setup(ve){const R=m([]),z=m(!1),N=m(0),g=m(!1),y=m(""),b=m("success"),x=m(!1),w=m(!1),C=m(!1),D=m(null),O=m([]),U=m(""),{validationState:s,setErrorsFromResponse:Z,clearErrors:j,hasErrors:G,setFieldTouched:u,validateRequired:E,validateLength:B,addError:f}=se(),n=H({name:"",description:"",price:0,quantity:0}),i=H({id:0,key:"",value:"",name:"",description:"",price:0,quantity:0}),v=m({page:1,itemsPerPage:10,sortBy:[""],sortDesc:[!1]}),Y=[{title:"اسم المادة",key:"name"},{title:"الوصف",key:"description"},{title:"السعر",key:"price"},{title:"الكمية",key:"quantity"},{title:"الإجراءات",key:"actions",sortable:!1}],P=async()=>{z.value=!0;try{const a=new URLSearchParams({PageNumber:v.value.page.toString(),PageSize:v.value.itemsPerPage.toString(),SearchTerm:U.value||""}),e=await M(`/Product/filter?${a}`);if(R.value=e.data.items||[],e.data){N.value=e.data.totalCount||0;const r=Math.ceil(N.value/v.value.itemsPerPage);v.value.page>r&&r>0&&(v.value.page=r,await P())}}catch(a){console.error("Error loading products:",a),y.value="حدث خطأ أثناء تحميل المواد",b.value="error",g.value=!0,R.value=[],N.value=0}finally{z.value=!1}},_=async()=>{var a,e;if(oe())try{const r=await M("/Product",{method:"POST",body:{name:n.name,description:n.description,price:n.price,quantity:n.quantity},onResponseError({response:d}){d._data.errors?Z(d._data):f("name","حدث خطأ أثناء إضافة المادة")}});if(r&&r.isSuccess===!1){const d=r.message||((e=(a=r.errors)==null?void 0:a[0])==null?void 0:e.errorMessage)||"حدث خطأ أثناء إضافة المادة";f("name",d);return}x.value=!1,le(),P(),y.value="تم إضافة المادة بنجاح",b.value="success",g.value=!0}catch(r){console.error("Error adding product:",r),f("name","حدث خطأ أثناء إضافة المادة")}},h=async()=>{var a,e;if(ae())try{const r=await M(`/Product/${i.id}`,{method:"PUT",body:{id:i.id,name:i.name,description:i.description,price:i.price,quantity:i.quantity},onResponseError({response:d}){d._data.errors?Z(d._data):f("editName","حدث خطأ أثناء تحديث المادة")}});if(r&&r.isSuccess===!1){const d=r.message||((e=(a=r.errors)==null?void 0:a[0])==null?void 0:e.errorMessage)||"حدث خطأ أثناء تحديث المادة";f("editName",d);return}w.value=!1,P(),y.value="تم تحديث المادة بنجاح",b.value="success",g.value=!0}catch(r){console.error("Error updating product:",r),f("editName","حدث خطأ أثناء تحديث المادة")}},ee=async()=>{var a,e;if(D.value)try{const r=await M(`/Product/${D.value.id}`,{method:"DELETE"});if(r&&r.isSuccess===!1){const d=r.message||((e=(a=r.errors)==null?void 0:a[0])==null?void 0:e.errorMessage)||"حدث خطأ أثناء حذف المادة";y.value=d,b.value="error",g.value=!0;return}C.value=!1,D.value=null,P(),y.value="تم حذف المادة بنجاح",b.value="success",g.value=!0}catch(r){console.error("Error deleting product:",r),y.value="حدث خطأ أثناء حذف المادة",b.value="error",g.value=!0}},re=a=>{i.value={...a},w.value=!0},te=a=>{D.value=a,C.value=!0},le=()=>{n.value={name:"",description:"",price:0,quantity:0}},oe=()=>{j();let a=!0;return E(n.name,"name","اسم المادة مطلوب")&&B(n.name,"name",2,100,"اسم المادة يجب أن يكون بين 2 و 100 حرف")||(a=!1),E(n.description,"description","وصف المادة مطلوب")&&B(n.description,"description",10,500,"وصف المادة يجب أن يكون بين 10 و 500 حرف")||(a=!1),n.price<0&&(f("price","السعر لا يمكن أن يكون سالب"),a=!1),n.quantity<0&&(f("quantity","الكمية لا يمكن أن تكون سالبة"),a=!1),u("name"),u("description"),u("price"),u("quantity"),a},ae=()=>{j();let a=!0;return E(i.name,"editName","اسم المادة مطلوب")&&B(i.name,"editName",2,100,"اسم المادة يجب أن يكون بين 2 و 100 حرف")||(a=!1),E(i.description,"editDescription","وصف المادة مطلوب")&&B(i.description,"editDescription",10,500,"وصف المادة يجب أن يكون بين 10 و 500 حرف")||(a=!1),i.price<0&&(f("editPrice","السعر لا يمكن أن يكون سالب"),a=!1),i.quantity<0&&(f("editQuantity","الكمية لا يمكن أن تكون سالبة"),a=!1),u("editName"),u("editDescription"),u("editPrice"),u("editQuantity"),a};return J(v,()=>{P()},{deep:!0}),J(U,()=>{v.value.page=1,P()}),ne(()=>{P()}),(a,e)=>(de(),ue(Q,null,{default:l(()=>[t($,{class:"d-flex align-center flex-wrap gap-4"},{default:l(()=>[e[28]||(e[28]=q("div",{class:"me-3"},[q("h4",{class:"text-h4"}," إدارة المواد "),q("p",{class:"mb-0"}," عرض وإدارة المواد في النظام ")],-1)),t(S),t(V,{"prepend-icon":"tabler-plus",onClick:e[0]||(e[0]=r=>x.value=!0)},{default:l(()=>e[27]||(e[27]=[p(" إضافة مادة جديدة ")])),_:1})]),_:1}),t(me),t($,null,{default:l(()=>[t(F,null,{default:l(()=>[t(c,{cols:"12",sm:"4"},{default:l(()=>[t(k,{modelValue:U.value,"onUpdate:modelValue":e[1]||(e[1]=r=>U.value=r),"prepend-inner-icon":"tabler-search",label:"البحث في المواد","single-line":"","hide-details":"",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(pe,{modelValue:O.value,"onUpdate:modelValue":e[2]||(e[2]=r=>O.value=r),headers:Y,items:R.value,loading:z.value,"items-per-page":v.value.itemsPerPage,page:v.value.page,total:N.value,class:"text-no-wrap","onUpdate:options":e[3]||(e[3]=r=>v.value=r)},{"item.price":l(({item:r})=>[t(K,{color:r.price>0?"success":"warning",size:"small"},{default:l(()=>[p(T(r.price||0)+" ريال ",1)]),_:2},1032,["color"])]),"item.quantity":l(({item:r})=>[t(K,{color:r.quantity>0?"primary":"error",size:"small"},{default:l(()=>[p(T(r.quantity||0),1)]),_:2},1032,["color"])]),"item.actions":l(({item:r})=>[t(V,{icon:"tabler-edit",variant:"text",size:"small",color:"primary",onClick:d=>re(r)},null,8,["onClick"]),t(V,{icon:"tabler-trash",variant:"text",size:"small",color:"error",onClick:d=>te(r)},null,8,["onClick"])]),_:1},8,["modelValue","items","loading","items-per-page","page","total"]),t(L,{modelValue:x.value,"onUpdate:modelValue":e[13]||(e[13]=r=>x.value=r),"max-width":"500px"},{default:l(()=>[t(Q,null,{default:l(()=>[t(A,null,{default:l(()=>e[29]||(e[29]=[q("span",{class:"text-h5"},"إضافة مادة جديدة",-1)])),_:1}),t($,null,{default:l(()=>[t(W,null,{default:l(()=>[t(F,null,{default:l(()=>[t(c,{cols:"12"},{default:l(()=>[t(k,{modelValue:n.name,"onUpdate:modelValue":e[4]||(e[4]=r=>n.name=r),label:"اسم المادة",required:"",error:o(s).errors.name&&o(s).errors.name.length>0&&o(s).touched.name,"error-messages":o(s).errors.name||[],onBlur:e[5]||(e[5]=r=>o(u)("name"))},null,8,["modelValue","error","error-messages"])]),_:1}),t(c,{cols:"12"},{default:l(()=>[t(X,{modelValue:n.description,"onUpdate:modelValue":e[6]||(e[6]=r=>n.description=r),label:"الوصف",rows:"3",error:o(s).errors.description&&o(s).errors.description.length>0&&o(s).touched.description,"error-messages":o(s).errors.description||[],onBlur:e[7]||(e[7]=r=>o(u)("description"))},null,8,["modelValue","error","error-messages"])]),_:1}),t(c,{cols:"6"},{default:l(()=>[t(k,{modelValue:n.price,"onUpdate:modelValue":e[8]||(e[8]=r=>n.price=r),modelModifiers:{number:!0},label:"السعر",type:"number",min:"0",step:"0.01",error:o(s).errors.price&&o(s).errors.price.length>0&&o(s).touched.price,"error-messages":o(s).errors.price||[],onBlur:e[9]||(e[9]=r=>o(u)("price"))},null,8,["modelValue","error","error-messages"])]),_:1}),t(c,{cols:"6"},{default:l(()=>[t(k,{modelValue:n.quantity,"onUpdate:modelValue":e[10]||(e[10]=r=>n.quantity=r),modelModifiers:{number:!0},label:"الكمية",type:"number",min:"0",error:o(s).errors.quantity&&o(s).errors.quantity.length>0&&o(s).touched.quantity,"error-messages":o(s).errors.quantity||[],onBlur:e[11]||(e[11]=r=>o(u)("quantity"))},null,8,["modelValue","error","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1}),t(I,null,{default:l(()=>[t(S),t(V,{color:"blue-darken-1",variant:"text",onClick:e[12]||(e[12]=r=>x.value=!1)},{default:l(()=>e[30]||(e[30]=[p(" إلغاء ")])),_:1}),t(V,{color:"blue-darken-1",onClick:_,disabled:o(G)},{default:l(()=>e[31]||(e[31]=[p(" إضافة ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(L,{modelValue:w.value,"onUpdate:modelValue":e[23]||(e[23]=r=>w.value=r),"max-width":"500px"},{default:l(()=>[t(Q,null,{default:l(()=>[t(A,null,{default:l(()=>e[32]||(e[32]=[q("span",{class:"text-h5"},"تعديل المادة",-1)])),_:1}),t($,null,{default:l(()=>[t(W,null,{default:l(()=>[t(F,null,{default:l(()=>[t(c,{cols:"12"},{default:l(()=>[t(k,{modelValue:i.name,"onUpdate:modelValue":e[14]||(e[14]=r=>i.name=r),label:"اسم المادة",required:"",error:o(s).errors.editName&&o(s).errors.editName.length>0&&o(s).touched.editName,"error-messages":o(s).errors.editName||[],onBlur:e[15]||(e[15]=r=>o(u)("editName"))},null,8,["modelValue","error","error-messages"])]),_:1}),t(c,{cols:"12"},{default:l(()=>[t(X,{modelValue:i.description,"onUpdate:modelValue":e[16]||(e[16]=r=>i.description=r),label:"الوصف",rows:"3",error:o(s).errors.editDescription&&o(s).errors.editDescription.length>0&&o(s).touched.editDescription,"error-messages":o(s).errors.editDescription||[],onBlur:e[17]||(e[17]=r=>o(u)("editDescription"))},null,8,["modelValue","error","error-messages"])]),_:1}),t(c,{cols:"6"},{default:l(()=>[t(k,{modelValue:i.price,"onUpdate:modelValue":e[18]||(e[18]=r=>i.price=r),modelModifiers:{number:!0},label:"السعر",type:"number",min:"0",step:"0.01",error:o(s).errors.editPrice&&o(s).errors.editPrice.length>0&&o(s).touched.editPrice,"error-messages":o(s).errors.editPrice||[],onBlur:e[19]||(e[19]=r=>o(u)("editPrice"))},null,8,["modelValue","error","error-messages"])]),_:1}),t(c,{cols:"6"},{default:l(()=>[t(k,{modelValue:i.quantity,"onUpdate:modelValue":e[20]||(e[20]=r=>i.quantity=r),modelModifiers:{number:!0},label:"الكمية",type:"number",min:"0",error:o(s).errors.editQuantity&&o(s).errors.editQuantity.length>0&&o(s).touched.editQuantity,"error-messages":o(s).errors.editQuantity||[],onBlur:e[21]||(e[21]=r=>o(u)("editQuantity"))},null,8,["modelValue","error","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1}),t(I,null,{default:l(()=>[t(S),t(V,{color:"blue-darken-1",variant:"text",onClick:e[22]||(e[22]=r=>w.value=!1)},{default:l(()=>e[33]||(e[33]=[p(" إلغاء ")])),_:1}),t(V,{color:"blue-darken-1",onClick:h,disabled:o(G)},{default:l(()=>e[34]||(e[34]=[p(" تحديث ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(L,{modelValue:C.value,"onUpdate:modelValue":e[25]||(e[25]=r=>C.value=r),"max-width":"400px"},{default:l(()=>[t(Q,null,{default:l(()=>[t(A,{class:"text-h5"},{default:l(()=>e[35]||(e[35]=[p(" تأكيد الحذف ")])),_:1}),t($,null,{default:l(()=>{var r;return[p(' هل أنت متأكد من حذف المادة "'+T((r=D.value)==null?void 0:r.name)+'"؟ ',1),e[36]||(e[36]=q("br",null,null,-1)),e[37]||(e[37]=q("strong",null,"لا يمكن التراجع عن هذا الإجراء.",-1))]}),_:1}),t(I,null,{default:l(()=>[t(S),t(V,{color:"blue-darken-1",variant:"text",onClick:e[24]||(e[24]=r=>C.value=!1)},{default:l(()=>e[38]||(e[38]=[p(" إلغاء ")])),_:1}),t(V,{color:"error",onClick:ee},{default:l(()=>e[39]||(e[39]=[p(" حذف ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(fe,{modelValue:g.value,"onUpdate:modelValue":e[26]||(e[26]=r=>g.value=r),color:b.value,timeout:3e3},{default:l(()=>[p(T(y.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}});export{tr as default};
