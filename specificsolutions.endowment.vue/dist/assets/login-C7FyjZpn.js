import{r as w,e as B}from"./validators-DpYrMFzk.js";import{a$ as D,r as p,i as E,j as I,a as F,c as N,o as S,b as a,e as o,d as r,m as l,H as g,v as y,t as n,aX as U,ac as $,F as M,b6 as V,aW as O}from"./index-MwfLtDLo.js";import{_ as z}from"./AppTextField-DWKI935l.js";import{_ as G}from"./AuthProvider-BDaV3PsM.js";import{u as k}from"./useGenerateImageVariant-DRFtzwvX.js";import{a as H,b as X,c as J,d as K}from"./auth-v2-login-illustration-light-8U3Ay0LB.js";import{a as Q,b as Y}from"./misc-mask-light-CdCn4Q-o.js";import{V as Z}from"./VNodeRenderer-B0USbcez.js";import{u as ee}from"./useAbility-CZrG0Dws.js";import{$ as te}from"./api-CEsALctx.js";import{a as u,V as x}from"./VRow-e00nUW8Q.js";import{V as ae}from"./VImg-BySIvqYD.js";import{V as oe}from"./VCard-9QhAKX3i.js";import{V as h}from"./VCardText-Z8_nMNsF.js";import{V as re}from"./VAlert-0bVr5498.js";import{V as se}from"./VForm-CH7D9bNy.js";import{V as le}from"./VCheckbox-DJfWc7Uq.js";import{V as R}from"./VDivider-CBhIk3Bl.js";import"./helpers-DK5QwNv0.js";import"./form-CmjRGNgb.js";import"./VTextField-CaqLtOHw.js";/* empty css                   */import"./VCounter-BmEZVXsq.js";import"./VField-CA2avuhT.js";import"./easing-CjukEv2V.js";import"./VInput-DSuIku6T.js";import"./forwardRefs-C-GTDzx5.js";import"./index-9rIf2CJL.js";/* empty css              */import"./VAvatar-C0WCgqbl.js";import"./VCheckboxBtn-nFd35fIY.js";import"./VSelectionControl-CPPKon65.js";const ie={class:"auth-logo d-flex align-center gap-x-3"},ne={class:"auth-title"},ue={class:"position-relative bg-background w-100 me-0"},de={class:"d-flex align-center justify-center w-100 h-100",style:{"padding-inline":"6.25rem"}},me=["src"],fe={class:"text-h4 mb-1"},pe={class:"text-capitalize"},ce={class:"d-flex align-center flex-wrap justify-space-between my-6"},Xe=D({__name:"login",setup(ge){const W=k(K,J,X,H,!0),A=k(Y,Q),c=p(!1),v=E(),C=I(),L=ee(),m=p({email:void 0,password:void 0}),b=p(),d=p({email:"admin@demo.com",password:"admin"}),_=p(!1),j=async()=>{try{const e=(await te("/Auth/login",{method:"POST",body:{email:d.value.email,password:d.value.password},onResponseError({response:s}){m.value=s._data.errors||{general:"Login failed. Please check your credentials."}}})).data;if(V("accessToken").value=e.Token,V("userData").value=e,!e.permissions){console.error("User object does not have permissions:",e),m.value={general:"Login failed: No permissions found."};return}const i=[];i.push({action:"read",subject:"Auth"},{action:"write",subject:"Auth"},{action:"delete",subject:"Auth"},{action:"manage",subject:"all"}),e.permissions.forEach(s=>{i.push({action:T(s),subject:q(s)})}),console.log("CASL Rules المحدثة:",i),console.log("User permissions من Backend:",e.permissions),V("userAbilityRules").value=i,L.update(i);const f=v.query.to?String(v.query.to):"/dashboard";console.log("Navigating to:",f),await O(()=>{C.replace(f)})}catch(t){console.error("Login error:",t),m.value={general:"Login failed. Please try again."}}},P=()=>{var t;(t=b.value)==null||t.validate().then(({valid:e})=>{e&&j()})};function T(t){return t.endsWith("_View")?"read":t.endsWith("_Add")?"create":t.endsWith("_Edit")?"update":t.endsWith("_Delete")?"delete":"manage"}function q(t){return t.startsWith("Account_")?"Account":t.startsWith("User_")?"User":t.startsWith("Role_")?"Role":t.startsWith("Decision_")?"Decision":t.startsWith("Request_")?"Request":t.startsWith("Office_")?"Office":t.startsWith("Endowment_")?"Endowment":t.startsWith("City_")?"City":t.startsWith("Region_")?"Region":t.startsWith("Building_")?"Building":"Auth"}return(t,e)=>{const i=F("RouterLink"),f=z;return S(),N(M,null,[a(i,{to:"/"},{default:o(()=>[r("div",ie,[a(l(Z),{nodes:l(g).app.logo},null,8,["nodes"]),r("h1",ne,y(l(g).app.title),1)])]),_:1}),a(x,{"no-gutters":"",class:"auth-wrapper bg-surface"},{default:o(()=>[a(u,{md:"8",class:"d-none d-md-flex"},{default:o(()=>[r("div",ue,[r("div",de,[a(ae,{"max-width":"613",src:l(W),class:"auth-illustration mt-16 mb-2"},null,8,["src"])]),r("img",{class:"auth-footer-mask",src:l(A),alt:"auth-footer-mask",height:"280",width:"100"},null,8,me)])]),_:1}),a(u,{cols:"12",md:"4",class:"auth-card-v2 d-flex align-center justify-center"},{default:o(()=>[a(oe,{flat:"","max-width":500,class:"mt-12 mt-sm-0 pa-4"},{default:o(()=>[a(h,null,{default:o(()=>[r("h4",fe,[e[4]||(e[4]=n(" Welcome to ")),r("span",pe,y(l(g).app.title),1),e[5]||(e[5]=n("! 👋🏻 "))]),e[6]||(e[6]=r("p",{class:"mb-0"}," Please sign-in to your account and start the adventure ",-1))]),_:1}),a(h,null,{default:o(()=>[a(re,{color:"primary",variant:"tonal"},{default:o(()=>e[7]||(e[7]=[r("p",{class:"text-sm mb-2"},[n(" Admin Email: "),r("strong",null,"admin@demo.com"),n(" / Pass: "),r("strong",null,"admin")],-1),r("p",{class:"text-sm mb-0"},[n(" Client Email: "),r("strong",null,"client@demo.com"),n(" / Pass: "),r("strong",null,"client")],-1)])),_:1})]),_:1}),a(h,null,{default:o(()=>[a(l(se),{ref_key:"refVForm",ref:b,onSubmit:U(P,["prevent"])},{default:o(()=>[a(x,null,{default:o(()=>[a(u,{cols:"12"},{default:o(()=>[a(f,{modelValue:d.value.email,"onUpdate:modelValue":e[0]||(e[0]=s=>d.value.email=s),label:"Email",placeholder:"johndoe@email.com",type:"email",autofocus:"",rules:["requiredValidator"in t?t.requiredValidator:l(w),"emailValidator"in t?t.emailValidator:l(B)],"error-messages":m.value.email},null,8,["modelValue","rules","error-messages"])]),_:1}),a(u,{cols:"12"},{default:o(()=>[a(f,{modelValue:d.value.password,"onUpdate:modelValue":e[1]||(e[1]=s=>d.value.password=s),label:"Password",placeholder:"············",rules:["requiredValidator"in t?t.requiredValidator:l(w)],type:c.value?"text":"password",autocomplete:"password","error-messages":m.value.password,"append-inner-icon":c.value?"tabler-eye-off":"tabler-eye","onClick:appendInner":e[2]||(e[2]=s=>c.value=!c.value)},null,8,["modelValue","rules","type","error-messages","append-inner-icon"]),r("div",ce,[a(le,{modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=s=>_.value=s),label:"Remember me"},null,8,["modelValue"]),a(i,{class:"text-primary ms-2 mb-1",to:{name:"forgot-password"}},{default:o(()=>e[8]||(e[8]=[n(" Forgot Password? ")])),_:1})]),a($,{block:"",type:"submit"},{default:o(()=>e[9]||(e[9]=[n(" Login ")])),_:1})]),_:1}),a(u,{cols:"12",class:"text-center"},{default:o(()=>[e[11]||(e[11]=r("span",null,"New on our platform?",-1)),a(i,{class:"text-primary ms-1",to:{name:"register"}},{default:o(()=>e[10]||(e[10]=[n(" Create an account ")])),_:1})]),_:1}),a(u,{cols:"12",class:"d-flex align-center"},{default:o(()=>[a(R),e[12]||(e[12]=r("span",{class:"mx-4"},"or",-1)),a(R)]),_:1}),a(u,{cols:"12",class:"text-center"},{default:o(()=>[a(G)]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})],64)}}});export{Xe as default};
