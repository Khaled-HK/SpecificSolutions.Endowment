import{aZ as me,aL as ve,r as v,br as Y,P as fe,w as h,D as pe,a as ge,c as ee,o as I,b as t,e as a,s as n,t as w,d as g,f as te,l as ce,aa as y,m as f,V as le,aV as ae}from"./index-CK1fpvPu.js";import{u as ye}from"./useFormValidation--K-9QZRo.js";import{$ as E}from"./api-BL_tVZq2.js";import{V as Ve}from"./VAlert-Bt6ZrLfv.js";import{b as R,V as q,d as O}from"./VCard-CIvz8ijW.js";import{V as Ce}from"./VDivider-n3wzZ4nA.js";import{V as S}from"./VCardText-BSu9PeVr.js";import{V as Z,a as D}from"./VRow-Dcd2HQbw.js";import{V as U}from"./VTextField-DGy7sZcW.js";import{V as xe}from"./VDataTable-DFEIpKEL.js";import{V as be}from"./VSelect-CBg7jvEh.js";import{V as we}from"./VPagination-DdfcFOFW.js";import{V as Pe}from"./VChip-DVJAFn6v.js";import{V as ke}from"./VAvatar-CA9yN-sZ.js";import{V as re}from"./VForm-CHv1ws0G.js";import{V as _}from"./VSpacer-BvuZd4xP.js";import{V as G}from"./VDialog-CjDVagY9.js";import{_ as $e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-9rIf2CJL.js";import"./VImg-CGrxDryJ.js";/* empty css              *//* empty css                   */import"./VCounter-B1fUDCB4.js";import"./VField-DG_UKZ_N.js";import"./form-BFxad-Fs.js";import"./easing-CjukEv2V.js";import"./VInput-ktq1dKao.js";import"./forwardRefs-C-GTDzx5.js";import"./VCheckboxBtn-B3kpR2xa.js";import"./VSelectionControl-Ell3Bz42.js";import"./VTable-C9PhsU1j.js";import"./filter-D4hCb-IW.js";import"./VList-CKihbX_m.js";import"./ssrBoot-CzZBr7mp.js";import"./dialog-transition-f96dZRyR.js";import"./VMenu-D7_JD2eI.js";import"./VOverlay-DxyOEWWl.js";import"./delay-BJjrXP-f.js";import"./lazy-Dt_oego-.js";import"./scopeId-DrUTg5WU.js";import"./VSlideGroup-CXxg8nxX.js";const Ee={class:"d-flex gap-2"},Se={class:"d-flex align-center"},De={class:"d-flex flex-column ms-3"},Ue={class:"d-block font-weight-medium text-truncate text-high-emphasis"},Ae={key:1,class:"text-medium-emphasis"},Be={class:"d-flex gap-1"},Me={class:"d-flex flex-wrap justify-center justify-sm-space-between gap-y-2 mt-2"},Te=me({__name:"cities",setup(Ne){const{t:z}=ve(),{setErrorsFromResponse:J,clearErrors:x,getFieldErrors:A,setFieldTouched:B,shouldShowFieldError:M,validateRequired:T}=ye(),j=v([]),L=v(!1),N=v(0),u=v(!1),i=v(""),d=v("success"),P=v(!1),k=v(!1),V=v(!1),$=v(null),C=v([]),F=v(""),p=Y({name:"",country:""}),m=Y({id:0,name:"",country:""}),s=v({page:1,itemsPerPage:10,sortBy:[""],sortDesc:[!1]}),oe=fe(()=>[{title:z("tableHeaders.cities.name"),key:"name"},{title:z("tableHeaders.cities.country"),key:"country"},{title:z("tableHeaders.cities.actions"),key:"actions",sortable:!1}]),c=async()=>{L.value=!0;try{const r=new URLSearchParams({PageNumber:s.value.page.toString(),PageSize:s.value.itemsPerPage.toString(),SearchTerm:F.value||""}),e=await E(`/City/filter?${r}`);if(j.value=e.data.items||[],e.data){N.value=e.data.totalCount||0;const o=Math.ceil(N.value/s.value.itemsPerPage);s.value.page>o&&o>0&&(s.value.page=o,await c())}}catch(r){console.error("Error loading cities:",r),i.value="حدث خطأ أثناء تحميل المدن",d.value="error",u.value=!0,j.value=[],N.value=0}finally{L.value=!1}},K=async()=>{x();let r=!0;if(T(p.name,"name","اسم المدينة مطلوب")||(r=!1),T(p.country,"country","الدولة مطلوبة")||(r=!1),!!r)try{const e=await E("/City",{method:"POST",body:{name:p.name,country:p.country}});if(e&&e.isSuccess===!1){if(e.errors&&Array.isArray(e.errors))J(e);else{const o=e.message||"حدث خطأ أثناء إضافة المدينة";i.value=o,d.value="error",u.value=!0}return}P.value=!1,de(),c(),i.value="تم إضافة المدينة بنجاح",d.value="success",u.value=!0}catch(e){console.error("Error adding city:",e),i.value="حدث خطأ أثناء إضافة المدينة",d.value="error",u.value=!0}},Q=async()=>{x();let r=!0;if(T(m.name,"editName","اسم المدينة مطلوب")||(r=!1),T(m.country,"editCountry","الدولة مطلوبة")||(r=!1),!!r)try{const e=await E(`/City/${m.id}`,{method:"PUT",body:{id:m.id,name:m.name,country:m.country}});if(e&&e.isSuccess===!1){if(e.errors&&Array.isArray(e.errors))J(e);else{const o=e.message||"حدث خطأ أثناء تحديث المدينة";i.value=o,d.value="error",u.value=!0}return}k.value=!1,c(),i.value="تم تحديث المدينة بنجاح",d.value="success",u.value=!0}catch(e){console.error("Error updating city:",e),i.value="حدث خطأ أثناء تحديث المدينة",d.value="error",u.value=!0}},se=async()=>{var r,e;if($.value)try{console.log("Attempting to delete city:",$.value.id);const o=await E(`/City/${$.value.id}`,{method:"DELETE"});if(console.log("Delete response:",o),console.log("Response data:",o.data),o&&o.isSuccess===!1){const l=o.message||((e=(r=o.errors)==null?void 0:r[0])==null?void 0:e.errorMessage)||"حدث خطأ أثناء حذف المدينة";console.log("API returned error:",l),i.value=l,d.value="error",u.value=!0,V.value=!1;return}console.log("City deleted successfully"),V.value=!1,c(),i.value="تم حذف المدينة بنجاح",d.value="success",u.value=!0}catch(o){console.error("Error deleting city:",o),i.value="حدث خطأ في الاتصال بالخادم",d.value="error",u.value=!0,V.value=!1}},ne=async()=>{if(C.value.length!==0)try{const r=C.value.map(l=>E(`/City/${l.id}`,{method:"DELETE"})),o=(await Promise.all(r)).filter(l=>l&&l.isSuccess===!1);if(o.length>0){const l=o.map(b=>{var W,X;return(b==null?void 0:b.message)||((X=(W=b==null?void 0:b.errors)==null?void 0:W[0])==null?void 0:X.errorMessage)||"حدث خطأ أثناء العملية"}),H=`فشل في حذف ${o.length} عنصر: ${l.join(", ")}`;i.value=H,d.value="error",u.value=!0;return}C.value=[],c(),i.value="تم حذف المدن المحددة بنجاح",d.value="success",u.value=!0}catch(r){console.error("Error deleting selected cities:",r),i.value="حدث خطأ في الاتصال بالخادم",d.value="error",u.value=!0}},ue=r=>{x(),m.id=r.id,m.name=r.name,m.country=r.country||"",k.value=!0},ie=r=>{x(),$.value=r,V.value=!0},de=()=>{p.name="",p.country="",x()};return h(F,()=>{s.value.page=1,c()},{immediate:!1}),h([()=>s.value.page,()=>s.value.itemsPerPage],()=>{c()},{immediate:!1}),pe(()=>{c()}),(r,e)=>{const o=ge("IconBtn");return I(),ee("div",null,[t(Ve,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=l=>u.value=l),type:d.value,variant:"tonal",closable:"",class:"mb-4"},{default:a(()=>[n(w(i.value),1)]),_:1},8,["modelValue","type"]),t(q,null,{default:a(()=>[t(R,{class:"d-flex justify-space-between align-center pa-6"},{default:a(()=>[e[21]||(e[21]=g("span",{class:"text-h5"},"إدارة المدن",-1)),g("div",Ee,[C.value.length>0?(I(),te(y,{key:0,color:"error",variant:"outlined",onClick:ne},{default:a(()=>[n(" حذف المحدد ("+w(C.value.length)+") ",1)]),_:1})):ce("",!0),t(y,{color:"primary",onClick:e[1]||(e[1]=()=>{f(x)(),P.value=!0})},{default:a(()=>e[20]||(e[20]=[n(" إضافة مدينة ")])),_:1})])]),_:1}),t(Ce),t(S,null,{default:a(()=>[t(Z,null,{default:a(()=>[t(D,{cols:"12","offset-md":"8",md:"4"},{default:a(()=>[t(U,{modelValue:F.value,"onUpdate:modelValue":e[2]||(e[2]=l=>F.value=l),placeholder:"البحث في المدن...","prepend-inner-icon":"mdi-magnify","single-line":"","hide-details":"",dense:"",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),t(xe,{headers:oe.value,items:j.value,loading:L.value,"items-per-page":s.value.itemsPerPage,page:s.value.page,options:s.value,class:"text-no-wrap","show-select":"",modelValue:C.value,"onUpdate:modelValue":e[5]||(e[5]=l=>C.value=l)},{"item.name":a(({item:l})=>[g("div",Se,[t(ke,{size:"32",color:"primary",variant:"tonal"},{default:a(()=>[n(w(l.name.charAt(0).toUpperCase()),1)]),_:2},1024),g("div",De,[g("span",Ue,w(l.name),1)])])]),"item.country":a(({item:l})=>[l.country?(I(),te(Pe,{key:0,color:"info",variant:"tonal",size:"small"},{default:a(()=>[n(w(l.country),1)]),_:2},1024)):(I(),ee("span",Ae," لا توجد دولة "))]),"item.actions":a(({item:l})=>[g("div",Be,[t(o,{onClick:H=>ue(l)},{default:a(()=>[t(le,{icon:"tabler-edit"})]),_:2},1032,["onClick"]),t(o,{onClick:H=>ie(l)},{default:a(()=>[t(le,{icon:"tabler-trash"})]),_:2},1032,["onClick"])])]),bottom:a(()=>[t(S,{class:"pt-2"},{default:a(()=>[g("div",Me,[t(be,{modelValue:s.value.itemsPerPage,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.itemsPerPage=l),items:[5,10,25,50,100],label:"عناصر في الصفحة:",variant:"underlined",style:{"max-inline-size":"8rem","min-inline-size":"5rem"}},null,8,["modelValue"]),t(we,{modelValue:s.value.page,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.page=l),"total-visible":r.$vuetify.display.smAndDown?3:5,length:Math.ceil(N.value/s.value.itemsPerPage)},null,8,["modelValue","total-visible","length"])])]),_:1})]),_:1},8,["headers","items","loading","items-per-page","page","options","modelValue"])]),_:1})]),_:1}),t(G,{modelValue:P.value,"onUpdate:modelValue":e[11]||(e[11]=l=>P.value=l),"max-width":"600px",persistent:""},{default:a(()=>[t(q,null,{default:a(()=>[t(R,{class:"text-h6"},{default:a(()=>e[22]||(e[22]=[n("إضافة مدينة جديدة")])),_:1}),t(S,null,{default:a(()=>[t(re,{onSubmit:ae(K,["prevent"])},{default:a(()=>[t(Z,null,{default:a(()=>[t(D,{cols:"12"},{default:a(()=>[t(U,{modelValue:p.name,"onUpdate:modelValue":e[6]||(e[6]=l=>p.name=l),label:"اسم المدينة",variant:"outlined",required:"",error:f(M)("name"),"error-messages":f(A)("name"),onBlur:e[7]||(e[7]=l=>f(B)("name"))},null,8,["modelValue","error","error-messages"])]),_:1}),t(D,{cols:"12"},{default:a(()=>[t(U,{modelValue:p.country,"onUpdate:modelValue":e[8]||(e[8]=l=>p.country=l),label:"الدولة",variant:"outlined",required:"",error:f(M)("country"),"error-messages":f(A)("country"),onBlur:e[9]||(e[9]=l=>f(B)("country"))},null,8,["modelValue","error","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1}),t(O,null,{default:a(()=>[t(_),t(y,{color:"grey-darken-1",variant:"text",onClick:e[10]||(e[10]=l=>P.value=!1)},{default:a(()=>e[23]||(e[23]=[n(" إلغاء ")])),_:1}),t(y,{color:"primary",variant:"flat",onClick:K},{default:a(()=>e[24]||(e[24]=[n(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(G,{modelValue:k.value,"onUpdate:modelValue":e[17]||(e[17]=l=>k.value=l),"max-width":"600px",persistent:""},{default:a(()=>[t(q,null,{default:a(()=>[t(R,{class:"text-h6"},{default:a(()=>e[25]||(e[25]=[n("تعديل المدينة")])),_:1}),t(S,null,{default:a(()=>[t(re,{onSubmit:ae(Q,["prevent"])},{default:a(()=>[t(Z,null,{default:a(()=>[t(D,{cols:"12"},{default:a(()=>[t(U,{modelValue:m.name,"onUpdate:modelValue":e[12]||(e[12]=l=>m.name=l),label:"اسم المدينة",variant:"outlined",required:"",error:f(M)("editName"),"error-messages":f(A)("editName"),onBlur:e[13]||(e[13]=l=>f(B)("editName"))},null,8,["modelValue","error","error-messages"])]),_:1}),t(D,{cols:"12"},{default:a(()=>[t(U,{modelValue:m.country,"onUpdate:modelValue":e[14]||(e[14]=l=>m.country=l),label:"الدولة",variant:"outlined",required:"",error:f(M)("editCountry"),"error-messages":f(A)("editCountry"),onBlur:e[15]||(e[15]=l=>f(B)("editCountry"))},null,8,["modelValue","error","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1}),t(O,null,{default:a(()=>[t(_),t(y,{color:"grey-darken-1",variant:"text",onClick:e[16]||(e[16]=l=>k.value=!1)},{default:a(()=>e[26]||(e[26]=[n(" إلغاء ")])),_:1}),t(y,{color:"primary",variant:"flat",onClick:Q},{default:a(()=>e[27]||(e[27]=[n(" تحديث ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(G,{modelValue:V.value,"onUpdate:modelValue":e[19]||(e[19]=l=>V.value=l),"max-width":"400px"},{default:a(()=>[t(q,null,{default:a(()=>[t(R,{class:"text-h6"},{default:a(()=>e[28]||(e[28]=[n("تأكيد الحذف")])),_:1}),t(S,null,{default:a(()=>{var l;return[e[29]||(e[29]=n(' هل أنت متأكد من حذف المدينة "')),g("strong",null,w((l=$.value)==null?void 0:l.name),1),e[30]||(e[30]=n('"؟ ')),e[31]||(e[31]=g("br",null,null,-1)),e[32]||(e[32]=g("span",{class:"text-error"},"لا يمكن التراجع عن هذا الإجراء.",-1))]}),_:1}),t(O,null,{default:a(()=>[t(_),t(y,{color:"grey-darken-1",variant:"text",onClick:e[18]||(e[18]=l=>V.value=!1)},{default:a(()=>e[33]||(e[33]=[n(" إلغاء ")])),_:1}),t(y,{color:"error",variant:"flat",onClick:se},{default:a(()=>e[34]||(e[34]=[n(" حذف ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),wt=$e(Te,[["__scopeId","data-v-b7e5be42"]]);export{wt as default};
