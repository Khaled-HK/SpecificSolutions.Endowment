import{cc as E,b5 as l}from"./index-B8v18vV9.js";import{a as q,w as S}from"./index-9rIf2CJL.js";class R extends Error{constructor(r,s){super(r,s),this.name="FetchError",s!=null&&s.cause&&!this.cause&&(this.cause=s.cause)}}function A(o){var i,f,e,u,d;const r=((i=o.error)==null?void 0:i.message)||((f=o.error)==null?void 0:f.toString())||"",s=((e=o.request)==null?void 0:e.method)||((u=o.options)==null?void 0:u.method)||"GET",c=((d=o.request)==null?void 0:d.url)||String(o.request)||"/",p=`[${s}] ${JSON.stringify(c)}`,n=o.response?`${o.response.status} ${o.response.statusText}`:"<no response>",h=`${p}: ${n}${r?` ${r}`:""}`,t=new R(h,o.error?{cause:o.error}:void 0);for(const a of["request","options","response"])Object.defineProperty(t,a,{get(){return o[a]}});for(const[a,y]of[["data","_data"],["status","status"],["statusCode","status"],["statusText","statusText"],["statusMessage","statusText"]])Object.defineProperty(t,a,{get(){return o.response&&o.response[y]}});return t}const $=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function w(o="GET"){return $.has(o.toUpperCase())}function j(o){if(o===void 0)return!1;const r=typeof o;return r==="string"||r==="number"||r==="boolean"||r===null?!0:r!=="object"?!1:Array.isArray(o)?!0:o.buffer?!1:o.constructor&&o.constructor.name==="Object"||typeof o.toJSON=="function"}const k=new Set(["image/svg","application/xml","application/xhtml","application/html"]),C=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function D(o=""){if(!o)return"json";const r=o.split(";").shift()||"";return C.test(r)?"json":k.has(r)||r.startsWith("text/")?"text":"blob"}function L(o,r,s,c){const p=P((r==null?void 0:r.headers)??(o==null?void 0:o.headers),s==null?void 0:s.headers,c);let n;return(s!=null&&s.query||s!=null&&s.params||r!=null&&r.params||r!=null&&r.query)&&(n={...s==null?void 0:s.params,...s==null?void 0:s.query,...r==null?void 0:r.params,...r==null?void 0:r.query}),{...s,...r,query:n,params:n,headers:p}}function P(o,r,s){if(!r)return new s(o);const c=new s(r);if(o)for(const[p,n]of Symbol.iterator in o||Array.isArray(o)?o:new s(o))c.set(p,n);return c}async function b(o,r){if(r)if(Array.isArray(r))for(const s of r)await s(o);else await r(o)}const U=new Set([408,409,425,429,500,502,503,504]),_=new Set([101,204,205,304]);function g(o={}){const{fetch:r=globalThis.fetch,Headers:s=globalThis.Headers,AbortController:c=globalThis.AbortController}=o;async function p(t){const i=t.error&&t.error.name==="AbortError"&&!t.options.timeout||!1;if(t.options.retry!==!1&&!i){let e;typeof t.options.retry=="number"?e=t.options.retry:e=w(t.options.method)?0:1;const u=t.response&&t.response.status||500;if(e>0&&(Array.isArray(t.options.retryStatusCodes)?t.options.retryStatusCodes.includes(u):U.has(u))){const d=typeof t.options.retryDelay=="function"?t.options.retryDelay(t):t.options.retryDelay||0;return d>0&&await new Promise(a=>setTimeout(a,d)),n(t.request,{...t.options,retry:e-1})}}const f=A(t);throw Error.captureStackTrace&&Error.captureStackTrace(f,n),f}const n=async function(i,f={}){const e={request:i,options:L(i,f,o.defaults,s),response:void 0,error:void 0};e.options.method&&(e.options.method=e.options.method.toUpperCase()),e.options.onRequest&&await b(e,e.options.onRequest),typeof e.request=="string"&&(e.options.baseURL&&(e.request=q(e.request,e.options.baseURL)),e.options.query&&(e.request=S(e.request,e.options.query),delete e.options.query),"query"in e.options&&delete e.options.query,"params"in e.options&&delete e.options.params),e.options.body&&w(e.options.method)&&(j(e.options.body)?(e.options.body=typeof e.options.body=="string"?e.options.body:JSON.stringify(e.options.body),e.options.headers=new s(e.options.headers||{}),e.options.headers.has("content-type")||e.options.headers.set("content-type","application/json"),e.options.headers.has("accept")||e.options.headers.set("accept","application/json")):("pipeTo"in e.options.body&&typeof e.options.body.pipeTo=="function"||typeof e.options.body.pipe=="function")&&("duplex"in e.options||(e.options.duplex="half")));let u;if(!e.options.signal&&e.options.timeout){const a=new c;u=setTimeout(()=>{const y=new Error("[TimeoutError]: The operation was aborted due to timeout");y.name="TimeoutError",y.code=23,a.abort(y)},e.options.timeout),e.options.signal=a.signal}try{e.response=await r(e.request,e.options)}catch(a){return e.error=a,e.options.onRequestError&&await b(e,e.options.onRequestError),await p(e)}finally{u&&clearTimeout(u)}if((e.response.body||e.response._bodyInit)&&!_.has(e.response.status)&&e.options.method!=="HEAD"){const a=(e.options.parseResponse?"json":e.options.responseType)||D(e.response.headers.get("content-type")||"");switch(a){case"json":{const y=await e.response.text(),T=e.options.parseResponse||E;e.response._data=T(y);break}case"stream":{e.response._data=e.response.body||e.response._bodyInit;break}default:e.response._data=await e.response[a]()}}return e.options.onResponse&&await b(e,e.options.onResponse),!e.options.ignoreResponseError&&e.response.status>=400&&e.response.status<600?(e.options.onResponseError&&await b(e,e.options.onResponseError),await p(e)):e.response},h=async function(i,f){return(await n(i,f))._data};return h.raw=n,h.native=(...t)=>r(...t),h.create=(t={},i={})=>g({...o,...i,defaults:{...o.defaults,...i.defaults,...t}}),h}const m=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),v=m.fetch?(...o)=>m.fetch(...o):()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!")),O=m.Headers,F=m.AbortController,H=g({fetch:v,Headers:O,AbortController:F}),J=H.create({baseURL:"http://localhost:7140/api",async onRequest({options:o}){const r=l("accessToken").value,s=l("userData").value;r&&(o.headers={...o.headers,Authorization:`Bearer ${r}`}),s&&s.id&&(o.headers={...o.headers,"X-User-Id":s.id});const c=l("i18n_redirected").value||"ar",n={ar:"ar-LY",en:"en-US"}[c]||"ar-LY";o.headers={...o.headers,"Accept-Language":n}},async onResponseError({response:o}){if(o.status===401||o.status===403){console.warn("Token expired or unauthorized, clearing cookies...");const r=l("accessToken"),s=l("userData");r.value=null,s.value=null,process.client&&(window.location.href="/login")}}});export{J as $};
