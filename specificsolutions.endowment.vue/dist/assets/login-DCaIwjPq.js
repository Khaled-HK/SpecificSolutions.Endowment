import{r as k,e as B}from"./validators-DpYrMFzk.js";import{a$ as I,r as p,i as F,j as N,a as S,c as U,o as $,b as a,e as o,d as s,m as l,H as g,v as x,t as n,aX as M,ac as O,F as z,b6 as V,aW as G}from"./index-HAXSP913.js";import{_ as H}from"./AppTextField-BayU8qJl.js";import{_ as X}from"./AuthProvider-COQtp1jO.js";import{u as R}from"./useGenerateImageVariant-CZ3la69V.js";import{a as J,b as K,c as Q,d as Y}from"./auth-v2-login-illustration-light-8U3Ay0LB.js";import{a as Z,b as ee}from"./misc-mask-light-CdCn4Q-o.js";import{V as te}from"./VNodeRenderer-CGlrXtdP.js";import{u as ae}from"./useAbility-7gXosNU9.js";import{$ as oe}from"./api-D8tF8UkA.js";import{a as u,V as W}from"./VRow-D-WQ3rzz.js";import{V as se}from"./VImg-19-9jxk0.js";import{V as re}from"./VCard-D2JA4AmT.js";import{V as h}from"./VCardText-BH-9XFE8.js";import{V as le}from"./VAlert-C8WaH8Tm.js";import{V as ie}from"./VForm-B8aqMCjq.js";import{V as ne}from"./VCheckbox-YO2u8-YN.js";import{V as A}from"./VDivider-DWzVCSwo.js";import"./helpers-DK5QwNv0.js";import"./form-DhXBopYm.js";import"./VTextField-Dk4aTvnR.js";/* empty css                   */import"./VCounter-BRAxYcMs.js";import"./VField-DKyThWVI.js";import"./easing-CjukEv2V.js";import"./VInput-BcFLJ-wF.js";import"./forwardRefs-C-GTDzx5.js";import"./index-9rIf2CJL.js";/* empty css              */import"./VAvatar-rXBq910H.js";import"./VCheckboxBtn-CxN3bhUn.js";import"./VSelectionControl-B_YabqNW.js";const ue={class:"auth-logo d-flex align-center gap-x-3"},de={class:"auth-title"},me={class:"position-relative bg-background w-100 me-0"},fe={class:"d-flex align-center justify-center w-100 h-100",style:{"padding-inline":"6.25rem"}},pe=["src"],ce={class:"text-h4 mb-1"},ge={class:"text-capitalize"},Ve={class:"d-flex align-center flex-wrap justify-space-between my-6"},Ke=I({__name:"login",setup(he){const C=R(Y,Q,K,J,!0),L=R(ee,Z),c=p(!1),b=F(),j=N(),D=ae(),m=p({email:void 0,password:void 0}),v=p(),d=p({email:"admin@demo.com",password:"admin"}),_=p(!1),P=async()=>{try{const e=(await oe("/Auth/login",{method:"POST",body:{email:d.value.email,password:d.value.password},onResponseError({response:r}){m.value=r._data.errors||{general:"Login failed. Please check your credentials."}}})).data;if(V("accessToken").value=e.Token,V("userData").value=e,!e.permissions){console.error("User object does not have permissions:",e),m.value={general:"Login failed: No permissions found."};return}const i=[];i.push({action:"read",subject:"Auth"},{action:"write",subject:"Auth"},{action:"delete",subject:"Auth"},{action:"View",subject:"Dashboard"}),e.permissions.forEach(r=>{const w=E(r),y=q(r);w&&y&&i.push({action:w,subject:y})}),console.log("CASL Rules 丕丨丿孬丞:",i),console.log("User permissions  Backend:",e.permissions),V("userAbilityRules").value=i,D.update(i);const f=b.query.to?String(b.query.to):"/dashboard";console.log("Navigating to:",f),await G(()=>{j.replace(f)})}catch(t){console.error("Login error:",t),m.value={general:"Login failed. Please try again."}}},T=()=>{var t;(t=v.value)==null||t.validate().then(({valid:e})=>{e&&P()})};function E(t){return t.endsWith("_View")?"View":t.endsWith("_Add")?"Add":t.endsWith("_Edit")?"Edit":t.endsWith("_Delete")?"Delete":null}function q(t){return t.startsWith("Account_")?"Account":t.startsWith("User_")?"User":t.startsWith("Role_")?"Role":t.startsWith("Decision_")?"Decision":t.startsWith("Request_")?"Request":t.startsWith("Office_")?"Office":t.startsWith("Endowment_")?"Endowment":t.startsWith("City_")?"City":t.startsWith("Region_")?"Region":t.startsWith("Building_")?"Building":null}return(t,e)=>{const i=S("RouterLink"),f=H;return $(),U(z,null,[a(i,{to:"/"},{default:o(()=>[s("div",ue,[a(l(te),{nodes:l(g).app.logo},null,8,["nodes"]),s("h1",de,x(l(g).app.title),1)])]),_:1}),a(W,{"no-gutters":"",class:"auth-wrapper bg-surface"},{default:o(()=>[a(u,{md:"8",class:"d-none d-md-flex"},{default:o(()=>[s("div",me,[s("div",fe,[a(se,{"max-width":"613",src:l(C),class:"auth-illustration mt-16 mb-2"},null,8,["src"])]),s("img",{class:"auth-footer-mask",src:l(L),alt:"auth-footer-mask",height:"280",width:"100"},null,8,pe)])]),_:1}),a(u,{cols:"12",md:"4",class:"auth-card-v2 d-flex align-center justify-center"},{default:o(()=>[a(re,{flat:"","max-width":500,class:"mt-12 mt-sm-0 pa-4"},{default:o(()=>[a(h,null,{default:o(()=>[s("h4",ce,[e[4]||(e[4]=n(" Welcome to ")),s("span",ge,x(l(g).app.title),1),e[5]||(e[5]=n("!  "))]),e[6]||(e[6]=s("p",{class:"mb-0"}," Please sign-in to your account and start the adventure ",-1))]),_:1}),a(h,null,{default:o(()=>[a(le,{color:"primary",variant:"tonal"},{default:o(()=>e[7]||(e[7]=[s("p",{class:"text-sm mb-2"},[n(" Admin Email: "),s("strong",null,"admin@demo.com"),n(" / Pass: "),s("strong",null,"admin")],-1),s("p",{class:"text-sm mb-0"},[n(" Client Email: "),s("strong",null,"client@demo.com"),n(" / Pass: "),s("strong",null,"client")],-1)])),_:1})]),_:1}),a(h,null,{default:o(()=>[a(l(ie),{ref_key:"refVForm",ref:v,onSubmit:M(T,["prevent"])},{default:o(()=>[a(W,null,{default:o(()=>[a(u,{cols:"12"},{default:o(()=>[a(f,{modelValue:d.value.email,"onUpdate:modelValue":e[0]||(e[0]=r=>d.value.email=r),label:"Email",placeholder:"johndoe@email.com",type:"email",autofocus:"",rules:["requiredValidator"in t?t.requiredValidator:l(k),"emailValidator"in t?t.emailValidator:l(B)],"error-messages":m.value.email},null,8,["modelValue","rules","error-messages"])]),_:1}),a(u,{cols:"12"},{default:o(()=>[a(f,{modelValue:d.value.password,"onUpdate:modelValue":e[1]||(e[1]=r=>d.value.password=r),label:"Password",placeholder:"路路路路路路路路路路路路",rules:["requiredValidator"in t?t.requiredValidator:l(k)],type:c.value?"text":"password",autocomplete:"password","error-messages":m.value.password,"append-inner-icon":c.value?"tabler-eye-off":"tabler-eye","onClick:appendInner":e[2]||(e[2]=r=>c.value=!c.value)},null,8,["modelValue","rules","type","error-messages","append-inner-icon"]),s("div",Ve,[a(ne,{modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=r=>_.value=r),label:"Remember me"},null,8,["modelValue"]),a(i,{class:"text-primary ms-2 mb-1",to:{name:"forgot-password"}},{default:o(()=>e[8]||(e[8]=[n(" Forgot Password? ")])),_:1})]),a(O,{block:"",type:"submit"},{default:o(()=>e[9]||(e[9]=[n(" Login ")])),_:1})]),_:1}),a(u,{cols:"12",class:"text-center"},{default:o(()=>[e[11]||(e[11]=s("span",null,"New on our platform?",-1)),a(i,{class:"text-primary ms-1",to:{name:"register"}},{default:o(()=>e[10]||(e[10]=[n(" Create an account ")])),_:1})]),_:1}),a(u,{cols:"12",class:"d-flex align-center"},{default:o(()=>[a(A),e[12]||(e[12]=s("span",{class:"mx-4"},"or",-1)),a(A)]),_:1}),a(u,{cols:"12",class:"text-center"},{default:o(()=>[a(X)]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})],64)}}});export{Ke as default};
