import{a$ as ne,r as s,w as K,G as ue,a as de,c as z,o as k,b as a,e as t,t as i,v as c,d as p,f as R,l as me,ac as V,V as Q,aX as W}from"./index-BtfhVSwE.js";import{$ as w}from"./api-DMVoFGKx.js";import{V as ve}from"./VAlert-XzerbF0T.js";import{b as M,V as T,d as j}from"./VCard-BMKvoKHc.js";import{V as pe}from"./VDivider-BskaqePa.js";import{V as U}from"./VCardText-CQ_kqBGy.js";import{V as q,a as C}from"./VRow-DRm1vRrS.js";import{V as L}from"./VTextField-BP9Yt9Bg.js";import{V as fe}from"./VDataTable-arlORk0G.js";import{V as ge}from"./VSelect-CV3yq3nX.js";import{V as ce}from"./VPagination-C4bWb9ez.js";import{V as Y}from"./VChip-DkJYynY0.js";import{V as Ve}from"./VAvatar-Di7p70o_.js";import{V as Z}from"./VForm-DB6_r-fV.js";import{V as h}from"./VAutocomplete-DFOTlZAA.js";import{V as ee}from"./VTextarea-CHMuYu0m.js";import{V as F}from"./VSpacer-affoxjwI.js";import{V as O}from"./VDialog-BR-8AWmC.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-9rIf2CJL.js";import"./VImg-BKSypqLi.js";/* empty css              *//* empty css                   */import"./VCounter-CfEBC7nV.js";import"./VField-DiZdpAIN.js";import"./form-DUL9ls8s.js";import"./easing-CjukEv2V.js";import"./VInput-DIAfQwmh.js";import"./forwardRefs-C-GTDzx5.js";import"./VCheckboxBtn-CPFIFhHb.js";import"./VSelectionControl-C7oASZhF.js";import"./VTable-DxW4-iwJ.js";import"./filter-BALRNvRS.js";import"./VList-Cp76iGum.js";import"./ssrBoot-BJLk6Iwd.js";import"./dialog-transition-CRKIv97n.js";import"./VMenu-Cpm7zxfp.js";import"./VOverlay-BfQOvZM9.js";import"./delay-BDF9y9xB.js";import"./lazy-NLe1V18V.js";import"./scopeId-Cvig9lvB.js";import"./VSlideGroup-BbCsdCyI.js";const xe={class:"d-flex gap-2"},Ce={class:"d-flex align-center"},be={class:"d-flex flex-column ms-3"},ke={class:"d-block font-weight-medium text-truncate text-high-emphasis"},we={class:"text-medium-emphasis"},Pe={key:1,class:"text-medium-emphasis"},Ie={key:1,class:"text-medium-emphasis"},Se={class:"d-flex gap-1"},Ue={class:"d-flex flex-wrap justify-center justify-sm-space-between gap-y-2 mt-2"},$e=ne({__name:"cities",setup(De){const _=s([]),N=s([]),A=s(!1),$=s(!1),D=s(0),n=s(!1),d=s(""),m=s("success"),P=s(!1),I=s(!1),y=s(!1),S=s(null),x=s([]),E=s(""),f=s({name:"",regionId:"",description:""}),v=s({id:0,name:"",description:"",regionId:""}),u=s({page:1,itemsPerPage:10,sortBy:[""],sortDesc:[!1]}),le=[{title:"المدينة",key:"name"},{title:"المنطقة",key:"regionName"},{title:"الدولة",key:"country"},{title:"الإجراءات",key:"actions",sortable:!1}],g=async()=>{A.value=!0;try{const r=new URLSearchParams({PageNumber:u.value.page.toString(),PageSize:u.value.itemsPerPage.toString(),SearchTerm:E.value||""}),e=await w(`/City/filter?${r}`);if(_.value=e.data.items||[],e.data){D.value=e.data.totalCount||0;const o=Math.ceil(D.value/u.value.itemsPerPage);u.value.page>o&&o>0&&(u.value.page=o,await g())}}catch(r){console.error("Error loading cities:",r),d.value="حدث خطأ أثناء تحميل المدن",m.value="error",n.value=!0,_.value=[],D.value=0}finally{A.value=!1}},ae=async()=>{$.value=!0;try{const r=await w("/Region/filter?PageSize=100");N.value=r.data.items||[]}catch(r){console.error("Error loading regions:",r),d.value="حدث خطأ أثناء تحميل المناطق",m.value="error",n.value=!0}finally{$.value=!1}},G=async()=>{var r,e;try{const o=await w("/City",{method:"POST",body:{name:f.value.name,regionId:f.value.regionId,description:f.value.description}});if(o&&o.isSuccess===!1){const l=o.message||((e=(r=o.errors)==null?void 0:r[0])==null?void 0:e.errorMessage)||"حدث خطأ أثناء إضافة المدينة";d.value=l,m.value="error",n.value=!0;return}P.value=!1,ie(),g(),d.value="تم إضافة المدينة بنجاح",m.value="success",n.value=!0}catch(o){console.error("Error adding city:",o),d.value="حدث خطأ أثناء إضافة المدينة",m.value="error",n.value=!0}},X=async()=>{var r,e;try{const o=await w(`/City/${v.value.id}`,{method:"PUT",body:{id:v.value.id,name:v.value.name,regionId:v.value.regionId,description:v.value.description}});if(o&&o.isSuccess===!1){const l=o.message||((e=(r=o.errors)==null?void 0:r[0])==null?void 0:e.errorMessage)||"حدث خطأ أثناء تحديث المدينة";d.value=l,m.value="error",n.value=!0;return}I.value=!1,g(),d.value="تم تحديث المدينة بنجاح",m.value="success",n.value=!0}catch(o){console.error("Error updating city:",o),d.value="حدث خطأ أثناء تحديث المدينة",m.value="error",n.value=!0}},te=async()=>{var r,e;if(S.value)try{console.log("Attempting to delete city:",S.value.id);const o=await w(`/City/${S.value.id}`,{method:"DELETE"});if(console.log("Delete response:",o),console.log("Response data:",o.data),o&&o.isSuccess===!1){const l=o.message||((e=(r=o.errors)==null?void 0:r[0])==null?void 0:e.errorMessage)||"حدث خطأ أثناء حذف المدينة";console.log("API returned error:",l),d.value=l,m.value="error",n.value=!0,y.value=!1;return}console.log("City deleted successfully"),y.value=!1,g(),d.value="تم حذف المدينة بنجاح",m.value="success",n.value=!0}catch(o){console.error("Error deleting city:",o),d.value="حدث خطأ في الاتصال بالخادم",m.value="error",n.value=!0,y.value=!1}},oe=async()=>{if(x.value.length!==0)try{const r=x.value.map(l=>w(`/City/${l.id}`,{method:"DELETE"})),o=(await Promise.all(r)).filter(l=>l&&l.isSuccess===!1);if(o.length>0){const l=o.map(b=>{var H,J;return(b==null?void 0:b.message)||((J=(H=b==null?void 0:b.errors)==null?void 0:H[0])==null?void 0:J.errorMessage)||"حدث خطأ أثناء العملية"}),B=`فشل في حذف ${o.length} عنصر: ${l.join(", ")}`;d.value=B,m.value="error",n.value=!0;return}x.value=[],g(),d.value="تم حذف المدن المحددة بنجاح",m.value="success",n.value=!0}catch(r){console.error("Error deleting selected cities:",r),d.value="حدث خطأ في الاتصال بالخادم",m.value="error",n.value=!0}},re=r=>{v.value={...r},I.value=!0},se=r=>{S.value=r,y.value=!0},ie=()=>{f.value={name:"",regionId:"",description:""}};return K(E,()=>{u.value.page=1,g()},{immediate:!1}),K([()=>u.value.page,()=>u.value.itemsPerPage],()=>{g()},{immediate:!1}),ue(()=>{g(),ae()}),(r,e)=>{const o=de("IconBtn");return k(),z("div",null,[a(ve,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=l=>n.value=l),type:m.value,variant:"tonal",closable:"",class:"mb-4"},{default:t(()=>[i(c(d.value),1)]),_:1},8,["modelValue","type"]),a(T,null,{default:t(()=>[a(M,{class:"d-flex justify-space-between align-center pa-6"},{default:t(()=>[e[19]||(e[19]=p("span",{class:"text-h5"},"إدارة المدن",-1)),p("div",xe,[x.value.length>0?(k(),R(V,{key:0,color:"error",variant:"outlined",onClick:oe},{default:t(()=>[i(" حذف المحدد ("+c(x.value.length)+") ",1)]),_:1})):me("",!0),a(V,{color:"primary",onClick:e[1]||(e[1]=l=>P.value=!0)},{default:t(()=>e[18]||(e[18]=[i(" إضافة مدينة ")])),_:1})])]),_:1}),a(pe),a(U,null,{default:t(()=>[a(q,null,{default:t(()=>[a(C,{cols:"12","offset-md":"8",md:"4"},{default:t(()=>[a(L,{modelValue:E.value,"onUpdate:modelValue":e[2]||(e[2]=l=>E.value=l),placeholder:"البحث في المدن...","prepend-inner-icon":"mdi-magnify","single-line":"","hide-details":"",dense:"",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),a(fe,{headers:le,items:_.value,loading:A.value,"items-per-page":u.value.itemsPerPage,page:u.value.page,options:u.value,class:"text-no-wrap","show-select":"",modelValue:x.value,"onUpdate:modelValue":e[5]||(e[5]=l=>x.value=l)},{"item.name":t(({item:l})=>[p("div",Ce,[a(Ve,{size:"32",color:"primary",variant:"tonal"},{default:t(()=>[i(c(l.name.charAt(0).toUpperCase()),1)]),_:2},1024),p("div",be,[p("span",ke,c(l.name),1),p("small",we,c(l.description||"لا يوجد وصف"),1)])])]),"item.regionName":t(({item:l})=>[l.regionName?(k(),R(Y,{key:0,color:"secondary",variant:"tonal",size:"small"},{default:t(()=>[i(c(l.regionName),1)]),_:2},1024)):(k(),z("span",Pe," لا توجد منطقة "))]),"item.country":t(({item:l})=>[l.country?(k(),R(Y,{key:0,color:"info",variant:"tonal",size:"small"},{default:t(()=>[i(c(l.country),1)]),_:2},1024)):(k(),z("span",Ie," لا توجد دولة "))]),"item.actions":t(({item:l})=>[p("div",Se,[a(o,{onClick:B=>re(l)},{default:t(()=>[a(Q,{icon:"tabler-edit"})]),_:2},1032,["onClick"]),a(o,{onClick:B=>se(l)},{default:t(()=>[a(Q,{icon:"tabler-trash"})]),_:2},1032,["onClick"])])]),bottom:t(()=>[a(U,{class:"pt-2"},{default:t(()=>[p("div",Ue,[a(ge,{modelValue:u.value.itemsPerPage,"onUpdate:modelValue":e[3]||(e[3]=l=>u.value.itemsPerPage=l),items:[5,10,25,50,100],label:"عناصر في الصفحة:",variant:"underlined",style:{"max-inline-size":"8rem","min-inline-size":"5rem"}},null,8,["modelValue"]),a(ce,{modelValue:u.value.page,"onUpdate:modelValue":e[4]||(e[4]=l=>u.value.page=l),"total-visible":r.$vuetify.display.smAndDown?3:5,length:Math.ceil(D.value/u.value.itemsPerPage)},null,8,["modelValue","total-visible","length"])])]),_:1})]),_:1},8,["items","loading","items-per-page","page","options","modelValue"])]),_:1})]),_:1}),a(O,{modelValue:P.value,"onUpdate:modelValue":e[10]||(e[10]=l=>P.value=l),"max-width":"600px",persistent:""},{default:t(()=>[a(T,null,{default:t(()=>[a(M,{class:"text-h6"},{default:t(()=>e[20]||(e[20]=[i("إضافة مدينة جديدة")])),_:1}),a(U,null,{default:t(()=>[a(Z,{onSubmit:W(G,["prevent"])},{default:t(()=>[a(q,null,{default:t(()=>[a(C,{cols:"12"},{default:t(()=>[a(L,{modelValue:f.value.name,"onUpdate:modelValue":e[6]||(e[6]=l=>f.value.name=l),label:"اسم المدينة",variant:"outlined",required:"",rules:[l=>!!l||"اسم المدينة مطلوب"]},null,8,["modelValue","rules"])]),_:1}),a(C,{cols:"12"},{default:t(()=>[a(h,{modelValue:f.value.regionId,"onUpdate:modelValue":e[7]||(e[7]=l=>f.value.regionId=l),label:"المنطقة",variant:"outlined",items:N.value,"item-title":"name","item-value":"id",loading:$.value,clearable:"","no-data-text":"لا توجد مناطق متاحة",required:"",rules:[l=>!!l||"المنطقة مطلوبة"],"prepend-inner-icon":"mdi-map-marker",placeholder:"اختر المنطقة...","hide-no-data":""},null,8,["modelValue","items","loading","rules"])]),_:1}),a(C,{cols:"12"},{default:t(()=>[a(ee,{modelValue:f.value.description,"onUpdate:modelValue":e[8]||(e[8]=l=>f.value.description=l),label:"الوصف",variant:"outlined",rows:"3",placeholder:"أدخل وصف المدينة..."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),a(j,null,{default:t(()=>[a(F),a(V,{color:"grey-darken-1",variant:"text",onClick:e[9]||(e[9]=l=>P.value=!1)},{default:t(()=>e[21]||(e[21]=[i(" إلغاء ")])),_:1}),a(V,{color:"primary",variant:"flat",onClick:G},{default:t(()=>e[22]||(e[22]=[i(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(O,{modelValue:I.value,"onUpdate:modelValue":e[15]||(e[15]=l=>I.value=l),"max-width":"600px",persistent:""},{default:t(()=>[a(T,null,{default:t(()=>[a(M,{class:"text-h6"},{default:t(()=>e[23]||(e[23]=[i("تعديل المدينة")])),_:1}),a(U,null,{default:t(()=>[a(Z,{onSubmit:W(X,["prevent"])},{default:t(()=>[a(q,null,{default:t(()=>[a(C,{cols:"12"},{default:t(()=>[a(L,{modelValue:v.value.name,"onUpdate:modelValue":e[11]||(e[11]=l=>v.value.name=l),label:"اسم المدينة",variant:"outlined",required:"",rules:[l=>!!l||"اسم المدينة مطلوب"]},null,8,["modelValue","rules"])]),_:1}),a(C,{cols:"12"},{default:t(()=>[a(h,{modelValue:v.value.regionId,"onUpdate:modelValue":e[12]||(e[12]=l=>v.value.regionId=l),label:"المنطقة",variant:"outlined",items:N.value,"item-title":"name","item-value":"id",loading:$.value,clearable:"","no-data-text":"لا توجد مناطق متاحة",required:"",rules:[l=>!!l||"المنطقة مطلوبة"],"prepend-inner-icon":"mdi-map-marker",placeholder:"اختر المنطقة...","hide-no-data":""},null,8,["modelValue","items","loading","rules"])]),_:1}),a(C,{cols:"12"},{default:t(()=>[a(ee,{modelValue:v.value.description,"onUpdate:modelValue":e[13]||(e[13]=l=>v.value.description=l),label:"الوصف",variant:"outlined",rows:"3",placeholder:"أدخل وصف المدينة..."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),a(j,null,{default:t(()=>[a(F),a(V,{color:"grey-darken-1",variant:"text",onClick:e[14]||(e[14]=l=>I.value=!1)},{default:t(()=>e[24]||(e[24]=[i(" إلغاء ")])),_:1}),a(V,{color:"primary",variant:"flat",onClick:X},{default:t(()=>e[25]||(e[25]=[i(" تحديث ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(O,{modelValue:y.value,"onUpdate:modelValue":e[17]||(e[17]=l=>y.value=l),"max-width":"400px"},{default:t(()=>[a(T,null,{default:t(()=>[a(M,{class:"text-h6"},{default:t(()=>e[26]||(e[26]=[i("تأكيد الحذف")])),_:1}),a(U,null,{default:t(()=>{var l;return[e[27]||(e[27]=i(' هل أنت متأكد من حذف المدينة "')),p("strong",null,c((l=S.value)==null?void 0:l.name),1),e[28]||(e[28]=i('"؟ ')),e[29]||(e[29]=p("br",null,null,-1)),e[30]||(e[30]=p("span",{class:"text-error"},"لا يمكن التراجع عن هذا الإجراء.",-1))]}),_:1}),a(j,null,{default:t(()=>[a(F),a(V,{color:"grey-darken-1",variant:"text",onClick:e[16]||(e[16]=l=>y.value=!1)},{default:t(()=>e[31]||(e[31]=[i(" إلغاء ")])),_:1}),a(V,{color:"error",variant:"flat",onClick:te},{default:t(()=>e[32]||(e[32]=[i(" حذف ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),yl=ye($e,[["__scopeId","data-v-0b88bd10"]]);export{yl as default};
