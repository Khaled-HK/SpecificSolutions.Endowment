import{a$ as ne,r as s,w as K,G as ue,a as ie,c as Q,o as E,b as a,e as t,t as i,v as x,d as p,f as W,l as de,ac as g,V as Y,aX as Z}from"./index-BtfhVSwE.js";import{$ as P}from"./api-DMVoFGKx.js";import{V as me}from"./VAlert-XzerbF0T.js";import{b as M,V as T,d as N}from"./VCard-BMKvoKHc.js";import{V as ve}from"./VDivider-BskaqePa.js";import{V as I}from"./VCardText-CQ_kqBGy.js";import{V as j,a as b}from"./VRow-DRm1vRrS.js";import{V as L}from"./VTextField-BP9Yt9Bg.js";import{V as pe}from"./VDataTable-arlORk0G.js";import{V as fe}from"./VSelect-CV3yq3nX.js";import{V as ce}from"./VPagination-C4bWb9ez.js";import{V as ge}from"./VChip-DkJYynY0.js";import{V as Ve}from"./VAvatar-Di7p70o_.js";import{V as h}from"./VForm-DB6_r-fV.js";import{V as A}from"./VAutocomplete-DFOTlZAA.js";import{V as F}from"./VSpacer-affoxjwI.js";import{V as O}from"./VDialog-BR-8AWmC.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-9rIf2CJL.js";import"./VImg-BKSypqLi.js";/* empty css              *//* empty css                   */import"./VCounter-CfEBC7nV.js";import"./VField-DiZdpAIN.js";import"./form-DUL9ls8s.js";import"./easing-CjukEv2V.js";import"./VInput-DIAfQwmh.js";import"./forwardRefs-C-GTDzx5.js";import"./VCheckboxBtn-CPFIFhHb.js";import"./VSelectionControl-C7oASZhF.js";import"./VTable-DxW4-iwJ.js";import"./filter-BALRNvRS.js";import"./VList-Cp76iGum.js";import"./ssrBoot-BJLk6Iwd.js";import"./dialog-transition-CRKIv97n.js";import"./VMenu-Cpm7zxfp.js";import"./VOverlay-BfQOvZM9.js";import"./delay-BDF9y9xB.js";import"./lazy-NLe1V18V.js";import"./scopeId-Cvig9lvB.js";import"./VSlideGroup-BbCsdCyI.js";const xe={class:"d-flex gap-2"},be={class:"d-flex align-center"},we={class:"d-flex flex-column ms-3"},Ce={class:"d-block font-weight-medium text-truncate text-high-emphasis"},Pe={class:"text-medium-emphasis"},ke={key:1,class:"text-medium-emphasis"},Re={class:"d-flex gap-1"},Se={class:"d-flex flex-wrap justify-center justify-sm-space-between gap-y-2 mt-2"},Ie=ne({__name:"regions",setup(Ue){const B=s([]),U=s([]),_=s([]),q=s(!1),w=s(!1),$=s(0),n=s(!1),d=s(""),m=s("success"),k=s(!1),R=s(!1),V=s(!1),S=s(null),y=s([]),D=s(""),f=s({name:"",country:"",cityId:""}),v=s({id:0,key:"",value:"",name:"",description:"",cityId:""}),u=s({page:1,itemsPerPage:10,sortBy:[""],sortDesc:[!1]}),ee=[{title:"المنطقة",key:"name"},{title:"الدولة",key:"country"},{title:"الإجراءات",key:"actions",sortable:!1}],c=async()=>{q.value=!0;try{const r=new URLSearchParams({PageNumber:u.value.page.toString(),PageSize:u.value.itemsPerPage.toString(),SearchTerm:D.value||""}),e=await P(`/Region/filter?${r}`);if(B.value=e.data.items||[],e.data){$.value=e.data.totalCount||0;const o=Math.ceil($.value/u.value.itemsPerPage);u.value.page>o&&o>0&&(u.value.page=o,await c())}}catch(r){console.error("Error loading regions:",r),d.value="حدث خطأ أثناء تحميل المناطق",m.value="error",n.value=!0,B.value=[],$.value=0}finally{q.value=!1}},le=async()=>{w.value=!0;try{const r=await P("/City/filter?PageSize=100");U.value=r.data.items||[];const e=[...new Set(U.value.map(o=>o.country).filter(Boolean))];_.value=e.sort()}catch(r){console.error("Error loading cities:",r),d.value="حدث خطأ أثناء تحميل المدن",m.value="error",n.value=!0}finally{w.value=!1}},G=async()=>{var r,e;try{const o=await P("/Region",{method:"POST",body:{name:f.value.name,country:f.value.country,cityId:f.value.cityId}});if(o&&o.isSuccess===!1){const l=o.message||((e=(r=o.errors)==null?void 0:r[0])==null?void 0:e.errorMessage)||"حدث خطأ أثناء إضافة المنطقة";d.value=l,m.value="error",n.value=!0;return}k.value=!1,se(),c(),d.value="تم إضافة المنطقة بنجاح",m.value="success",n.value=!0}catch(o){console.error("Error adding region:",o),d.value="حدث خطأ أثناء إضافة المنطقة",m.value="error",n.value=!0}},X=async()=>{var r,e;try{const o=await P(`/Region/${v.value.id}`,{method:"PUT",body:{id:v.value.id,name:v.value.name,country:v.value.country||v.value.description,cityId:v.value.cityId}});if(o&&o.isSuccess===!1){const l=o.message||((e=(r=o.errors)==null?void 0:r[0])==null?void 0:e.errorMessage)||"حدث خطأ أثناء تحديث المنطقة";d.value=l,m.value="error",n.value=!0;return}R.value=!1,c(),d.value="تم تحديث المنطقة بنجاح",m.value="success",n.value=!0}catch(o){console.error("Error updating region:",o),d.value="حدث خطأ أثناء تحديث المنطقة",m.value="error",n.value=!0}},ae=async()=>{var r,e;if(S.value)try{console.log("Attempting to delete region:",S.value.id);const o=await P(`/Region/${S.value.id}`,{method:"DELETE"});if(console.log("Delete response:",o),console.log("Response data:",o.data),o&&o.isSuccess===!1){const l=o.message||((e=(r=o.errors)==null?void 0:r[0])==null?void 0:e.errorMessage)||"حدث خطأ أثناء حذف المنطقة";console.log("API returned error:",l),d.value=l,m.value="error",n.value=!0,V.value=!1;return}console.log("Region deleted successfully"),V.value=!1,c(),d.value="تم حذف المنطقة بنجاح",m.value="success",n.value=!0}catch(o){console.error("Error deleting region:",o),d.value="حدث خطأ في الاتصال بالخادم",m.value="error",n.value=!0,V.value=!1}},te=async()=>{if(y.value.length!==0)try{const r=y.value.map(l=>P(`/Region/${l.id}`,{method:"DELETE"})),o=(await Promise.all(r)).filter(l=>l&&l.isSuccess===!1);if(o.length>0){const l=o.map(C=>{var H,J;return(C==null?void 0:C.message)||((J=(H=C==null?void 0:C.errors)==null?void 0:H[0])==null?void 0:J.errorMessage)||"حدث خطأ أثناء العملية"}),z=`فشل في حذف ${o.length} عنصر: ${l.join(", ")}`;d.value=z,m.value="error",n.value=!0;return}y.value=[],c(),d.value="تم حذف المناطق المحددة بنجاح",m.value="success",n.value=!0}catch(r){console.error("Error deleting selected regions:",r),d.value="حدث خطأ في الاتصال بالخادم",m.value="error",n.value=!0}},oe=r=>{v.value={...r,country:r.country||r.description||""},R.value=!0},re=r=>{S.value=r,V.value=!0},se=()=>{f.value={name:"",country:"",cityId:""}};return K(D,()=>{u.value.page=1,c()},{immediate:!1}),K([()=>u.value.page,()=>u.value.itemsPerPage],()=>{c()},{immediate:!1}),ue(()=>{c(),le()}),(r,e)=>{const o=ie("IconBtn");return E(),Q("div",null,[a(me,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=l=>n.value=l),type:m.value,variant:"tonal",closable:"",class:"mb-4"},{default:t(()=>[i(x(d.value),1)]),_:1},8,["modelValue","type"]),a(T,null,{default:t(()=>[a(M,{class:"d-flex justify-space-between align-center pa-6"},{default:t(()=>[e[19]||(e[19]=p("span",{class:"text-h5"},"إدارة المناطق",-1)),p("div",xe,[y.value.length>0?(E(),W(g,{key:0,color:"error",variant:"outlined",onClick:te},{default:t(()=>[i(" حذف المحدد ("+x(y.value.length)+") ",1)]),_:1})):de("",!0),a(g,{color:"primary",onClick:e[1]||(e[1]=l=>k.value=!0)},{default:t(()=>e[18]||(e[18]=[i(" إضافة منطقة ")])),_:1})])]),_:1}),a(ve),a(I,null,{default:t(()=>[a(j,null,{default:t(()=>[a(b,{cols:"12","offset-md":"8",md:"4"},{default:t(()=>[a(L,{modelValue:D.value,"onUpdate:modelValue":e[2]||(e[2]=l=>D.value=l),placeholder:"البحث في المناطق...","prepend-inner-icon":"mdi-magnify","single-line":"","hide-details":"",dense:"",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),a(pe,{headers:ee,items:B.value,loading:q.value,"items-per-page":u.value.itemsPerPage,page:u.value.page,options:u.value,class:"text-no-wrap","show-select":"",modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=l=>y.value=l)},{"item.name":t(({item:l})=>[p("div",be,[a(Ve,{size:"32",color:"primary",variant:"tonal"},{default:t(()=>[i(x(l.name.charAt(0).toUpperCase()),1)]),_:2},1024),p("div",we,[p("span",Ce,x(l.name),1),p("small",Pe,x(l.description||"لا يوجد وصف"),1)])])]),"item.country":t(({item:l})=>[l.country?(E(),W(ge,{key:0,color:"secondary",variant:"tonal",size:"small"},{default:t(()=>[i(x(l.country),1)]),_:2},1024)):(E(),Q("span",ke," لا توجد دولة "))]),"item.actions":t(({item:l})=>[p("div",Re,[a(o,{onClick:z=>oe(l)},{default:t(()=>[a(Y,{icon:"tabler-edit"})]),_:2},1032,["onClick"]),a(o,{onClick:z=>re(l)},{default:t(()=>[a(Y,{icon:"tabler-trash"})]),_:2},1032,["onClick"])])]),bottom:t(()=>[a(I,{class:"pt-2"},{default:t(()=>[p("div",Se,[a(fe,{modelValue:u.value.itemsPerPage,"onUpdate:modelValue":e[3]||(e[3]=l=>u.value.itemsPerPage=l),items:[5,10,25,50,100],label:"عناصر في الصفحة:",variant:"underlined",style:{"max-inline-size":"8rem","min-inline-size":"5rem"}},null,8,["modelValue"]),a(ce,{modelValue:u.value.page,"onUpdate:modelValue":e[4]||(e[4]=l=>u.value.page=l),"total-visible":r.$vuetify.display.smAndDown?3:5,length:Math.ceil($.value/u.value.itemsPerPage)},null,8,["modelValue","total-visible","length"])])]),_:1})]),_:1},8,["items","loading","items-per-page","page","options","modelValue"])]),_:1})]),_:1}),a(O,{modelValue:k.value,"onUpdate:modelValue":e[10]||(e[10]=l=>k.value=l),"max-width":"600px",persistent:""},{default:t(()=>[a(T,null,{default:t(()=>[a(M,{class:"text-h6"},{default:t(()=>e[20]||(e[20]=[i("إضافة منطقة جديدة")])),_:1}),a(I,null,{default:t(()=>[a(h,{onSubmit:Z(G,["prevent"])},{default:t(()=>[a(j,null,{default:t(()=>[a(b,{cols:"12"},{default:t(()=>[a(L,{modelValue:f.value.name,"onUpdate:modelValue":e[6]||(e[6]=l=>f.value.name=l),label:"اسم المنطقة",variant:"outlined",required:"",rules:[l=>!!l||"اسم المنطقة مطلوب"]},null,8,["modelValue","rules"])]),_:1}),a(b,{cols:"12"},{default:t(()=>[a(A,{modelValue:f.value.cityId,"onUpdate:modelValue":e[7]||(e[7]=l=>f.value.cityId=l),label:"المدينة",variant:"outlined",items:U.value,"item-title":"name","item-value":"id",loading:w.value,clearable:"","no-data-text":"لا توجد مدن متاحة",required:"",rules:[l=>!!l||"المدينة مطلوبة"],"prepend-inner-icon":"mdi-city",placeholder:"اختر المدينة...","hide-no-data":""},null,8,["modelValue","items","loading","rules"])]),_:1}),a(b,{cols:"12"},{default:t(()=>[a(A,{modelValue:f.value.country,"onUpdate:modelValue":e[8]||(e[8]=l=>f.value.country=l),label:"الدولة",variant:"outlined",items:_.value,loading:w.value,clearable:"","no-data-text":"لا توجد دول متاحة",required:"",rules:[l=>!!l||"الدولة مطلوبة"],"prepend-inner-icon":"mdi-magnify",placeholder:"ابحث عن دولة...","hide-no-data":""},null,8,["modelValue","items","loading","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),a(N,null,{default:t(()=>[a(F),a(g,{color:"grey-darken-1",variant:"text",onClick:e[9]||(e[9]=l=>k.value=!1)},{default:t(()=>e[21]||(e[21]=[i(" إلغاء ")])),_:1}),a(g,{color:"primary",variant:"flat",onClick:G},{default:t(()=>e[22]||(e[22]=[i(" حفظ ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(O,{modelValue:R.value,"onUpdate:modelValue":e[15]||(e[15]=l=>R.value=l),"max-width":"600px",persistent:""},{default:t(()=>[a(T,null,{default:t(()=>[a(M,{class:"text-h6"},{default:t(()=>e[23]||(e[23]=[i("تعديل المنطقة")])),_:1}),a(I,null,{default:t(()=>[a(h,{onSubmit:Z(X,["prevent"])},{default:t(()=>[a(j,null,{default:t(()=>[a(b,{cols:"12"},{default:t(()=>[a(L,{modelValue:v.value.name,"onUpdate:modelValue":e[11]||(e[11]=l=>v.value.name=l),label:"اسم المنطقة",variant:"outlined",required:"",rules:[l=>!!l||"اسم المنطقة مطلوب"]},null,8,["modelValue","rules"])]),_:1}),a(b,{cols:"12"},{default:t(()=>[a(A,{modelValue:v.value.cityId,"onUpdate:modelValue":e[12]||(e[12]=l=>v.value.cityId=l),label:"المدينة",variant:"outlined",items:U.value,"item-title":"name","item-value":"id",loading:w.value,clearable:"","no-data-text":"لا توجد مدن متاحة",required:"",rules:[l=>!!l||"المدينة مطلوبة"],"prepend-inner-icon":"mdi-city",placeholder:"اختر المدينة...","hide-no-data":""},null,8,["modelValue","items","loading","rules"])]),_:1}),a(b,{cols:"12"},{default:t(()=>[a(A,{modelValue:v.value.country,"onUpdate:modelValue":e[13]||(e[13]=l=>v.value.country=l),label:"الدولة",variant:"outlined",items:_.value,loading:w.value,clearable:"","no-data-text":"لا توجد دول متاحة",required:"",rules:[l=>!!l||"الدولة مطلوبة"],"prepend-inner-icon":"mdi-magnify",placeholder:"ابحث عن دولة...","hide-no-data":""},null,8,["modelValue","items","loading","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),a(N,null,{default:t(()=>[a(F),a(g,{color:"grey-darken-1",variant:"text",onClick:e[14]||(e[14]=l=>R.value=!1)},{default:t(()=>e[24]||(e[24]=[i(" إلغاء ")])),_:1}),a(g,{color:"primary",variant:"flat",onClick:X},{default:t(()=>e[25]||(e[25]=[i(" تحديث ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(O,{modelValue:V.value,"onUpdate:modelValue":e[17]||(e[17]=l=>V.value=l),"max-width":"400px"},{default:t(()=>[a(T,null,{default:t(()=>[a(M,{class:"text-h6"},{default:t(()=>e[26]||(e[26]=[i("تأكيد الحذف")])),_:1}),a(I,null,{default:t(()=>{var l;return[e[27]||(e[27]=i(' هل أنت متأكد من حذف المنطقة "')),p("strong",null,x((l=S.value)==null?void 0:l.value),1),e[28]||(e[28]=i('"؟ ')),e[29]||(e[29]=p("br",null,null,-1)),e[30]||(e[30]=p("span",{class:"text-error"},"لا يمكن التراجع عن هذا الإجراء.",-1))]}),_:1}),a(N,null,{default:t(()=>[a(F),a(g,{color:"grey-darken-1",variant:"text",onClick:e[16]||(e[16]=l=>V.value=!1)},{default:t(()=>e[31]||(e[31]=[i(" إلغاء ")])),_:1}),a(g,{color:"error",variant:"flat",onClick:ae},{default:t(()=>e[32]||(e[32]=[i(" حذف ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),gl=ye(Ie,[["__scopeId","data-v-9626ac5b"]]);export{gl as default};
