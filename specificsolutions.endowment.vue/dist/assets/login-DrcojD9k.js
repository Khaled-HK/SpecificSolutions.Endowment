import{_ as G}from"./AppTextField-CJgbluZ3.js";import{aZ as Z,r as w,i as H,j as J,br as K,P as Q,D as X,a as Y,c as ee,o as ae,d as l,b as a,e as s,s as p,t as n,aa as A,m as r,E as V,aV as te,F as se,b5 as v,aU as re}from"./index-CK1fpvPu.js";import{_ as oe}from"./AuthProvider-DP-1SncF.js";import{u as L}from"./useGenerateImageVariant-DkHPOrSI.js";import{a as ie,b as le,c as ne,d as de}from"./auth-v2-login-illustration-light-8U3Ay0LB.js";import{a as ue,b as me}from"./misc-mask-light-CdCn4Q-o.js";import{V as ce}from"./VNodeRenderer-Cx66_DqQ.js";import{u as fe}from"./useAbility-DO-7r7Fp.js";import{u as pe}from"./useFormValidation--K-9QZRo.js";import{$ as ge}from"./api-BL_tVZq2.js";import{a as f,V as P}from"./VRow-Dcd2HQbw.js";import{V as he}from"./VImg-CGrxDryJ.js";import{V as _e}from"./VCard-CIvz8ijW.js";import{V as I}from"./VCardText-BSu9PeVr.js";import{V as we}from"./VForm-CHv1ws0G.js";import{V as be}from"./VCheckbox-0DUjVALv.js";import{V as q}from"./VDivider-n3wzZ4nA.js";import"./form-BFxad-Fs.js";import"./VTextField-DGy7sZcW.js";/* empty css                   */import"./VCounter-B1fUDCB4.js";import"./VField-DG_UKZ_N.js";import"./easing-CjukEv2V.js";import"./VInput-ktq1dKao.js";import"./forwardRefs-C-GTDzx5.js";import"./index-9rIf2CJL.js";/* empty css              */import"./VAvatar-CA9yN-sZ.js";import"./VCheckboxBtn-B3kpR2xa.js";import"./VSelectionControl-Ell3Bz42.js";const Ve={class:"language-toggle"},ve={class:"auth-logo d-flex align-center gap-x-3"},ye={class:"auth-title"},xe={class:"position-relative bg-background w-100 me-0"},Ee={class:"d-flex align-center justify-center w-100 h-100",style:{"padding-inline":"6.25rem"}},Re=["src"],ke={class:"text-h4 mb-1"},Ae={class:"text-capitalize"},Le={class:"mb-0"},Pe={class:"d-flex align-center flex-wrap justify-space-between my-6"},Ie={class:"mx-4"},na=Z({__name:"login",setup(qe){L(de,ne,le,ie,!0);const C=L(me,ue),h=w(!1),y=H(),F=J(),W=fe(),{validationState:m,setErrorsFromResponse:M,clearErrors:j,hasErrors:D,setFieldTouched:_,validateRequired:x,validateEmail:B,addError:b}=pe(),S=w(),d=K({email:"admin@demo.com",password:"admin"}),E=w(!1),c=w("ar");Q(()=>c.value==="ar");const U={ar:{welcome:"مرحباً بك في",signInMessage:"يرجى تسجيل الدخول إلى حسابك وابدأ المغامرة",adminEmail:"بريد المدير",clientEmail:"بريد العميل",password:"كلمة المرور",email:"البريد الإلكتروني",passwordField:"كلمة المرور",rememberMe:"تذكرني",forgotPassword:"نسيت كلمة المرور؟",signIn:"تسجيل الدخول",newUser:"جديد على منصتنا؟",createAccount:"إنشاء حساب",or:"أو",loginFailed:"فشل تسجيل الدخول. يرجى التحقق من بيانات الاعتماد.",noPermissions:"فشل تسجيل الدخول: لم يتم العثور على صلاحيات.",emailRequired:"البريد الإلكتروني مطلوب",invalidEmail:"البريد الإلكتروني غير صحيح",passwordRequired:"كلمة المرور مطلوبة",tryAgain:"فشل تسجيل الدخول. يرجى المحاولة مرة أخرى."},en:{welcome:"Welcome to",signInMessage:"Please sign-in to your account and start the adventure",adminEmail:"Admin Email",clientEmail:"Client Email",password:"Password",email:"Email",passwordField:"Password",rememberMe:"Remember me",forgotPassword:"Forgot Password?",signIn:"Sign In",newUser:"New on our platform?",createAccount:"Create an account",or:"or",loginFailed:"Login failed. Please check your credentials.",noPermissions:"Login failed: No permissions found.",emailRequired:"Email is required",invalidEmail:"Invalid email format",passwordRequired:"Password is required",tryAgain:"Login failed. Please try again."}},T=()=>{c.value=c.value==="ar"?"en":"ar",localStorage.setItem("preferredLanguage",c.value)},o=e=>U[c.value][e]||e;X(()=>{const e=localStorage.getItem("preferredLanguage");e&&(c.value=e)});const N=async()=>{try{const t=(await ge("/Auth/login",{method:"POST",body:{email:d.email,password:d.password},onResponseError({response:i}){i._data.errors?M(i._data):b("email",o("loginFailed"))}})).data;if(v("accessToken").value=t.token,v("userData").value=t,!t.permissions){console.error("User object does not have permissions:",t),b("email",o("noPermissions"));return}const u=[];u.push({action:"read",subject:"Auth"},{action:"write",subject:"Auth"},{action:"delete",subject:"Auth"},{action:"View",subject:"Dashboard"}),t.permissions.forEach(i=>{const R=O(i),k=z(i);R&&k&&u.push({action:R,subject:k})}),console.log("CASL Rules المحدثة:",u),console.log("User permissions من Backend:",t.permissions),v("userAbilityRules").value=u,W.update(u);const g=y.query.to?String(y.query.to):"/dashboard";console.log("Navigating to:",g),await re(()=>{F.replace(g)})}catch(e){console.error("Login error:",e),b("email",o("tryAgain"))}},$=async()=>{j();let e=!0;x(d.email,"email",o("emailRequired"))&&B(d.email,"email",o("invalidEmail"))||(e=!1),x(d.password,"password",o("passwordRequired"))||(e=!1),_("email"),_("password"),e&&await N()};function O(e){return e.endsWith("_View")?"View":e.endsWith("_Add")?"Add":e.endsWith("_Edit")?"Edit":e.endsWith("_Delete")?"Delete":null}function z(e){return e.startsWith("Account_")?"Account":e.startsWith("User_")?"User":e.startsWith("Role_")?"Role":e.startsWith("Decision_")?"Decision":e.startsWith("Request_")?"Request":e.startsWith("Office_")?"Office":e.startsWith("Endowment_")?"Endowment":e.startsWith("City_")?"City":e.startsWith("Region_")?"Region":e.startsWith("Building_")?"Building":e.startsWith("Mosque_")?"Mosque":null}return(e,t)=>{const u=Y("RouterLink"),g=G;return ae(),ee(se,null,[l("div",Ve,[a(A,{variant:"text",size:"small",onClick:T,class:"language-btn"},{default:s(()=>[p(n(c.value==="ar"?"English":"العربية"),1)]),_:1})]),a(u,{to:"/"},{default:s(()=>[l("div",ve,[a(r(ce),{nodes:r(V).app.logo},null,8,["nodes"]),l("h1",ye,n(r(V).app.title),1)])]),_:1}),a(P,{"no-gutters":"",class:"auth-wrapper bg-surface"},{default:s(()=>[a(f,{md:"8",class:"d-none d-md-flex"},{default:s(()=>[l("div",xe,[l("div",Ee,[a(he,{"max-width":"613",src:"/Mosque.jpg",class:"auth-illustration mt-16 mb-2"})]),l("img",{class:"auth-footer-mask",src:r(C),alt:"auth-footer-mask",height:"280",width:"100"},null,8,Re)])]),_:1}),a(f,{cols:"12",md:"4",class:"auth-card-v2 d-flex align-center justify-center"},{default:s(()=>[a(_e,{flat:"","max-width":500,class:"mt-12 mt-sm-0 pa-4"},{default:s(()=>[a(I,null,{default:s(()=>[l("h4",ke,[p(n(o("welcome"))+" ",1),l("span",Ae,n(r(V).app.title),1),t[6]||(t[6]=p("! 👋🏻 "))]),l("p",Le,n(o("signInMessage")),1)]),_:1}),a(I,null,{default:s(()=>[a(r(we),{ref_key:"refVForm",ref:S,onSubmit:te($,["prevent"])},{default:s(()=>[a(P,null,{default:s(()=>[a(f,{cols:"12"},{default:s(()=>[a(g,{modelValue:d.email,"onUpdate:modelValue":t[0]||(t[0]=i=>d.email=i),label:o("email"),placeholder:"johndoe@email.com",type:"email",autofocus:"",error:r(m).errors.email&&r(m).errors.email.length>0&&r(m).touched.email,"error-messages":r(m).errors.email||[],onBlur:t[1]||(t[1]=i=>r(_)("email"))},null,8,["modelValue","label","error","error-messages"])]),_:1}),a(f,{cols:"12"},{default:s(()=>[a(g,{modelValue:d.password,"onUpdate:modelValue":t[2]||(t[2]=i=>d.password=i),label:o("passwordField"),placeholder:"············",type:h.value?"text":"password",autocomplete:"password",error:r(m).errors.password&&r(m).errors.password.length>0&&r(m).touched.password,"error-messages":r(m).errors.password||[],"append-inner-icon":h.value?"tabler-eye-off":"tabler-eye","onClick:appendInner":t[3]||(t[3]=i=>h.value=!h.value),onBlur:t[4]||(t[4]=i=>r(_)("password"))},null,8,["modelValue","label","type","error","error-messages","append-inner-icon"]),l("div",Pe,[a(be,{modelValue:E.value,"onUpdate:modelValue":t[5]||(t[5]=i=>E.value=i),label:o("rememberMe")},null,8,["modelValue","label"]),a(u,{class:"text-primary ms-2 mb-1",to:{name:"forgot-password"}},{default:s(()=>[p(n(o("forgotPassword")),1)]),_:1})]),a(A,{block:"",type:"submit",disabled:r(D)},{default:s(()=>[p(n(o("signIn")),1)]),_:1},8,["disabled"])]),_:1}),a(f,{cols:"12",class:"text-center"},{default:s(()=>[l("span",null,n(o("newUser")),1),a(u,{class:"text-primary ms-1",to:{name:"register"}},{default:s(()=>[p(n(o("createAccount")),1)]),_:1})]),_:1}),a(f,{cols:"12",class:"d-flex align-center"},{default:s(()=>[a(q),l("span",Ie,n(o("or")),1),a(q)]),_:1}),a(f,{cols:"12",class:"text-center"},{default:s(()=>[a(oe)]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})],64)}}});export{na as default};
